{"ast":null,"code":"var _jsxFileName = \"/Users/cramj/Downloads/usportproject 2/src/pwa/view/WithdrawalHistory.js\";\nimport React, { useEffect, useState, useMemo } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport { map, filter } from \"lodash\";\nimport * as moment from \"moment\";\nimport { Wrap } from \"../view/profile/\";\nimport \"../assets/scss/WithdrawalHistory.scss\"; // import api from \"../../service/api\";\n\nimport { User, Transaction } from \"../../service\";\nimport { toDate } from \"../../util\";\nimport { withAuth } from \"../util/\";\n\nconst CardItem = props => {\n  // console.log(props)\n  const {\n    label,\n    time,\n    value,\n    status,\n    index,\n    className,\n    obj,\n    onSetKey,\n    setKey\n  } = props; //成功 SUCCESS\n  //失败 FAILURE\n  //未审核 UNREVIEWED\n  //出款中 WITHDRAWING\n  //已审核 AUDITED\n  //汇款中 REMITTANCE\n\n  let statusText = \"\";\n  let classStatus = \"\";\n  let cancel = false;\n  let fail = false;\n\n  if (status === \"成功\") {\n    statusText = \"成功\";\n    classStatus = \"success\";\n  }\n\n  if (status === \"失败\") {\n    statusText = \"失败\";\n    classStatus = \"failure\";\n    fail = true;\n  }\n\n  if (status === \"未审核\") {\n    statusText = \"未审核\";\n    classStatus = \"unreviewed\";\n    cancel = true;\n  }\n\n  if (status === \"出款中\") {\n    statusText = \"出款中\";\n    classStatus = \"withdrawing\";\n  }\n\n  if (status === \"汇款中\") {\n    statusText = \"汇款中\";\n    classStatus = \"remittance\";\n  } // if(status === \"已审核\"){\n  // \tstatusText = \"已审核\"\n  // \tclassStatus = \"audited\"\n  // }\n\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: `withdrawal-history-card-item ${className ? className : \"\"}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 73,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"cl-item withdrawal-history-card-text\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"p\", {\n    className: \"cl-card-text\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 9\n    }\n  }, label), /*#__PURE__*/React.createElement(\"p\", {\n    className: \"cl-card-time\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 9\n    }\n  }, time)), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"cl-item withdrawal-history-card-value\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 7\n    }\n  }, cancel && /*#__PURE__*/React.createElement(\"span\", {\n    className: \"cancel\",\n    onClick: () => props.onCancel(obj),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 11\n    }\n  }, \"\\u53D6\\u6D88\\u63D0\\u6B3E\"), /*#__PURE__*/React.createElement(\"p\", {\n    className: \"cl-card-amount\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 9\n    }\n  }, \"\\u91D1\\u989D: \", /*#__PURE__*/React.createElement(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 15\n    }\n  }, value)), /*#__PURE__*/React.createElement(\"p\", {\n    className: `cl-card-status ${classStatus}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 11\n    }\n  }, statusText, fail && /*#__PURE__*/React.createElement(\"span\", {\n    className: \"fail\",\n    onClick: () => onSetKey(index),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 15\n    }\n  }, setKey === index && /*#__PURE__*/React.createElement(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 38\n    }\n  }, obj.verifyComment), /*#__PURE__*/React.createElement(\"i\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 17\n    }\n  }))))));\n};\n\nconst WithdrawalHistory = () => {\n  const [key, setKey] = useState(null);\n  const [items, setItems] = useState({\n    status: 0,\n    list: []\n  });\n  const [load, setLoad] = useState(false);\n  const [range, setRange] = useState(\"today\");\n  const [customRange, setCustomRange] = useState({\n    from: moment().subtract(30, \"days\").toDate(),\n    to: moment().toDate()\n  });\n  useEffect(() => {\n    const fetch = () => {\n      const response = Transaction.read({ ...User.read(),\n        record_type: \"debit\"\n      });\n      response.promise.then(result => {\n        // console.log(result);\n        if (result.status === 1) {\n          // setItems(result.info);\n          setItems({\n            status: 1,\n            list: result.info.map(t => ({ ...t,\n              ts: toDate(t.requestTime, true)\n            }))\n          });\n          setLoad(false);\n        }\n      }, e => {\n        console.log(\"Unable to response:\", e);\n      });\n    };\n\n    fetch();\n  }, [load]);\n\n  const onCancel = async w => {\n    console.log(w); // const r = await Service.User.withdrawCancel({ id: w.id }).promise;\n\n    const response = await User.withdrawCancel({\n      id: w.id\n    }).promise; // console.log(response);\n\n    if (response.status === 1) {\n      setLoad(true);\n    }\n  };\n\n  const onSetKey = value => {\n    setKey(null);\n    if (key !== value) setKey(value);\n  };\n\n  const history = useHistory();\n\n  const __withdraws = useMemo(() => {\n    const _rangeMap = {\n      today: () => {\n        const today = moment();\n        return [today.startOf(\"day\").unix(), today.endOf(\"day\").unix()];\n      },\n      yesterday: () => {\n        const yesterday = moment().subtract(1, \"days\");\n        return [yesterday.startOf(\"day\").unix(), yesterday.endOf(\"day\").unix()];\n      },\n      week: () => {\n        return [moment().subtract(1, \"weeks\").startOf(\"day\").unix(), moment().endOf(\"day\").unix()];\n      },\n      month: () => {\n        return [moment().subtract(30, \"days\").startOf(\"day\").unix(), moment().endOf(\"day\").unix()];\n      },\n      custom: () => {\n        let {\n          from,\n          to\n        } = customRange;\n        return [moment(from).startOf(\"day\").unix(), moment(to).endOf(\"day\").unix()];\n      }\n    };\n\n    const [from, to] = _rangeMap[range](); // return withdraws.list.filter((t) => t.ts >= from && t.ts < to);\n\n\n    return filter(items.list, t => t.ts >= from && t.ts < to);\n  }, [items.list, customRange, range]); // console.log(__withdraws)\n\n\n  return /*#__PURE__*/React.createElement(Wrap, {\n    className: \"withdrawal-history-wrap\",\n    centerName: \"\\u63D0\\u6B3E\\u8BB0\\u5F55\",\n    sublevel: [true, () => history.goBack()],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 207,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"withdrawal-history-wrap-inner\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"withdrawal-history-wrap-inner-content\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"withdrawal-history-card\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 214,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"withdrawal-history-card-head\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"withdrawal-history-card-title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 216,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 217,\n      columnNumber: 17\n    }\n  }, \"\\u6700\\u8FD130\\u5929\"), /*#__PURE__*/React.createElement(\"i\", {\n    className: load ? \"reload\" : \"\",\n    onClick: () => setLoad(true),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 218,\n      columnNumber: 17\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"withdrawal-history-card-body\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 225,\n      columnNumber: 13\n    }\n  }, __withdraws && __withdraws.length > 0 ? map(__withdraws, (obj, i) => {\n    return /*#__PURE__*/React.createElement(CardItem, {\n      obj: obj,\n      key: i,\n      index: i,\n      label: obj.cardNumber,\n      time: obj.requestTime,\n      value: obj.amount,\n      status: obj.status,\n      onCancel: val => onCancel(val),\n      onSetKey: val => onSetKey(val),\n      setKey: key,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 230,\n        columnNumber: 21\n      }\n    });\n  }) : /*#__PURE__*/React.createElement(\"div\", {\n    className: \"no-transactions\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 245,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"image-box\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 246,\n      columnNumber: 19\n    }\n  }), /*#__PURE__*/React.createElement(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 247,\n      columnNumber: 19\n    }\n  }, \"\\u6682\\u65E0\\u8BB0\\u5F55\")))))));\n};\n\nexport default withAuth(WithdrawalHistory, 1);","map":{"version":3,"sources":["/Users/cramj/Downloads/usportproject 2/src/pwa/view/WithdrawalHistory.js"],"names":["React","useEffect","useState","useMemo","useHistory","map","filter","moment","Wrap","User","Transaction","toDate","withAuth","CardItem","props","label","time","value","status","index","className","obj","onSetKey","setKey","statusText","classStatus","cancel","fail","onCancel","verifyComment","WithdrawalHistory","key","items","setItems","list","load","setLoad","range","setRange","customRange","setCustomRange","from","subtract","to","fetch","response","read","record_type","promise","then","result","info","t","ts","requestTime","e","console","log","w","withdrawCancel","id","history","__withdraws","_rangeMap","today","startOf","unix","endOf","yesterday","week","month","custom","goBack","length","i","cardNumber","amount","val"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useMemo } from \"react\";\r\nimport { useHistory } from \"react-router-dom\";\r\nimport { map, filter } from \"lodash\";\r\nimport * as moment from \"moment\";\r\n\r\nimport { Wrap } from \"../view/profile/\";\r\n\r\nimport \"../assets/scss/WithdrawalHistory.scss\";\r\n\r\n// import api from \"../../service/api\";\r\nimport { User, Transaction } from \"../../service\";\r\n\r\nimport { toDate } from \"../../util\";\r\nimport { withAuth } from \"../util/\";\r\n\r\nconst CardItem = (props) => {\r\n  // console.log(props)\r\n  const {\r\n    label,\r\n    time,\r\n    value,\r\n    status,\r\n    index,\r\n    className,\r\n    obj,\r\n    onSetKey,\r\n    setKey,\r\n  } = props;\r\n  //成功 SUCCESS\r\n  //失败 FAILURE\r\n  //未审核 UNREVIEWED\r\n  //出款中 WITHDRAWING\r\n  //已审核 AUDITED\r\n  //汇款中 REMITTANCE\r\n\r\n  let statusText = \"\";\r\n  let classStatus = \"\";\r\n  let cancel = false;\r\n  let fail = false;\r\n  if (status === \"成功\") {\r\n    statusText = \"成功\";\r\n    classStatus = \"success\";\r\n  }\r\n\r\n  if (status === \"失败\") {\r\n    statusText = \"失败\";\r\n    classStatus = \"failure\";\r\n    fail = true;\r\n  }\r\n\r\n  if (status === \"未审核\") {\r\n    statusText = \"未审核\";\r\n    classStatus = \"unreviewed\";\r\n    cancel = true;\r\n  }\r\n\r\n  if (status === \"出款中\") {\r\n    statusText = \"出款中\";\r\n    classStatus = \"withdrawing\";\r\n  }\r\n\r\n  if (status === \"汇款中\") {\r\n    statusText = \"汇款中\";\r\n    classStatus = \"remittance\";\r\n  }\r\n\r\n  // if(status === \"已审核\"){\r\n  // \tstatusText = \"已审核\"\r\n  // \tclassStatus = \"audited\"\r\n  // }\r\n\r\n  return (\r\n    <div\r\n      className={`withdrawal-history-card-item ${className ? className : \"\"}`}\r\n    >\r\n      <div className=\"cl-item withdrawal-history-card-text\">\r\n        <p className=\"cl-card-text\">{label}</p>\r\n        <p className=\"cl-card-time\">{time}</p>\r\n      </div>\r\n      <div className=\"cl-item withdrawal-history-card-value\">\r\n        {cancel && (\r\n          <span className=\"cancel\" onClick={() => props.onCancel(obj)}>\r\n            取消提款\r\n          </span>\r\n        )}\r\n        <p className=\"cl-card-amount\">\r\n          金额: <span>{value}</span>\r\n        </p>\r\n        <p className={`cl-card-status ${classStatus}`}>\r\n          <span>\r\n            {statusText}\r\n            {fail && (\r\n              <span className=\"fail\" onClick={() => onSetKey(index)}>\r\n                {setKey === index && <span>{obj.verifyComment}</span>}\r\n                <i />\r\n              </span>\r\n            )}\r\n          </span>\r\n        </p>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst WithdrawalHistory = () => {\r\n  const [key, setKey] = useState(null);\r\n\r\n  const [items, setItems] = useState({\r\n    status: 0,\r\n    list: [],\r\n  });\r\n  const [load, setLoad] = useState(false);\r\n\r\n  const [range, setRange] = useState(\"today\");\r\n  const [customRange, setCustomRange] = useState({\r\n    from: moment().subtract(30, \"days\").toDate(),\r\n    to: moment().toDate(),\r\n  });\r\n\r\n  useEffect(() => {\r\n    const fetch = () => {\r\n      const response = Transaction.read({\r\n        ...User.read(),\r\n        record_type: \"debit\",\r\n      });\r\n\r\n      response.promise.then(\r\n        (result) => {\r\n          // console.log(result);\r\n          if (result.status === 1) {\r\n            // setItems(result.info);\r\n            setItems({\r\n              status: 1,\r\n              list: result.info.map((t) => ({\r\n                ...t,\r\n                ts: toDate(t.requestTime, true),\r\n              })),\r\n            });\r\n            setLoad(false);\r\n          }\r\n        },\r\n        (e) => {\r\n          console.log(\"Unable to response:\", e);\r\n        }\r\n      );\r\n    };\r\n    fetch();\r\n  }, [load]);\r\n\r\n  const onCancel = async (w) => {\r\n    console.log(w);\r\n    // const r = await Service.User.withdrawCancel({ id: w.id }).promise;\r\n    const response = await User.withdrawCancel({ id: w.id }).promise;\r\n    // console.log(response);\r\n    if (response.status === 1) {\r\n      setLoad(true);\r\n    }\r\n  };\r\n\r\n  const onSetKey = (value) => {\r\n    setKey(null);\r\n    if (key !== value) setKey(value);\r\n  };\r\n\r\n  const history = useHistory();\r\n\r\n  const __withdraws = useMemo(() => {\r\n    const _rangeMap = {\r\n      today: () => {\r\n        const today = moment();\r\n        return [today.startOf(\"day\").unix(), today.endOf(\"day\").unix()];\r\n      },\r\n      yesterday: () => {\r\n        const yesterday = moment().subtract(1, \"days\");\r\n        return [yesterday.startOf(\"day\").unix(), yesterday.endOf(\"day\").unix()];\r\n      },\r\n      week: () => {\r\n        return [\r\n          moment().subtract(1, \"weeks\").startOf(\"day\").unix(),\r\n          moment().endOf(\"day\").unix(),\r\n        ];\r\n      },\r\n      month: () => {\r\n        return [\r\n          moment().subtract(30, \"days\").startOf(\"day\").unix(),\r\n          moment().endOf(\"day\").unix(),\r\n        ];\r\n      },\r\n      custom: () => {\r\n        let { from, to } = customRange;\r\n        return [\r\n          moment(from).startOf(\"day\").unix(),\r\n          moment(to).endOf(\"day\").unix(),\r\n        ];\r\n      },\r\n    };\r\n\r\n    const [from, to] = _rangeMap[range]();\r\n\r\n    // return withdraws.list.filter((t) => t.ts >= from && t.ts < to);\r\n    return filter(items.list, (t) => t.ts >= from && t.ts < to);\r\n  }, [items.list, customRange, range]);\r\n\r\n  // console.log(__withdraws)\r\n\r\n  return (\r\n    <Wrap\r\n      className=\"withdrawal-history-wrap\"\r\n      centerName=\"提款记录\"\r\n      sublevel={[true, () => history.goBack()]}\r\n    >\r\n      <div className=\"withdrawal-history-wrap-inner\">\r\n        <div className=\"withdrawal-history-wrap-inner-content\">\r\n          <div className=\"withdrawal-history-card\">\r\n            <div className=\"withdrawal-history-card-head\">\r\n              <div className=\"withdrawal-history-card-title\">\r\n                <span>最近30天</span>\r\n                <i\r\n                  className={load ? \"reload\" : \"\"}\r\n                  onClick={() => setLoad(true)}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"withdrawal-history-card-body\">\r\n              {/* ITEM */}\r\n              {__withdraws && __withdraws.length > 0 ? (\r\n                map(__withdraws, (obj, i) => {\r\n                  return (\r\n                    <CardItem\r\n                      obj={obj}\r\n                      key={i}\r\n                      index={i}\r\n                      label={obj.cardNumber}\r\n                      time={obj.requestTime}\r\n                      value={obj.amount}\r\n                      status={obj.status}\r\n                      onCancel={(val) => onCancel(val)}\r\n                      onSetKey={(val) => onSetKey(val)}\r\n                      setKey={key}\r\n                    />\r\n                  );\r\n                })\r\n              ) : (\r\n                <div className=\"no-transactions\">\r\n                  <div className=\"image-box\" />\r\n                  <span>暂无记录</span>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </Wrap>\r\n  );\r\n};\r\n\r\nexport default withAuth(WithdrawalHistory, 1);\r\n"]},"metadata":{},"sourceType":"module"}