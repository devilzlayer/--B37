{"ast":null,"code":"var _jsxFileName = \"/Users/cramj/Documents/New PWA/ubet-project (1)/src/pwa/view/Game.js\";\nimport React, { useState, useEffect, useContext } from \"react\";\nimport { useParams, useHistory, useLocation } from \"react-router-dom\";\nimport Picker from \"react-mobile-picker\";\nimport ReactSlider from \"react-slider\";\nimport cx from \"classnames\";\nimport BigNumber from \"bignumber.js\";\nimport useClickOutside from \"click-outside-hook\";\nimport { withAuth } from \"../util/\";\nimport { Icon } from \"../../component/\";\nimport { User, Game as Service } from \"../../service/\";\nimport \"../assets/scss/GameSA.scss\";\nconst externals = [1204, 1209, 1211];\n\nfunction Game() {\n  const history = useHistory();\n  const {\n    search\n  } = useLocation(); // eslint-disable-next-line\n\n  const [fromHome, setFromHome] = useState(search.includes(\"from_home=1\"));\n  useEffect(() => {\n    if (fromHome) {\n      history.replace({\n        search: \"\"\n      });\n    }\n  }, [history, fromHome]);\n  const [loading, setLoading] = useState(false);\n  const {\n    userAuth,\n    setUserAuthFN\n  } = useContext(User.Context);\n  const {\n    id,\n    name\n  } = useParams();\n  const isExternal = externals.includes(+id);\n  const [message, setMessage] = useState({});\n  const [iframe, setIframe] = useState(null);\n  const [iframeI, setIframeI] = useState(0);\n  const [fullScreen, setFullScreen] = useState(false);\n  const [overlayState, setOverlayState] = useState(false);\n  const refClickOut = useClickOutside(() => setOverlayState(false));\n  const [balances, setBalances] = useState([]);\n  const [balanceTransferred, setBalanceTransferred] = useState(false);\n  const [balanceUpdateI, setBalanceUpdateI] = useState(0);\n  const [balanceLoad, setBalanceLoad] = useState(false);\n  const [balancesMap, setBalancesMap] = useState({});\n  const [balanceOver, setBalanceOver] = useState(null);\n  const [balanceForm, setBalanceForm] = useState({\n    from: \"中央钱包\",\n    to: name,\n    amount: \"\"\n  });\n  const [sliderPercent, setSliderPercent] = useState(0);\n  const [balanceCurrent, setBalanceCurrent] = useState({\n    name: \"\",\n    balance: 0\n  });\n\n  const goBack = () => history.push(\"/\");\n\n  const refresh = () => setIframeI(iframeI + 1);\n\n  const [focHeight, setFocHeight] = useState([]);\n  useEffect(() => {\n    const {\n      innerHeight: height\n    } = window;\n    setFocHeight(height);\n    window.scrollTo(0, 0);\n  }, []);\n  useEffect(() => {\n    if (isExternal) {\n      return () => {};\n    }\n\n    setBalances([]);\n    setBalancesMap({});\n    setBalanceCurrent(bc => ({\n      name,\n      balance: 0\n    }));\n    Service.balances({ ...User.read()\n    }).then(_balances => {\n      const __balances = _balances.filter(b => !b.error).map(b => `${b.game.name}: ${b.balance} ¥`);\n\n      __balances.push(`中央钱包: ${userAuth.data.balance} ¥`);\n\n      setBalanceForm(balanceForm => ({ ...balanceForm // from: __balances[0],\n        // to: __balances[1],\n\n      }));\n      setBalances(__balances);\n      const __balancesMap = {};\n\n      _balances.filter(b => !b.error).forEach(b => {\n        __balancesMap[b.game.name] = b;\n      });\n\n      __balancesMap[\"中央钱包\"] = {\n        game: {\n          id: 0,\n          name: \"wallet\"\n        },\n        wallet: true,\n        balance: userAuth.data.balance\n      };\n      setBalanceCurrent(bc => ({ ...bc,\n        balance: __balancesMap[name].balance\n      }));\n      setBalancesMap(__balancesMap);\n    });\n  }, [balanceUpdateI, userAuth.data.balance, isExternal, name]);\n  useEffect(() => {\n    setLoading(true);\n    const user = User.read();\n    const req = Service.activate({\n      num: 1,\n      type: \"active\",\n      gameid: id,\n      ...user\n    });\n\n    function LogIn() {\n      Service.login({\n        num: 1,\n        gameid: id,\n        ...user\n      }).promise.then(r => {\n        if (!isExternal) {\n          setLoading(false);\n          setIframe(r.info);\n        } else {\n          if (fromHome) {\n            window.location.href = r.info;\n          } else {\n            history.push(\"/\");\n          }\n        }\n      }, e => {\n        console.error(\"Unable to login to the game\", e);\n      });\n    }\n\n    req.promise.then(r => {\n      console.log(r);\n      LogIn();\n    }, e => {\n      if (!e.is_aborted) {\n        console.error(\"Unable to activate the game:\", e);\n        LogIn();\n      }\n    });\n    return () => req.cancel();\n  }, [id, history, fromHome, isExternal]);\n  useEffect(() => {\n    document.body.style.overflow = balanceOver ? \"hidden\" : \"auto\";\n    return () => {\n      document.body.style.overflow = \"auto\";\n    };\n  }, [balanceOver]);\n\n  const PickerWrap = ({\n    dist\n  }) => /*#__PURE__*/React.createElement(\"div\", {\n    className: \"picker-wrap\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 5\n    }\n  }, balances.length ? /*#__PURE__*/React.createElement(Picker, {\n    height: 120,\n    valueGroups: {\n      [dist]: balanceForm[dist]\n    },\n    optionGroups: {\n      [dist]: balances\n    },\n    onChange: (key, value) => setBalanceForm({ ...balanceForm,\n      [key]: value\n    }),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 9\n    }\n  }) : null);\n\n  const setAmount = e => {\n    // console.log(e.target.validity.valid);\n    const amount = e.target ? e.target.value : e;\n    const percent = +BigNumber(amount / userAuth.data.balance * 100).toFixed(0);\n    setBalanceForm(form => ({ ...form,\n      amount\n    }));\n    setSliderPercent(percent);\n  };\n\n  const transfer = e => {\n    if (!balanceForm.amount || isNaN(+balanceForm.amount)) {\n      return void console.warn(\"[transfer] No amount\");\n    }\n\n    const _getMap = n => balancesMap[n.split(\": \")[0]] || null;\n\n    const _from = _getMap(balanceForm.from);\n\n    const _to = _getMap(balanceForm.to);\n\n    if (_from.game.id === _to.game.id) {\n      return void console.warn(\"[transfer] Same game\");\n    }\n\n    if (_from.balance === 0) {\n      return void console.warn(\"[transfer] Zero balance\");\n    }\n\n    if (_from.balance < +balanceForm.amount) {\n      return void console.warn(\"[transfer] Not enough game balance\");\n    }\n\n    console.info(`You're transfering ${balanceForm.amount} ¥ from ${_from.game.name} to ${_to.game.name}`);\n    balanceForm.amount = BigNumber(balanceForm.amount).toFixed(0);\n    setBalanceLoad(true);\n    Service.transfer({ ...User.read(),\n      amount: +balanceForm.amount,\n      from: _from.game.id,\n      to: _to.game.id\n    }).then(r => {\n      console.info(`You have successfully transferred ${balanceForm.amount} ¥ from ${_from.game.name} to ${_to.game.name}: ${r.info}`);\n      setMessage({\n        title: '转账成功',\n        valid: true\n      });\n      setBalanceLoad(false);\n      setBalanceTransferred(true);\n    }, e => {\n      console.error(e);\n      setMessage({\n        title: '系统提示',\n        message: e\n      });\n      setBalanceLoad(false);\n      setBalanceTransferred(true);\n    });\n  };\n\n  const finishTransfer = () => {\n    setOverlayState(false);\n    setBalanceTransferred(false);\n    setBalanceForm(bf => ({ ...bf,\n      amount: \"\"\n    }));\n    setSliderPercent(0);\n    setBalanceUpdateI(i => i + 1);\n    User.session({ ...User.read()\n    }).promise.then(r => setUserAuthFN(1, r.info));\n  };\n\n  const onlyNumbers = e => {\n    const {\n      value\n    } = e.currentTarget;\n    let regexp = /^[0-9\\b]+$/;\n\n    if (!value || regexp.test(value)) {\n      setAmount(value);\n    }\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: cx(\"game-sa\", \"with-loader\", {\n      loading: loading,\n      \"full-screen\": fullScreen\n    }),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 315,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    className: \"full-screen-exit\",\n    onClick: () => setFullScreen(false),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 321,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"i\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 323,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"load-spin\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 325,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: cx(\"game-sa-head\", {\n      hidden: fullScreen\n    }),\n    style: isExternal ? {\n      display: \"none\"\n    } : {},\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 326,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sa-head-left\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 330,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    onClick: goBack,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 331,\n      columnNumber: 11\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sa-head-middle\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 333,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"h1\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 334,\n      columnNumber: 11\n    }\n  }, name)), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sa-head-right\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 336,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    className: \"balance\",\n    onClick: e => setOverlayState(true),\n    disabled: !balances.length,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 337,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"i\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 343,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(\"button\", {\n    className: \"refresh\",\n    onClick: refresh,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 345,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"i\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 347,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(\"button\", {\n    className: \"full-screen\",\n    onClick: () => setFullScreen(true),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 349,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"i\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 351,\n      columnNumber: 13\n    }\n  })))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"game-sa-content\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 356,\n      columnNumber: 7\n    }\n  }, iframe ? /*#__PURE__*/React.createElement(\"iframe\", {\n    key: iframeI,\n    title: `IFRAME-N${id}`,\n    src: iframe,\n    style: {\n      height: fullScreen ? focHeight : focHeight - 60\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 358,\n      columnNumber: 11\n    }\n  }) : null), /*#__PURE__*/React.createElement(\"div\", {\n    className: `game-sa-overlay${overlayState ? \" shown\" : \"\"}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 368,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"overlay-sublayer\",\n    ref: refClickOut,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 369,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: `overlay-layer with-loader${balanceLoad ? \" loading\" : \"\"}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 370,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"load-spin\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 371,\n      columnNumber: 13\n    }\n  }), balanceTransferred ? /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form response\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 373,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form-head not-message\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 374,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"h2\", {\n    className: !message.valid ? 'hide' : '',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 375,\n      columnNumber: 19\n    }\n  }, message.title), /*#__PURE__*/React.createElement(\"button\", {\n    className: \"close\",\n    onClick: finishTransfer,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 376,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(Icon, {\n    name: \"close-circle-sharp\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 377,\n      columnNumber: 21\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form-body not-message\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 380,\n      columnNumber: 17\n    }\n  }, message.message && /*#__PURE__*/React.createElement(\"p\", {\n    className: \"game-transfer-p\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 381,\n      columnNumber: 39\n    }\n  }, message.message), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form-submit\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 382,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    onClick: finishTransfer,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 383,\n      columnNumber: 21\n    }\n  }, \"\\u786E\\u8BA4\")))) : /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 388,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form-head\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 389,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"h2\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 390,\n      columnNumber: 19\n    }\n  }, \"\\u8F6C\\u8D26\"), /*#__PURE__*/React.createElement(\"button\", {\n    className: \"close\",\n    onClick: e => setOverlayState(false),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 391,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(Icon, {\n    name: \"close-circle-sharp\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 395,\n      columnNumber: 21\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form-body\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 398,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form-body-wrap\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 399,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form-field transfer-wrap\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 400,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"transfer--item\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 401,\n      columnNumber: 23\n    }\n  }, /*#__PURE__*/React.createElement(\"p\", {\n    className: \"title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 402,\n      columnNumber: 25\n    }\n  }, \"\\u8F6C\\u51FA\\u94B1\\u5305\"), /*#__PURE__*/React.createElement(\"p\", {\n    className: \"game\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 403,\n      columnNumber: 25\n    }\n  }, \"\\u4E2D\\u592E\\u94B1\\u5305\"), /*#__PURE__*/React.createElement(\"p\", {\n    className: \"balance\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 404,\n      columnNumber: 25\n    }\n  }, BigNumber(userAuth.data.balance).toFormat(2))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"transfer--item icon\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 408,\n      columnNumber: 23\n    }\n  }, /*#__PURE__*/React.createElement(Icon, {\n    name: \"arrow-left\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 409,\n      columnNumber: 25\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"transfer--item\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 411,\n      columnNumber: 23\n    }\n  }, /*#__PURE__*/React.createElement(\"p\", {\n    className: \"title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 412,\n      columnNumber: 25\n    }\n  }, \"\\u8F6C\\u5165\\u94B1\\u5305\"), /*#__PURE__*/React.createElement(\"p\", {\n    className: \"game\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 413,\n      columnNumber: 25\n    }\n  }, balanceCurrent.name), /*#__PURE__*/React.createElement(\"p\", {\n    className: \"balance\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 414,\n      columnNumber: 25\n    }\n  }, BigNumber(balanceCurrent.balance).toFormat(2)))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form-field\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 419,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"slider-wrap\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 420,\n      columnNumber: 23\n    }\n  }, /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 421,\n      columnNumber: 25\n    }\n  }, \"0\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"slider-subwrap\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 422,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(ReactSlider, {\n    className: \"slider-picker\",\n    thumbClassName: \"thumb\",\n    trackClassName: \"track\",\n    value: sliderPercent,\n    onChange: percent => {\n      const amount = BigNumber(percent * userAuth.data.balance / 100).toFixed(0);\n      setSliderPercent(percent);\n      setBalanceForm(bf => ({ ...bf,\n        amount\n      }));\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 423,\n      columnNumber: 27\n    }\n  })), /*#__PURE__*/React.createElement(\"p\", {\n    onClick: () => {\n      const amount = BigNumber(userAuth.data.balance).toFixed(0);\n      setSliderPercent(100);\n      setBalanceForm(bf => ({ ...bf,\n        amount\n      }));\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 440,\n      columnNumber: 25\n    }\n  }, \"MAX\"))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form-field\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 457,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    htmlFor: \"amount\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 458,\n      columnNumber: 23\n    }\n  }, \"\\u91D1\\u989D/\\u8F6C\\u5165\\u91D1\\u989D\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"input--wrap\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 459,\n      columnNumber: 23\n    }\n  }, /*#__PURE__*/React.createElement(\"input\", {\n    id: \"amount\",\n    type: \"text\",\n    placeholder: \"0.00\",\n    pattern: \"[0-9]*\",\n    value: balanceForm.amount,\n    onChange: e => onlyNumbers(e),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 460,\n      columnNumber: 25\n    }\n  })))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form-submit\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 471,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    onClick: transfer,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 472,\n      columnNumber: 21\n    }\n  }, \"\\u7ACB\\u5373\\u8F6C\\u8D26\"))))))), /*#__PURE__*/React.createElement(\"div\", {\n    className: `game-sa-overlay picker-over${balanceOver ? \" shown\" : \"\"}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 480,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"picker-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 481,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"picker-head\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 482,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    onClick: e => setBalanceOver(null),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 483,\n      columnNumber: 13\n    }\n  }, \"\\u53D6\\u6D88\"), /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 484,\n      columnNumber: 13\n    }\n  }, balanceOver === \"from\" ? \"推出\" : \"进入\"), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: e => setBalanceOver(null),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 485,\n      columnNumber: 13\n    }\n  }, \"\\u786E\\u5B9A\")), balanceOver ? /*#__PURE__*/React.createElement(PickerWrap, {\n    dist: balanceOver,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 487,\n      columnNumber: 26\n    }\n  }) : null)));\n}\n\nexport default withAuth(Game, 1);","map":{"version":3,"sources":["/Users/cramj/Documents/New PWA/ubet-project (1)/src/pwa/view/Game.js"],"names":["React","useState","useEffect","useContext","useParams","useHistory","useLocation","Picker","ReactSlider","cx","BigNumber","useClickOutside","withAuth","Icon","User","Game","Service","externals","history","search","fromHome","setFromHome","includes","replace","loading","setLoading","userAuth","setUserAuthFN","Context","id","name","isExternal","message","setMessage","iframe","setIframe","iframeI","setIframeI","fullScreen","setFullScreen","overlayState","setOverlayState","refClickOut","balances","setBalances","balanceTransferred","setBalanceTransferred","balanceUpdateI","setBalanceUpdateI","balanceLoad","setBalanceLoad","balancesMap","setBalancesMap","balanceOver","setBalanceOver","balanceForm","setBalanceForm","from","to","amount","sliderPercent","setSliderPercent","balanceCurrent","setBalanceCurrent","balance","goBack","push","refresh","focHeight","setFocHeight","innerHeight","height","window","scrollTo","bc","read","then","_balances","__balances","filter","b","error","map","game","data","__balancesMap","forEach","wallet","user","req","activate","num","type","gameid","LogIn","login","promise","r","info","location","href","e","console","log","is_aborted","cancel","document","body","style","overflow","PickerWrap","dist","length","key","value","setAmount","target","percent","toFixed","form","transfer","isNaN","warn","_getMap","n","split","_from","_to","title","valid","finishTransfer","bf","i","session","onlyNumbers","currentTarget","regexp","test","hidden","display","toFormat"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useContext } from \"react\";\r\nimport { useParams, useHistory, useLocation } from \"react-router-dom\";\r\nimport Picker from \"react-mobile-picker\";\r\nimport ReactSlider from \"react-slider\";\r\nimport cx from \"classnames\";\r\nimport BigNumber from \"bignumber.js\";\r\nimport useClickOutside from \"click-outside-hook\";\r\n\r\nimport { withAuth } from \"../util/\";\r\nimport { Icon } from \"../../component/\";\r\nimport { User, Game as Service } from \"../../service/\";\r\n\r\nimport \"../assets/scss/GameSA.scss\";\r\n\r\nconst externals = [1204, 1209, 1211];\r\n\r\nfunction Game() {\r\n  const history = useHistory();\r\n\r\n  const { search } = useLocation();\r\n  // eslint-disable-next-line\r\n  const [fromHome, setFromHome] = useState(search.includes(\"from_home=1\"));\r\n\r\n  useEffect(() => {\r\n    if (fromHome) {\r\n      history.replace({ search: \"\" });\r\n    }\r\n  }, [history, fromHome]);\r\n\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const { userAuth, setUserAuthFN } = useContext(User.Context);\r\n\r\n  const { id, name } = useParams();\r\n  const isExternal = externals.includes(+id);\r\n\r\n  const [message , setMessage] = useState({});\r\n  const [iframe, setIframe] = useState(null);\r\n  const [iframeI, setIframeI] = useState(0);\r\n\r\n  const [fullScreen, setFullScreen] = useState(false);\r\n\r\n  const [overlayState, setOverlayState] = useState(false);\r\n\r\n  const refClickOut = useClickOutside(() => setOverlayState(false));\r\n\r\n  const [balances, setBalances] = useState([]);\r\n  const [balanceTransferred, setBalanceTransferred] = useState(false);\r\n  const [balanceUpdateI, setBalanceUpdateI] = useState(0);\r\n  const [balanceLoad, setBalanceLoad] = useState(false);\r\n  const [balancesMap, setBalancesMap] = useState({});\r\n  const [balanceOver, setBalanceOver] = useState(null);\r\n  const [balanceForm, setBalanceForm] = useState({\r\n    from: \"中央钱包\",\r\n    to: name,\r\n    amount: \"\",\r\n  });\r\n\r\n  const [sliderPercent, setSliderPercent] = useState(0);\r\n\r\n  const [balanceCurrent, setBalanceCurrent] = useState({\r\n    name: \"\",\r\n    balance: 0,\r\n  });\r\n\r\n  const goBack = () => history.push(\"/\");\r\n\r\n  const refresh = () => setIframeI(iframeI + 1);\r\n\r\n  const [focHeight, setFocHeight] = useState([]);\r\n\r\n  useEffect(() => {\r\n    const { innerHeight: height } = window;\r\n    setFocHeight(height);\r\n    window.scrollTo(0, 0);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (isExternal) {\r\n      return () => {};\r\n    }\r\n\r\n    setBalances([]);\r\n    setBalancesMap({});\r\n\r\n    setBalanceCurrent((bc) => ({\r\n      name,\r\n      balance: 0,\r\n    }));\r\n\r\n    Service.balances({\r\n      ...User.read(),\r\n    }).then((_balances) => {\r\n      const __balances = _balances\r\n        .filter((b) => !b.error)\r\n        .map((b) => `${b.game.name}: ${b.balance} ¥`);\r\n      __balances.push(`中央钱包: ${userAuth.data.balance} ¥`);\r\n\r\n      setBalanceForm((balanceForm) => ({\r\n        ...balanceForm,\r\n        // from: __balances[0],\r\n        // to: __balances[1],\r\n      }));\r\n\r\n      setBalances(__balances);\r\n\r\n      const __balancesMap = {};\r\n\r\n      _balances\r\n        .filter((b) => !b.error)\r\n        .forEach((b) => {\r\n          __balancesMap[b.game.name] = b;\r\n        });\r\n\r\n      __balancesMap[\"中央钱包\"] = {\r\n        game: {\r\n          id: 0,\r\n          name: \"wallet\",\r\n        },\r\n        wallet: true,\r\n        balance: userAuth.data.balance,\r\n      };\r\n\r\n      setBalanceCurrent((bc) => ({\r\n        ...bc,\r\n        balance: __balancesMap[name].balance,\r\n      }));\r\n\r\n      setBalancesMap(__balancesMap);\r\n    });\r\n  }, [balanceUpdateI, userAuth.data.balance, isExternal, name]);\r\n\r\n  useEffect(() => {\r\n    setLoading(true);\r\n\r\n    const user = User.read();\r\n\r\n    const req = Service.activate({\r\n      num: 1,\r\n      type: \"active\",\r\n      gameid: id,\r\n      ...user,\r\n    });\r\n\r\n    function LogIn() {\r\n      Service.login({\r\n        num: 1,\r\n        gameid: id,\r\n        ...user,\r\n      }).promise.then(\r\n        (r) => {\r\n          if (!isExternal) {\r\n            setLoading(false);\r\n\r\n            setIframe(r.info);\r\n          } else {\r\n            if (fromHome) {\r\n              window.location.href = r.info;\r\n            } else {\r\n              history.push(\"/\");\r\n            }\r\n          }\r\n        },\r\n        (e) => {\r\n          console.error(\"Unable to login to the game\", e);\r\n        }\r\n      );\r\n    }\r\n\r\n    req.promise.then(\r\n      (r) => {\r\n        console.log(r);\r\n\r\n        LogIn();\r\n      },\r\n      (e) => {\r\n        if (!e.is_aborted) {\r\n          console.error(\"Unable to activate the game:\", e);\r\n\r\n          LogIn();\r\n        }\r\n      }\r\n    );\r\n\r\n    return () => req.cancel();\r\n  }, [id, history, fromHome, isExternal]);\r\n\r\n  useEffect(() => {\r\n    document.body.style.overflow = balanceOver ? \"hidden\" : \"auto\";\r\n\r\n    return () => {\r\n      document.body.style.overflow = \"auto\";\r\n    };\r\n  }, [balanceOver]);\r\n\r\n  const PickerWrap = ({ dist }) => (\r\n    <div className=\"picker-wrap\">\r\n      {balances.length ? (\r\n        <Picker\r\n          height={120}\r\n          valueGroups={{ [dist]: balanceForm[dist] }}\r\n          optionGroups={{ [dist]: balances }}\r\n          onChange={(key, value) =>\r\n            setBalanceForm({ ...balanceForm, [key]: value })\r\n          }\r\n        />\r\n      ) : null}\r\n    </div>\r\n  );\r\n\r\n  const setAmount = (e) => {\r\n    // console.log(e.target.validity.valid);\r\n\r\n    const amount = e.target ? e.target.value : e;\r\n    const percent = +BigNumber((amount / userAuth.data.balance) * 100).toFixed(\r\n      0\r\n    );\r\n\r\n    setBalanceForm((form) => ({ ...form, amount }));\r\n    setSliderPercent(percent);\r\n  };\r\n\r\n  const transfer = (e) => {\r\n    if (!balanceForm.amount || isNaN(+balanceForm.amount)) {\r\n      return void console.warn(\"[transfer] No amount\");\r\n    }\r\n\r\n    const _getMap = (n) => balancesMap[n.split(\": \")[0]] || null;\r\n\r\n    const _from = _getMap(balanceForm.from);\r\n    const _to = _getMap(balanceForm.to);\r\n\r\n    if (_from.game.id === _to.game.id) {\r\n      return void console.warn(\"[transfer] Same game\");\r\n    }\r\n\r\n    if (_from.balance === 0) {\r\n      return void console.warn(\"[transfer] Zero balance\");\r\n    }\r\n\r\n    if (_from.balance < +balanceForm.amount) {\r\n      return void console.warn(\"[transfer] Not enough game balance\");\r\n    }\r\n\r\n    console.info(\r\n      `You're transfering ${balanceForm.amount} ¥ from ${_from.game.name} to ${_to.game.name}`\r\n    );\r\n\r\n    balanceForm.amount = BigNumber(balanceForm.amount).toFixed(0);\r\n\r\n    setBalanceLoad(true);\r\n\r\n    Service.transfer({\r\n      ...User.read(),\r\n      amount: +balanceForm.amount,\r\n      from: _from.game.id,\r\n      to: _to.game.id,\r\n    }).then(\r\n      (r) => {\r\n        console.info(\r\n          `You have successfully transferred ${balanceForm.amount} ¥ from ${_from.game.name} to ${_to.game.name}: ${r.info}`\r\n        );\r\n\r\n        setMessage({\r\n          title: '转账成功',\r\n          valid: true,\r\n        })\r\n        setBalanceLoad(false);\r\n\r\n        setBalanceTransferred(true);\r\n      },\r\n      (e) => {\r\n        console.error(e);\r\n        setMessage({\r\n          title : '系统提示',\r\n          message: e,\r\n        })\r\n        setBalanceLoad(false);\r\n        setBalanceTransferred(true);\r\n      }\r\n    );\r\n  };\r\n\r\n  const finishTransfer = () => {\r\n    setOverlayState(false);\r\n\r\n    setBalanceTransferred(false);\r\n\r\n    setBalanceForm((bf) => ({\r\n      ...bf,\r\n      amount: \"\",\r\n    }));\r\n\r\n    setSliderPercent(0);\r\n\r\n    setBalanceUpdateI((i) => i + 1);\r\n\r\n    User.session({\r\n      ...User.read(),\r\n    }).promise.then((r) => setUserAuthFN(1, r.info));\r\n  };\r\n\r\n\r\n  const onlyNumbers = (e) => {\r\n    const { value } = e.currentTarget\r\n    let regexp  = /^[0-9\\b]+$/\r\n    if (!value || regexp.test(value)) {\r\n      setAmount(value);\r\n    }\r\n\r\n  };\r\n\r\n\r\n  return (\r\n    <div\r\n      className={cx(\"game-sa\", \"with-loader\", {\r\n        loading: loading,\r\n        \"full-screen\": fullScreen,\r\n      })}\r\n    >\r\n      <button className=\"full-screen-exit\" onClick={() => setFullScreen(false)}>\r\n        {/* <Icon name=\"close-circle-sharp\" /> */}\r\n        <i />\r\n      </button>\r\n      <div className=\"load-spin\"></div>\r\n      <div\r\n        className={cx(\"game-sa-head\", { hidden: fullScreen })}\r\n        style={isExternal ? { display: \"none\" } : {}}\r\n      >\r\n        <div className=\"sa-head-left\">\r\n          <button onClick={goBack}>{/* <Icon name=\"arrow-left\" /> */}</button>\r\n        </div>\r\n        <div className=\"sa-head-middle\">\r\n          <h1>{name}</h1>\r\n        </div>\r\n        <div className=\"sa-head-right\">\r\n          <button\r\n            className=\"balance\"\r\n            onClick={(e) => setOverlayState(true)}\r\n            disabled={!balances.length}\r\n          >\r\n            {/* <Icon name=\"balance\" /> */}\r\n            <i />\r\n          </button>\r\n          <button className=\"refresh\" onClick={refresh}>\r\n            {/* <Icon name=\"refresh\" /> */}\r\n            <i />\r\n          </button>\r\n          <button className=\"full-screen\" onClick={() => setFullScreen(true)}>\r\n            {/* <Icon name=\"full-screen\" /> */}\r\n            <i />\r\n          </button>\r\n        </div>\r\n      </div>\r\n      {/* =================================== IFRAME =================================== */}\r\n      <div className=\"game-sa-content\">\r\n        {iframe ? (\r\n          <iframe\r\n            key={iframeI}\r\n            title={`IFRAME-N${id}`}\r\n            src={iframe}\r\n            style={{ height: fullScreen ? focHeight : focHeight - 60 }}\r\n          ></iframe>\r\n        ) : null}\r\n      </div>\r\n      {/* =================================== IFRAME =================================== */}\r\n\r\n      <div className={`game-sa-overlay${overlayState ? \" shown\" : \"\"}`}>\r\n        <div className=\"overlay-sublayer\" ref={refClickOut}>\r\n          <div className={`overlay-layer with-loader${balanceLoad ? \" loading\" : \"\"}`}>\r\n            <div className=\"load-spin\"></div>\r\n            {balanceTransferred ? (\r\n              <div className=\"form response\">\r\n                <div className=\"form-head not-message\">\r\n                  <h2 className={!message.valid ? 'hide' : ''}>{message.title}</h2>\r\n                  <button className=\"close\" onClick={finishTransfer}>\r\n                    <Icon name=\"close-circle-sharp\" />\r\n                  </button>\r\n                </div>\r\n                <div className=\"form-body not-message\">\r\n                  {message.message && <p className=\"game-transfer-p\">{message.message}</p>}\r\n                  <div className=\"form-submit\">\r\n                    <button onClick={finishTransfer}>确认</button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              <div className=\"form\">\r\n                <div className=\"form-head\">\r\n                  <h2>转账</h2>\r\n                  <button\r\n                    className=\"close\"\r\n                    onClick={(e) => setOverlayState(false)}\r\n                  >\r\n                    <Icon name=\"close-circle-sharp\" />\r\n                  </button>\r\n                </div>\r\n                <div className=\"form-body\">\r\n                  <div className=\"form-body-wrap\">\r\n                    <div className=\"form-field transfer-wrap\">\r\n                      <div className=\"transfer--item\">\r\n                        <p className=\"title\">转出钱包</p>\r\n                        <p className=\"game\">中央钱包</p>\r\n                        <p className=\"balance\">\r\n                          {BigNumber(userAuth.data.balance).toFormat(2)}\r\n                        </p>\r\n                      </div>\r\n                      <div className=\"transfer--item icon\">\r\n                        <Icon name=\"arrow-left\" />\r\n                      </div>\r\n                      <div className=\"transfer--item\">\r\n                        <p className=\"title\">转入钱包</p>\r\n                        <p className=\"game\">{balanceCurrent.name}</p>\r\n                        <p className=\"balance\">\r\n                          {BigNumber(balanceCurrent.balance).toFormat(2)}\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"form-field\">\r\n                      <div className=\"slider-wrap\">\r\n                        <p>0</p>\r\n                        <div className=\"slider-subwrap\">\r\n                          <ReactSlider\r\n                            className=\"slider-picker\"\r\n                            thumbClassName=\"thumb\"\r\n                            trackClassName=\"track\"\r\n                            value={sliderPercent}\r\n                            onChange={(percent) => {\r\n                              const amount = BigNumber(\r\n                                (percent * userAuth.data.balance) / 100\r\n                              ).toFixed(0);\r\n                              setSliderPercent(percent);\r\n                              setBalanceForm((bf) => ({\r\n                                ...bf,\r\n                                amount,\r\n                              }));\r\n                            }}\r\n                          />\r\n                        </div>\r\n                        <p\r\n                          onClick={() => {\r\n                            const amount = BigNumber(\r\n                              userAuth.data.balance\r\n                            ).toFixed(0);\r\n\r\n                            setSliderPercent(100);\r\n                            setBalanceForm((bf) => ({\r\n                              ...bf,\r\n                              amount,\r\n                            }));\r\n                          }}\r\n                        >\r\n                          MAX\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"form-field\">\r\n                      <label htmlFor=\"amount\">金额/转入金额</label>\r\n                      <div className=\"input--wrap\">\r\n                        <input\r\n                          id=\"amount\"\r\n                          type=\"text\"\r\n                          placeholder=\"0.00\"\r\n                          pattern=\"[0-9]*\"\r\n                          value={balanceForm.amount}\r\n                          onChange={(e) => onlyNumbers(e)}\r\n                        />\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"form-submit\">\r\n                    <button onClick={transfer}>立即转账</button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div className={`game-sa-overlay picker-over${balanceOver ? \" shown\" : \"\"}`}>\r\n        <div className=\"picker-container\">\r\n          <div className=\"picker-head\">\r\n            <button onClick={(e) => setBalanceOver(null)}>取消</button>\r\n            <p>{balanceOver === \"from\" ? \"推出\" : \"进入\"}</p>\r\n            <button onClick={(e) => setBalanceOver(null)}>确定</button>\r\n          </div>\r\n          {balanceOver ? <PickerWrap dist={balanceOver} /> : null}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default withAuth(Game, 1);\r\n"]},"metadata":{},"sourceType":"module"}