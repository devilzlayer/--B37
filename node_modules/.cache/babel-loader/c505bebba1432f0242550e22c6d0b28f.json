{"ast":null,"code":"import _defineProperty from\"/Users/cramj/Documents/New PWA/ubet-project (1)/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/Users/cramj/Documents/New PWA/ubet-project (1)/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/cramj/Documents/New PWA/ubet-project (1)/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useRef,useEffect}from\"react\";import{useHistory}from\"react-router-dom\";import{Wrap,Service}from\"./\";import{FormField}from\"../../../component/\";var PasswordRegular=function PasswordRegular(_ref){var setStatus=_ref.setStatus;var refpassword=useRef(null);var refpassword_new=useRef(null);var refpassword_newok=useRef(null);var oldPassword=Service.User.read().password;var _useState=useState({password:\"\",password_new:\"\",password_newok:\"\"}),_useState2=_slicedToArray(_useState,2),form=_useState2[0],setForm=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),active=_useState4[0],setActive=_useState4[1];var _useState5=useState({className:null,source:null,message:null}),_useState6=_slicedToArray(_useState5,2),message=_useState6[0],setMessage=_useState6[1];var fields=[{field:{label:\"原密码\"},input:{id:\"password\",name:\"password\",type:\"password\",required:true,placeholder:\"原密码\",ref:refpassword}},{field:{label:\"新密码\"},input:{id:\"password_new\",name:\"password_new\",type:\"password\",placeholder:\"新密码\",ref:refpassword_new}},{field:{label:\"验证新密码\"},input:{id:\"password_newok\",name:\"password_newok\",type:\"password\",placeholder:\"验证新密码\",ref:refpassword_newok}}];var notify=function notify(state,source,message){setMessage({className:state?\"valid\":\"invalid\",source:source,message:message});};useEffect(function(){if(form.password!==\"\"&&form.password_new!==\"\"&&form.password_newok!==\"\"&&form.password_new===form.password_newok&&oldPassword===form.password)setActive(true);else setActive(false);},[form,oldPassword]);var onChange=function onChange(e){var _e$target=e.target,name=_e$target.name,value=_e$target.value;if(message.message&&message.source===name){setMessage({className:null,source:null,message:null});}setForm(function(f){return _objectSpread(_objectSpread({},f),{},_defineProperty({},name,value));});};var update=function update(){if(!form.password){return void notify(false,\"password\",\"未输入当前密码!\");}if(!form.password_new){return void notify(false,\"password_new\",\"未输入新密码!\");}if(form.password_new!==form.password_newok){return void notify(false,\"password_new\",\"输入的密码不匹配!\");}setStatus(0);console.info(\"You're updating account password:\",form);Service.User.updatePassword(_objectSpread(_objectSpread({},Service.User.read()),form)).promise.then(function(r){console.info(\"✅ You have successfully updated account password:\",r.info);notify(true,\"password\",r.info);setStatus(1);},function(e){console.warn(\"Unable to update account password:\",e);notify(false,\"password\",e);setStatus(1);});};return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"fields\"},message.message?/*#__PURE__*/React.createElement(\"div\",{className:\"message \".concat(message.className)},message.message):null,fields.map(function(f,i){return/*#__PURE__*/React.createElement(FormField,{key:i,field:f.field,input:_objectSpread(_objectSpread({},f.input),{},{onChange:onChange})});})),/*#__PURE__*/React.createElement(\"div\",{className:\"submit\"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-button \".concat(active&&\"form-button-active\"),onClick:active?update:null},/*#__PURE__*/React.createElement(\"span\",null,\"\\u63D0\\u4EA4\"))));};var Password=function Password(){var history=useHistory();var _useState7=useState(1),_useState8=_slicedToArray(_useState7,2),status=_useState8[0],_setStatus=_useState8[1];return/*#__PURE__*/React.createElement(Wrap,{className:\"profile-password\",name:\"\\u5B89\\u5168\\u4E2D\\u5FC3\",sublevel:[true,function(){return history.goBack();}],isLoading:!status},/*#__PURE__*/React.createElement(\"div\",{className:\"passsword-wrap\"},/*#__PURE__*/React.createElement(PasswordRegular,{setStatus:function setStatus(s){return _setStatus(s);}})));};export default Password;","map":{"version":3,"sources":["/Users/cramj/Documents/New PWA/ubet-project (1)/src/pwa/view/profile/Password.jsx"],"names":["React","useState","useRef","useEffect","useHistory","Wrap","Service","FormField","PasswordRegular","setStatus","refpassword","refpassword_new","refpassword_newok","oldPassword","User","read","password","password_new","password_newok","form","setForm","active","setActive","className","source","message","setMessage","fields","field","label","input","id","name","type","required","placeholder","ref","notify","state","onChange","e","target","value","f","update","console","info","updatePassword","promise","then","r","warn","map","i","Password","history","status","goBack","s"],"mappings":"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","sourcesContent":["import React, { useState, useRef, useEffect } from \"react\";\r\nimport { useHistory } from \"react-router-dom\";\r\n\r\nimport { Wrap, Service } from \"./\";\r\nimport { FormField } from \"../../../component/\";\r\n\r\nconst PasswordRegular = ({ setStatus }) => {\r\n  const refpassword = useRef(null);\r\n  const refpassword_new = useRef(null);\r\n  const refpassword_newok = useRef(null);\r\n\r\n  const oldPassword = Service.User.read().password;\r\n\r\n  const [form, setForm] = useState({\r\n    password: \"\",\r\n    password_new: \"\",\r\n    password_newok: \"\",\r\n  });\r\n\r\n  const [active, setActive] = useState(false);\r\n\r\n  const [message, setMessage] = useState({\r\n    className: null,\r\n    source: null,\r\n    message: null,\r\n  });\r\n\r\n  const fields = [\r\n    {\r\n      field: {\r\n        label: \"原密码\",\r\n      },\r\n      input: {\r\n        id: \"password\",\r\n        name: \"password\",\r\n        type: \"password\",\r\n        required: true,\r\n        placeholder: \"原密码\",\r\n        ref: refpassword,\r\n      },\r\n    },\r\n    {\r\n      field: {\r\n        label: \"新密码\",\r\n      },\r\n      input: {\r\n        id: \"password_new\",\r\n        name: \"password_new\",\r\n        type: \"password\",\r\n        placeholder: \"新密码\",\r\n        ref: refpassword_new,\r\n      },\r\n    },\r\n    {\r\n      field: {\r\n        label: \"验证新密码\",\r\n      },\r\n      input: {\r\n        id: \"password_newok\",\r\n        name: \"password_newok\",\r\n        type: \"password\",\r\n        placeholder: \"验证新密码\",\r\n        ref: refpassword_newok,\r\n      },\r\n    },\r\n  ];\r\n\r\n  const notify = (state, source, message) => {\r\n    setMessage({\r\n      className: state ? \"valid\" : \"invalid\",\r\n      source,\r\n      message,\r\n    });\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (\r\n      form.password !== \"\" &&\r\n      form.password_new !== \"\" &&\r\n      form.password_newok !== \"\" &&\r\n      form.password_new === form.password_newok &&\r\n      oldPassword === form.password\r\n    )\r\n      setActive(true);\r\n    else setActive(false);\r\n  }, [form, oldPassword]);\r\n\r\n  const onChange = (e) => {\r\n    const { name, value } = e.target;\r\n\r\n    if (message.message && message.source === name) {\r\n      setMessage({\r\n        className: null,\r\n        source: null,\r\n        message: null,\r\n      });\r\n    }\r\n\r\n    setForm((f) => ({\r\n      ...f,\r\n      [name]: value,\r\n    }));\r\n  };\r\n\r\n  const update = () => {\r\n    if (!form.password) {\r\n      return void notify(false, \"password\", \"未输入当前密码!\");\r\n    }\r\n\r\n    if (!form.password_new) {\r\n      return void notify(false, \"password_new\", \"未输入新密码!\");\r\n    }\r\n\r\n    if (form.password_new !== form.password_newok) {\r\n      return void notify(false, \"password_new\", \"输入的密码不匹配!\");\r\n    }\r\n\r\n    setStatus(0);\r\n\r\n    console.info(\"You're updating account password:\", form);\r\n\r\n    Service.User.updatePassword({\r\n      ...Service.User.read(),\r\n      ...form,\r\n    }).promise.then(\r\n      (r) => {\r\n        console.info(\r\n          \"✅ You have successfully updated account password:\",\r\n          r.info\r\n        );\r\n\r\n        notify(true, \"password\", r.info);\r\n\r\n        setStatus(1);\r\n      },\r\n      (e) => {\r\n        console.warn(\"Unable to update account password:\", e);\r\n\r\n        notify(false, \"password\", e);\r\n\r\n        setStatus(1);\r\n      }\r\n    );\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <div className=\"fields\">\r\n        {message.message ? (\r\n          <div className={`message ${message.className}`}>\r\n            {message.message}\r\n          </div>\r\n        ) : null}\r\n        {fields.map((f, i) => (\r\n          <FormField\r\n            key={i}\r\n            field={f.field}\r\n            input={{\r\n              ...f.input,\r\n              onChange,\r\n            }}\r\n          />\r\n        ))}\r\n      </div>\r\n      <div className=\"submit\">\r\n        <div\r\n          className={`form-button ${active && \"form-button-active\"}`}\r\n          onClick={active ? update : null}\r\n        >\r\n          <span>提交</span>\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n\r\nconst Password = () => {\r\n  const history = useHistory();\r\n\r\n  const [status, setStatus] = useState(1);\r\n\r\n  return (\r\n    <Wrap\r\n      className=\"profile-password\"\r\n      name=\"安全中心\"\r\n      sublevel={[true, () => history.goBack()]}\r\n      isLoading={!status}\r\n    >\r\n      <div className=\"passsword-wrap\">\r\n        <PasswordRegular setStatus={(s) => setStatus(s)} />\r\n      </div>\r\n    </Wrap>\r\n  );\r\n};\r\n\r\nexport default Password;\r\n"]},"metadata":{},"sourceType":"module"}