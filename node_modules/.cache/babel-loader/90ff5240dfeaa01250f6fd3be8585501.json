{"ast":null,"code":"import _defineProperty from\"/Users/cramj/Documents/New PWA/GIT/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/Users/cramj/Documents/New PWA/GIT/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/cramj/Documents/New PWA/GIT/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState,useContext,useMemo}from'react';import Picker from'react-mobile-picker';import cx from'classnames';import{Wrap}from'./';import{Icon,FormField}from'../../../component/';import{User,Card as Service}from'../../../service/';import*as geo from'../../../service/Geo';var CardAddWrap=function CardAddWrap(props){var _useContext=useContext(User.Context),userAuth=_useContext.userAuth;var banks=[// '中国百银行',\n// '建设银行',\n// '度工商银行',\n// '中信银行',\n// '招商银行',\n// '广东发展银行',\n// '民生银行',\n// '农业银行',\n// '兴业银行',\n// '上海浦东发展银行',\n// '华夏知银行',\n// '交通银行',\n// '光大银道行',\n// '深圳发展银行',\n// '恒丰银行',\n// '渤海银行',\n'中国银行','中国建设银行','中国农业银行','中国工商银行','中国邮政储蓄银行','招商银行','交通银行','中信银行','平安银行','中国光大银行','上海浦东发展银行','广发银行','华夏银行','兴业银行','民生银行'];var GeoData=useMemo(function(){var cities=geo.cities.map(function(g){return g.chinese_title;});var provinces=geo.provinces.map(function(p){return p.chinese_title;});var provincesAssoc={};geo.provinces.forEach(function(province){provincesAssoc[province.title]=province.chinese_title;});var citiesByProvince={};geo.cities.forEach(function(city){var p=provincesAssoc[city.province];if(!citiesByProvince[p]){citiesByProvince[p]=[];}citiesByProvince[p].push(city.chinese_title);});return{cities:cities,citiesByProvince:citiesByProvince,provinces:provinces};},[]);var _useState=useState(false),_useState2=_slicedToArray(_useState,2),bankPicker=_useState2[0],toggleBankPicker=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),cityPicker=_useState4[0],toggleCityPicker=_useState4[1];var _useState5=useState({bank_type:'中国银行',bank_province:'贵州',bank_city:'遵义市',realname:userAuth.data.realName||'',bank_addr:'',bank_no:''}),_useState6=_slicedToArray(_useState5,2),form=_useState6[0],setForm=_useState6[1];var fields=[{id:'bank_type',label:'开户银行',select:toggleBankPicker,placeholder:'开户银行'},{id:'bank_province',label:'开户地区',select:toggleCityPicker,value:function value(){return\"\".concat(form.bank_province,\" \").concat(form.bank_city);},placeholder:'开户地区'},{id:'bank_city',label:'开户支行',hidden:true,select:false},{id:'bank_addr',label:'开户支行',select:false,placeholder:'开户支行'},{id:'realname',label:'开户人姓名',select:false,placeholder:'开户人姓名',displayOnly:userAuth.data.realName?true:false},{id:'bank_no',label:'银行卡号',select:false}];var onChange=function onChange(e){var _e$target=e.target,name=_e$target.name,value=_e$target.value;setForm(function(f){return _objectSpread(_objectSpread({},f),{},_defineProperty({},name,value));});};var submit=function submit(){props.onLoading();Service.create(_objectSpread(_objectSpread({},User.read()),form)).promise.then(function(r){console.info('Successfully bound the card:',r);props.onFinish();},function(e){console.info('Unable to bind the card:',e);});};// console.log(form)\nreturn/*#__PURE__*/React.createElement(\"div\",{className:\"card-add-form\"},/*#__PURE__*/React.createElement(\"div\",{className:\"card-add-wrap\"},/*#__PURE__*/React.createElement(\"div\",{className:\"fields\"},fields.filter(function(f){return!f.hidden;}).map(function(f,i){return/*#__PURE__*/React.createElement(FormField,{key:i,field:{label:f.label,placeholder:f.placeholder,select:f.select,displayOnly:f.displayOnly,value:f.value,onClick:function onClick(){return f.select(true);}},input:{id:f.id,label:f.label,placeholder:f.placeholder,name:f.id,value:form[f.id],onChange:onChange}});})),/*#__PURE__*/React.createElement(\"div\",{className:\"submit\"},/*#__PURE__*/React.createElement(\"button\",{className:\"button-stylized\",onClick:submit},\"\\u4FDD\\u5B58\"))),/*#__PURE__*/React.createElement(\"div\",{className:cx('card-add-overlay',{shown:bankPicker||cityPicker})},/*#__PURE__*/React.createElement(\"div\",{className:\"picker-wrap\"},bankPicker?/*#__PURE__*/React.createElement(\"div\",{className:\"picker-head\"},/*#__PURE__*/React.createElement(\"button\",{onClick:function onClick(){return toggleBankPicker(false);}},\"\\u53D6\\u6D88\"),/*#__PURE__*/React.createElement(\"p\",null,\"\\u9009\\u62E9\\u94F6\\u884C\"),/*#__PURE__*/React.createElement(\"button\",{onClick:function onClick(){return toggleBankPicker(false);}},\"\\u786E\\u5B9A\")):null,cityPicker?/*#__PURE__*/React.createElement(\"div\",{className:\"picker-head\"},/*#__PURE__*/React.createElement(\"button\",{onClick:function onClick(){return toggleCityPicker(false);}},\"\\u53D6\\u6D88\"),/*#__PURE__*/React.createElement(\"p\",null,\"\\u9009\\u62E9\\u4E00\\u4E2A\\u57CE\\u5E02\"),/*#__PURE__*/React.createElement(\"button\",{onClick:function onClick(){return toggleCityPicker(false);}},\"\\u786E\\u5B9A\")):null,/*#__PURE__*/React.createElement(\"div\",{className:\"picker-body\"},bankPicker?/*#__PURE__*/React.createElement(Picker,{height:120,valueGroups:{bank_type:form.bank_type},optionGroups:{bank_type:banks},onChange:function onChange(k,v){return setForm(_objectSpread(_objectSpread({},form),{},_defineProperty({},k,v)));}}):null,cityPicker?/*#__PURE__*/React.createElement(Picker,{height:120,valueGroups:{bank_province:form.bank_province,bank_city:form.bank_city},optionGroups:{bank_province:GeoData.provinces,bank_city:GeoData.citiesByProvince[form.bank_province]},onChange:function onChange(k,v){var _fs=_objectSpread(_objectSpread({},form),{},_defineProperty({},k,v));if(k==='bank_province'){_fs.bank_city=GeoData.citiesByProvince[v][0];}setForm(_fs);}}):null))));};var Card=function Card(){var _useState7=useState(1),_useState8=_slicedToArray(_useState7,2),status=_useState8[0],setStatus=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),adding=_useState10[0],setAdding=_useState10[1];var _useState11=useState(0),_useState12=_slicedToArray(_useState11,2),update=_useState12[0],setUpdate=_useState12[1];var _useState13=useState([]),_useState14=_slicedToArray(_useState13,2),cards=_useState14[0],setCards=_useState14[1];useEffect(function(){var req=Service.read(_objectSpread({},User.read()));setStatus(0);req.promise.then(function(r){console.log('Got cards:',r);setCards(r.info);setStatus(1);},function(e){console.warn('Unable to get cards:',e);setStatus(1);});return function(){return req.cancel();};},[update]);var onFinish=function onFinish(){setAdding(false);setUpdate(function(u){return u+1;});};return/*#__PURE__*/React.createElement(Wrap,{className:\"profile-payment\",name:\"\\u8BBE\\u7F6E\\u94F6\\u884C\\u5361\",isLoading:!status},adding?/*#__PURE__*/React.createElement(CardAddWrap,{onLoading:function onLoading(){return setStatus(0);},onFinish:onFinish}):/*#__PURE__*/React.createElement(\"div\",{className:\"cards-list\"},cards.map(function(c,i){return/*#__PURE__*/React.createElement(\"div\",{key:i,className:\"card\"},/*#__PURE__*/React.createElement(\"div\",{className:\"card-content\"},/*#__PURE__*/React.createElement(\"h4\",null,c.debit_bank)));}),/*#__PURE__*/React.createElement(\"button\",{className:\"card\",onClick:function onClick(e){return setAdding(true);}},/*#__PURE__*/React.createElement(\"div\",{className:\"card-content\"},/*#__PURE__*/React.createElement(Icon,{name:\"plus\"})))));};export default Card;","map":{"version":3,"sources":["/Users/cramj/Documents/New PWA/GIT/src/pwa/view/profile/Card.js"],"names":["React","useEffect","useState","useContext","useMemo","Picker","cx","Wrap","Icon","FormField","User","Card","Service","geo","CardAddWrap","props","Context","userAuth","banks","GeoData","cities","map","g","chinese_title","provinces","p","provincesAssoc","forEach","province","title","citiesByProvince","city","push","bankPicker","toggleBankPicker","cityPicker","toggleCityPicker","bank_type","bank_province","bank_city","realname","data","realName","bank_addr","bank_no","form","setForm","fields","id","label","select","placeholder","value","hidden","displayOnly","onChange","e","target","name","f","submit","onLoading","create","read","promise","then","r","console","info","onFinish","filter","i","onClick","shown","k","v","_fs","status","setStatus","adding","setAdding","update","setUpdate","cards","setCards","req","log","warn","cancel","u","c","debit_bank"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useContext, useMemo } from 'react';\r\nimport Picker from 'react-mobile-picker';\r\nimport cx from 'classnames';\r\n\r\nimport { Wrap } from './';\r\nimport { Icon, FormField } from '../../../component/';\r\nimport { User, Card as Service } from '../../../service/';\r\nimport * as geo from '../../../service/Geo';\r\n\r\nconst CardAddWrap = (props) => {\r\n\r\n\tconst { userAuth } = useContext(User.Context);\r\n\r\n\tconst banks = [\r\n\t\t// '中国百银行',\r\n\t\t// '建设银行',\r\n\t\t// '度工商银行',\r\n\t\t// '中信银行',\r\n\t\t// '招商银行',\r\n\t\t// '广东发展银行',\r\n\t\t// '民生银行',\r\n\t\t// '农业银行',\r\n\t\t// '兴业银行',\r\n\t\t// '上海浦东发展银行',\r\n\t\t// '华夏知银行',\r\n\t\t// '交通银行',\r\n\t\t// '光大银道行',\r\n\t\t// '深圳发展银行',\r\n\t\t// '恒丰银行',\r\n\t\t// '渤海银行',\r\n\t\t'中国银行',\r\n\t\t'中国建设银行',\r\n\t\t'中国农业银行',\r\n\t\t'中国工商银行',\r\n\t\t'中国邮政储蓄银行',\r\n\t\t'招商银行',\r\n\t\t'交通银行',\r\n\t\t'中信银行',\r\n\t\t'平安银行',\r\n\t\t'中国光大银行',\r\n\t\t'上海浦东发展银行',\r\n\t\t'广发银行',\r\n\t\t'华夏银行',\r\n\t\t'兴业银行',\r\n\t\t'民生银行',\r\n\t];\r\n\r\n\tconst GeoData = useMemo(() => {\r\n\r\n\t\tconst cities = geo.cities.map(g => g.chinese_title);\r\n\t\tconst provinces = geo.provinces.map(p => p.chinese_title);\r\n\r\n\t\tconst provincesAssoc = {};\r\n\r\n\t\tgeo.provinces.forEach(province => {\r\n\t\t\tprovincesAssoc[province.title] = province.chinese_title;\r\n\t\t});\r\n\r\n\t\tconst citiesByProvince = {};\r\n\r\n\t\tgeo.cities.forEach(city => {\r\n\t\t\tconst p = provincesAssoc[city.province];\r\n\t\t\tif (!citiesByProvince[p]) {\r\n\t\t\t\tcitiesByProvince[p] = [];\r\n\t\t\t}\r\n\t\t\tcitiesByProvince[p].push(city.chinese_title);\r\n\t\t});\r\n\r\n\t\treturn {\r\n\t\t\tcities,\r\n\t\t\tcitiesByProvince,\r\n\t\t\tprovinces,\r\n\t\t};\r\n\r\n\t}, []);\r\n\r\n\tconst [ bankPicker, toggleBankPicker ] = useState(false);\r\n\tconst [ cityPicker, toggleCityPicker ] = useState(false);\r\n\r\n\tconst [ form, setForm ] = useState({\r\n\t\tbank_type: '中国银行',\r\n\t\tbank_province: '贵州',\r\n\t\tbank_city: '遵义市',\r\n\t\trealname: userAuth.data.realName || '',\r\n\t\tbank_addr: '',\r\n\t\tbank_no: '',\r\n\t});\r\n\r\n\tconst fields = [\r\n\t\t{ id: 'bank_type', label: '开户银行', select: toggleBankPicker, placeholder: '开户银行' },\r\n\t\t{ id: 'bank_province', label: '开户地区', select: toggleCityPicker, value: () => `${form.bank_province} ${form.bank_city}`, placeholder: '开户地区' },\r\n\t\t{ id: 'bank_city', label: '开户支行', hidden: true, select: false, },\r\n\t\t{ id: 'bank_addr', label: '开户支行', select: false, placeholder: '开户支行' },\r\n\t\t{ id: 'realname', label: '开户人姓名', select: false, placeholder: '开户人姓名', displayOnly: (userAuth.data.realName ? true : false) },\r\n\t\t{ id: 'bank_no', label: '银行卡号', select: false },\r\n\t];\r\n\r\n\tconst onChange = e => {\r\n\r\n\t\tconst { name, value } = e.target;\r\n\r\n\t\tsetForm(f => ({\r\n\t\t\t...f,\r\n\t\t\t[name]: value,\r\n\t\t}));\r\n\r\n\t}\r\n\r\n\tconst submit = () => {\r\n\r\n\t\tprops.onLoading();\r\n\r\n\t\tService.create({\r\n\t\t\t...User.read(),\r\n\t\t\t...form,\r\n\t\t}).promise.then(r => {\r\n\r\n\t\t\tconsole.info('Successfully bound the card:', r);\r\n\r\n\t\t\tprops.onFinish();\r\n\r\n\t\t}, e => {\r\n\r\n\t\t\tconsole.info('Unable to bind the card:', e);\r\n\r\n\t\t});\r\n\r\n\t}\r\n\r\n\t// console.log(form)\r\n\t\r\n\r\n\treturn (\r\n\t\t<div className=\"card-add-form\">\r\n\t\t\t<div className=\"card-add-wrap\">\r\n\t\t\t\t<div className=\"fields\">\r\n\t\t\t\t\t{fields.filter(f => !f.hidden).map((f, i) => (\r\n\t\t\t\t\t\t<FormField\r\n\t\t\t\t\t\t\tkey={i}\r\n\t\t\t\t\t\t\tfield={{\r\n\t\t\t\t\t\t\t\tlabel: f.label,\r\n\t\t\t\t\t\t\t\tplaceholder: f.placeholder,\r\n\t\t\t\t\t\t\t\tselect: f.select,\r\n\t\t\t\t\t\t\t\tdisplayOnly: f.displayOnly,\r\n\t\t\t\t\t\t\t\tvalue: f.value,\r\n\t\t\t\t\t\t\t\tonClick: () => f.select(true),\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\tinput={{\r\n\t\t\t\t\t\t\t\tid: f.id,\r\n\t\t\t\t\t\t\t\tlabel: f.label,\r\n\t\t\t\t\t\t\t\tplaceholder: f.placeholder,\r\n\t\t\t\t\t\t\t\tname: f.id,\r\n\t\t\t\t\t\t\t\tvalue: form[f.id],\r\n\t\t\t\t\t\t\t\tonChange,\r\n\t\t\t\t\t\t\t}} />\r\n\t\t\t\t\t))}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"submit\">\r\n\t\t\t\t\t<button className=\"button-stylized\" onClick={submit}>保存</button>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div className={cx('card-add-overlay', { shown: bankPicker || cityPicker })}>\r\n\t\t\t\t<div className=\"picker-wrap\">\r\n\t\t\t\t\t{bankPicker ? (\r\n\t\t\t\t\t<div className=\"picker-head\">\r\n\t\t\t\t\t\t<button onClick={() => toggleBankPicker(false)}>取消</button>\r\n\t\t\t\t\t\t<p>选择银行</p>\r\n\t\t\t\t\t\t<button onClick={() => toggleBankPicker(false)}>确定</button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t) : null}\r\n\t\t\t\t\t{cityPicker ? (\r\n\t\t\t\t\t<div className=\"picker-head\">\r\n\t\t\t\t\t\t<button onClick={() => toggleCityPicker(false)}>取消</button>\r\n\t\t\t\t\t\t<p>选择一个城市</p>\r\n\t\t\t\t\t\t<button onClick={() => toggleCityPicker(false)}>确定</button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t) : null}\r\n\t\t\t\t\t<div className=\"picker-body\">\r\n\t\t\t\t\t\t{bankPicker ? (\r\n\t\t\t\t\t\t<Picker\r\n\t\t\t\t\t\t\theight={120}\r\n\t\t\t\t\t\t\tvalueGroups={{ bank_type: form.bank_type }}\r\n\t\t\t\t\t\t\toptionGroups={{ bank_type: banks }}\r\n\t\t\t\t\t\t\tonChange={(k, v) => setForm({ ...form, [k]: v })} />\r\n\t\t\t\t\t\t) : null}\r\n\t\t\t\t\t\t{cityPicker ? (\r\n\t\t\t\t\t\t<Picker\r\n\t\t\t\t\t\t\theight={120}\r\n\t\t\t\t\t\t\tvalueGroups={{\r\n\t\t\t\t\t\t\t\tbank_province: form.bank_province,\r\n\t\t\t\t\t\t\t\tbank_city: form.bank_city,\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\toptionGroups={{\r\n\t\t\t\t\t\t\t\tbank_province: GeoData.provinces,\r\n\t\t\t\t\t\t\t\tbank_city: GeoData.citiesByProvince[form.bank_province],\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\tonChange={(k, v) => {\r\n\r\n\t\t\t\t\t\t\t\tconst _fs = {\r\n\t\t\t\t\t\t\t\t\t...form,\r\n\t\t\t\t\t\t\t\t\t[k]: v,\r\n\t\t\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t\t\tif (k === 'bank_province') {\r\n\t\t\t\t\t\t\t\t\t_fs.bank_city = GeoData.citiesByProvince[v][0];\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tsetForm(_fs);\r\n\r\n\t\t\t\t\t\t\t}} />\r\n\t\t\t\t\t\t) : null}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n\r\n}\r\n\r\nconst Card = () => {\r\n\r\n\tconst [ status, setStatus ] = useState(1);\r\n\r\n\tconst [ adding, setAdding ] = useState(false);\r\n\r\n\tconst [ update, setUpdate ] = useState(0);\r\n\r\n\tconst [ cards, setCards ] = useState([]);\r\n\r\n\tuseEffect(() => {\r\n\r\n\t\tconst req = Service.read({\r\n\t\t\t...User.read()\r\n\t\t});\r\n\r\n\t\tsetStatus(0);\r\n\r\n\t\treq.promise.then(r => {\r\n\r\n\t\t\tconsole.log('Got cards:', r);\r\n\r\n\t\t\tsetCards(r.info);\r\n\r\n\t\t\tsetStatus(1);\r\n\r\n\t\t}, e => {\r\n\r\n\t\t\tconsole.warn('Unable to get cards:', e);\r\n\r\n\t\t\tsetStatus(1);\r\n\r\n\t\t});\r\n\r\n\t\treturn () => req.cancel();\r\n\r\n\t}, [ update ]);\r\n\r\n\tconst onFinish = () => {\r\n\r\n\t\tsetAdding(false);\r\n\r\n\t\tsetUpdate(u => u + 1);\r\n\r\n\t}\r\n\r\n\treturn (\r\n\t\t<Wrap className=\"profile-payment\" name=\"设置银行卡\" isLoading={!status}>\r\n\t\t\t{adding ? (\r\n\t\t\t\t<CardAddWrap onLoading={() => setStatus(0)} onFinish={onFinish} />\r\n\t\t\t) : (\r\n\t\t\t\t<div className=\"cards-list\">\r\n\t\t\t\t\t{cards.map((c, i) => (\r\n\t\t\t\t\t<div key={i} className=\"card\">\r\n\t\t\t\t\t\t<div className=\"card-content\">\r\n\t\t\t\t\t\t\t<h4>{c.debit_bank}</h4>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t))}\r\n\t\t\t\t\t<button className=\"card\" onClick={e => setAdding(true)}>\r\n\t\t\t\t\t\t<div className=\"card-content\">\r\n\t\t\t\t\t\t\t<Icon name=\"plus\" />\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</div>\r\n\t\t\t)}\r\n\t\t</Wrap>\r\n\t);\r\n\r\n}\r\n\r\nexport default Card;\r\n"]},"metadata":{},"sourceType":"module"}