{"ast":null,"code":"var _jsxFileName = \"/Users/cramj/Downloads/usportproject 2/src/pwa/view/Inbox.jsx\";\nimport React, { useEffect, useState } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport cx from \"classnames\";\nimport { isEmpty } from \"lodash\";\nimport { Inbox as _Inbox } from \"../../service/\";\nimport { Wrap } from \"../view/profile/\";\nimport { withAuth } from \"../util/\";\nimport \"../assets/scss/Inbox.scss\";\nconst status = [\"未读\", \"已读\"];\n\nconst Inbox = () => {\n  const history = useHistory();\n  const [messages, setMessages] = useState({\n    status: 0,\n    list: []\n  });\n  useEffect(() => {\n    setMessages({\n      status: 0,\n      list: []\n    });\n\n    const req = _Inbox.read({\n      record_type: \"message\"\n    });\n\n    req.promise.then(r => {\n      // console.info(r);\n      setMessages({\n        status: 1,\n        list: r.info.map(m => m)\n      });\n    }, e => {\n      if (!e.is_aborted) {\n        console.warn(e);\n      }\n    });\n    return () => req.cancel();\n  }, []);\n\n  const open = ({\n    id\n  }, i) => {\n    const _m = messages.list[i];\n\n    if (!_m.content) {\n      setMessages(m => ({ ...m,\n        status: 0\n      }));\n\n      _Inbox.readCurrent({\n        id\n      }).promise.then(r => {\n        _m.opened = !_m.opened;\n        _m.content = r.info.content;\n        _m.message_status = 1;\n        setMessages(m => ({ ...m,\n          list: m.list.filter((m, _i) => _i === i ? _m : m),\n          status: 1\n        }));\n      }, e => {\n        if (!e.is_aborted) {\n          console.warn(e);\n        }\n      });\n    } else {\n      _m.opened = !_m.opened;\n      setMessages(m => ({ ...m,\n        list: m.list.filter((m, _i) => _i === i ? _m : m)\n      }));\n    }\n  };\n\n  const _messagesList = messages.list.map((m, i) => /*#__PURE__*/React.createElement(\"div\", {\n    className: cx(\"messages-list--item\", {\n      opened: m.opened\n    }),\n    key: i,\n    onClick: e => open(m, i, e),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"messages-list--item-wrap\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"m-content\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"p\", {\n    className: \"subject\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 11\n    }\n  }, m.subject), /*#__PURE__*/React.createElement(\"p\", {\n    className: \"timestamp\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 11\n    }\n  }, m.send_time)), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"m-status\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"p\", {\n    className: cx(\"status\", {\n      unread: m.message_status === 0\n    }),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 11\n    }\n  }, status[m.message_status]))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"messages-list--item-content\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 9\n    }\n  }, m.content))));\n\n  return /*#__PURE__*/React.createElement(Wrap, {\n    className: \"messages-wrap mobile\",\n    centerName: \"\\u4FE1\\u606F\",\n    faq: false,\n    isLoading: !messages.status,\n    sublevel: [true, () => history.goBack()],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"messages-list\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 7\n    }\n  }, !isEmpty(_messagesList) ? _messagesList : /*#__PURE__*/React.createElement(\"div\", {\n    className: \"no-transactions\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"image-box\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 13\n    }\n  }, \"\\u6682\\u65E0\\u8BB0\\u5F55\"))));\n}; // export default Inbox;\n\n\nexport default withAuth(Inbox, 1);","map":{"version":3,"sources":["/Users/cramj/Downloads/usportproject 2/src/pwa/view/Inbox.jsx"],"names":["React","useEffect","useState","useHistory","cx","isEmpty","Inbox","_Inbox","Wrap","withAuth","status","history","messages","setMessages","list","req","read","record_type","promise","then","r","info","map","m","e","is_aborted","console","warn","cancel","open","id","i","_m","content","readCurrent","opened","message_status","filter","_i","_messagesList","subject","send_time","unread","goBack"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { useHistory } from \"react-router-dom\";\r\nimport cx from \"classnames\";\r\nimport { isEmpty } from \"lodash\";\r\n\r\nimport { Inbox as _Inbox } from \"../../service/\";\r\nimport { Wrap } from \"../view/profile/\";\r\nimport { withAuth } from \"../util/\";\r\n\r\nimport \"../assets/scss/Inbox.scss\";\r\n\r\nconst status = [\"未读\", \"已读\"];\r\n\r\nconst Inbox = () => {\r\n  const history = useHistory();\r\n\r\n  const [messages, setMessages] = useState({\r\n    status: 0,\r\n    list: [],\r\n  });\r\n\r\n  useEffect(() => {\r\n    setMessages({\r\n      status: 0,\r\n      list: [],\r\n    });\r\n\r\n    const req = _Inbox.read({\r\n      record_type: \"message\",\r\n    });\r\n\r\n    req.promise.then(\r\n      (r) => {\r\n        // console.info(r);\r\n\r\n        setMessages({\r\n          status: 1,\r\n          list: r.info.map((m) => m),\r\n        });\r\n      },\r\n      (e) => {\r\n        if (!e.is_aborted) {\r\n          console.warn(e);\r\n        }\r\n      }\r\n    );\r\n\r\n    return () => req.cancel();\r\n  }, []);\r\n\r\n  const open = ({ id }, i) => {\r\n    const _m = messages.list[i];\r\n\r\n    if (!_m.content) {\r\n      setMessages((m) => ({\r\n        ...m,\r\n        status: 0,\r\n      }));\r\n\r\n      _Inbox.readCurrent({ id }).promise.then(\r\n        (r) => {\r\n          _m.opened = !_m.opened;\r\n          _m.content = r.info.content;\r\n          _m.message_status = 1;\r\n\r\n          setMessages((m) => ({\r\n            ...m,\r\n            list: m.list.filter((m, _i) => (_i === i ? _m : m)),\r\n            status: 1,\r\n          }));\r\n        },\r\n        (e) => {\r\n          if (!e.is_aborted) {\r\n            console.warn(e);\r\n          }\r\n        }\r\n      );\r\n    } else {\r\n      _m.opened = !_m.opened;\r\n\r\n      setMessages((m) => ({\r\n        ...m,\r\n        list: m.list.filter((m, _i) => (_i === i ? _m : m)),\r\n      }));\r\n    }\r\n  };\r\n\r\n  const _messagesList = messages.list.map((m, i) => (\r\n    <div\r\n      className={cx(\"messages-list--item\", { opened: m.opened })}\r\n      key={i}\r\n      onClick={(e) => open(m, i, e)}\r\n    >\r\n      <div className=\"messages-list--item-wrap\">\r\n        <div className=\"m-content\">\r\n          <p className=\"subject\">{m.subject}</p>\r\n          <p className=\"timestamp\">{m.send_time}</p>\r\n        </div>\r\n        <div className=\"m-status\">\r\n          <p className={cx(\"status\", { unread: m.message_status === 0 })}>\r\n            {status[m.message_status]}\r\n          </p>\r\n        </div>\r\n      </div>\r\n      <div className=\"messages-list--item-content\">\r\n        <p>{m.content}</p>\r\n      </div>\r\n    </div>\r\n  ));\r\n\r\n  return (\r\n    <Wrap\r\n      className=\"messages-wrap mobile\"\r\n      centerName=\"信息\"\r\n      faq={false}\r\n      isLoading={!messages.status}\r\n      sublevel={[true, () => history.goBack()]}\r\n    >\r\n      <div className=\"messages-list\">\r\n        {!isEmpty(_messagesList) ? (\r\n          _messagesList\r\n        ) : (\r\n          <div className=\"no-transactions\">\r\n            <div className=\"image-box\" />\r\n            <span>暂无记录</span>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </Wrap>\r\n  );\r\n};\r\n\r\n// export default Inbox;\r\nexport default withAuth(Inbox, 1);"]},"metadata":{},"sourceType":"module"}