{"ast":null,"code":"import _regeneratorRuntime from\"/Users/cramj/Documents/New PWA/ubet-project (1)/node_modules/react-scripts/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/cramj/Documents/New PWA/ubet-project (1)/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/cramj/Documents/New PWA/ubet-project (1)/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/cramj/Documents/New PWA/ubet-project (1)/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/cramj/Documents/New PWA/ubet-project (1)/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/cramj/Documents/New PWA/ubet-project (1)/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from\"react\";import ReactCrop from\"react-image-crop\";var CropDemo=/*#__PURE__*/function(_React$Component){_inherits(CropDemo,_React$Component);var _super=_createSuper(CropDemo);function CropDemo(props){var _this;_classCallCheck(this,CropDemo);_this=_super.call(this,props);_this.componentWillReceiveProps=function(nextProps){var src=nextProps.src;if(!src){_this.setState({croppedImageUrl:null});}};_this.onImageLoaded=function(image){_this.imageRef=image;};_this.onCropComplete=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(crop){var croppedImageUrl;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(_this.imageRef&&crop.width&&crop.height)){_context.next=5;break;}_context.next=3;return _this.onGetCropImg(_this.imageRef,crop,\"newFile.jpeg\");case 3:croppedImageUrl=_context.sent;_this.setState({croppedImageUrl:croppedImageUrl});// console.log(croppedImageUrl)\ncase 5:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();_this.onGetCropImg=function(image,crop,fileName){var canvas=document.createElement(\"canvas\");var scaleX=image.naturalWidth/image.width;var scaleY=image.naturalHeight/image.height;canvas.width=350;canvas.height=350;var ctx=canvas.getContext(\"2d\");ctx.drawImage(image,crop.x*scaleX,crop.y*scaleY,crop.width*scaleX,crop.height*scaleY,0,0,350,350);return new Promise(function(resolve,reject){canvas.toBlob(function(blob){if(!blob){// reject(new Error('Canvas is empty'));\nconsole.error(\"Canvas is empty\");return;}blob.name=fileName;window.URL.revokeObjectURL(_this.fileUrl);_this.fileUrl=window.URL.createObjectURL(blob);console.warn(\"he\",blob.size);// resolve(this.fileUrl);\nresolve(blob);// resolve(canvas.toDataURL('image/jpeg'));\n// console.log(canvas.toDataURL('image/jpeg'))\n},\"image/jpeg\");});};_this.onCropChange=function(crop,percentCrop){_this.setState({crop:crop});};_this.onSelectFile=function(e){if(e.target.files&&e.target.files.length>0){var reader=new FileReader();reader.addEventListener(\"load\",function(){_this.setState({image:reader.result});});reader.readAsDataURL(e.target.files[0]);}};_this.ScanNow=function(){_this.inputFile.click();};_this.CropNow=function(){_this.props.onCrop(_this.state.croppedImageUrl);};_this.onSendBack=function(){var updateCustomPhoto=_this.props.updateCustomPhoto;var croppedImageUrl=_this.state.croppedImageUrl;if(croppedImageUrl){updateCustomPhoto(croppedImageUrl,\"custom\");}};_this.state={image:null,crop:{width:90,aspect:1/1,unit:\"%\"},croppedImageUrl:null};_this.inputFile=React.createRef();return _this;}_createClass(CropDemo,[{key:\"render\",value:function render(){var _this2=this;var _this$props=this.props,onClose=_this$props.onClose,src=_this$props.src;var crop=this.state.crop;return/*#__PURE__*/React.createElement(\"div\",{className:\"modal-custom-wrap\"},/*#__PURE__*/React.createElement(\"div\",{className:\"modal-custom-content\"},/*#__PURE__*/React.createElement(\"div\",{className:\"modal-custom-image\"},/*#__PURE__*/React.createElement(ReactCrop,{src:src,crop:crop,onImageLoaded:this.onImageLoaded,onComplete:this.onCropComplete,onChange:this.onCropChange})),/*#__PURE__*/React.createElement(\"div\",{className:\"modal-custom-buttons\"},/*#__PURE__*/React.createElement(\"button\",{onClick:onClose},\"\\u53D6\\u6D88\"),/*#__PURE__*/React.createElement(\"button\",{className:\"active\",onClick:function onClick(){return _this2.onSendBack();}},\"\\u4FDD\\u5B58\"))));}}]);return CropDemo;}(React.Component);export default CropDemo;","map":{"version":3,"sources":["/Users/cramj/Documents/New PWA/ubet-project (1)/src/pwa/view/profile/UploadAvatar.js"],"names":["React","ReactCrop","CropDemo","props","componentWillReceiveProps","nextProps","src","setState","croppedImageUrl","onImageLoaded","image","imageRef","onCropComplete","crop","width","height","onGetCropImg","fileName","canvas","document","createElement","scaleX","naturalWidth","scaleY","naturalHeight","ctx","getContext","drawImage","x","y","Promise","resolve","reject","toBlob","blob","console","error","name","window","URL","revokeObjectURL","fileUrl","createObjectURL","warn","size","onCropChange","percentCrop","onSelectFile","e","target","files","length","reader","FileReader","addEventListener","result","readAsDataURL","ScanNow","inputFile","click","CropNow","onCrop","state","onSendBack","updateCustomPhoto","aspect","unit","createRef","onClose","Component"],"mappings":"25BAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAOC,CAAAA,SAAP,KAAsB,kBAAtB,C,GACMC,CAAAA,Q,gHACJ,kBAAYC,KAAZ,CAAmB,0CACjB,uBAAMA,KAAN,EADiB,MAcnBC,yBAdmB,CAcS,SAACC,SAAD,CAAe,IACjCC,CAAAA,GADiC,CACzBD,SADyB,CACjCC,GADiC,CAEzC,GAAI,CAACA,GAAL,CAAU,CACR,MAAKC,QAAL,CAAc,CACZC,eAAe,CAAE,IADL,CAAd,EAGD,CACF,CArBkB,OAuBnBC,aAvBmB,CAuBH,SAACC,KAAD,CAAW,CACzB,MAAKC,QAAL,CAAgBD,KAAhB,CACD,CAzBkB,OA2BnBE,cA3BmB,0FA2BF,iBAAOC,IAAP,2IACX,MAAKF,QAAL,EAAiBE,IAAI,CAACC,KAAtB,EAA+BD,IAAI,CAACE,MADzB,gDAEiB,OAAKC,YAAL,CAC5B,MAAKL,QADuB,CAE5BE,IAF4B,CAG5B,cAH4B,CAFjB,QAEPL,eAFO,eAOb,MAAKD,QAAL,CAAc,CAAEC,eAAe,CAAfA,eAAF,CAAd,EACA;AARa,sDA3BE,qEAuCnBQ,YAvCmB,CAuCJ,SAACN,KAAD,CAAQG,IAAR,CAAcI,QAAd,CAA2B,CACxC,GAAMC,CAAAA,MAAM,CAAGC,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAf,CACA,GAAMC,CAAAA,MAAM,CAAGX,KAAK,CAACY,YAAN,CAAqBZ,KAAK,CAACI,KAA1C,CACA,GAAMS,CAAAA,MAAM,CAAGb,KAAK,CAACc,aAAN,CAAsBd,KAAK,CAACK,MAA3C,CACAG,MAAM,CAACJ,KAAP,CAAe,GAAf,CACAI,MAAM,CAACH,MAAP,CAAgB,GAAhB,CACA,GAAMU,CAAAA,GAAG,CAAGP,MAAM,CAACQ,UAAP,CAAkB,IAAlB,CAAZ,CAEAD,GAAG,CAACE,SAAJ,CACEjB,KADF,CAEEG,IAAI,CAACe,CAAL,CAASP,MAFX,CAGER,IAAI,CAACgB,CAAL,CAASN,MAHX,CAIEV,IAAI,CAACC,KAAL,CAAaO,MAJf,CAKER,IAAI,CAACE,MAAL,CAAcQ,MALhB,CAME,CANF,CAOE,CAPF,CAQE,GARF,CASE,GATF,EAWA,MAAO,IAAIO,CAAAA,OAAJ,CAAY,SAACC,OAAD,CAAUC,MAAV,CAAqB,CACtCd,MAAM,CAACe,MAAP,CAAc,SAACC,IAAD,CAAU,CACtB,GAAI,CAACA,IAAL,CAAW,CACT;AACAC,OAAO,CAACC,KAAR,CAAc,iBAAd,EACA,OACD,CACDF,IAAI,CAACG,IAAL,CAAYpB,QAAZ,CACAqB,MAAM,CAACC,GAAP,CAAWC,eAAX,CAA2B,MAAKC,OAAhC,EACA,MAAKA,OAAL,CAAeH,MAAM,CAACC,GAAP,CAAWG,eAAX,CAA2BR,IAA3B,CAAf,CACAC,OAAO,CAACQ,IAAR,CAAa,IAAb,CAAmBT,IAAI,CAACU,IAAxB,EACA;AACAb,OAAO,CAACG,IAAD,CAAP,CACA;AACA;AACD,CAdD,CAcG,YAdH,EAeD,CAhBM,CAAP,CAiBD,CA3EkB,OA6EnBW,YA7EmB,CA6EJ,SAAChC,IAAD,CAAOiC,WAAP,CAAuB,CACpC,MAAKvC,QAAL,CAAc,CAAEM,IAAI,CAAJA,IAAF,CAAd,EACD,CA/EkB,OAiFnBkC,YAjFmB,CAiFJ,SAACC,CAAD,CAAO,CACpB,GAAIA,CAAC,CAACC,MAAF,CAASC,KAAT,EAAkBF,CAAC,CAACC,MAAF,CAASC,KAAT,CAAeC,MAAf,CAAwB,CAA9C,CAAiD,CAC/C,GAAMC,CAAAA,MAAM,CAAG,GAAIC,CAAAA,UAAJ,EAAf,CACAD,MAAM,CAACE,gBAAP,CAAwB,MAAxB,CAAgC,UAAM,CACpC,MAAK/C,QAAL,CAAc,CAAEG,KAAK,CAAE0C,MAAM,CAACG,MAAhB,CAAd,EACD,CAFD,EAGAH,MAAM,CAACI,aAAP,CAAqBR,CAAC,CAACC,MAAF,CAASC,KAAT,CAAe,CAAf,CAArB,EACD,CACF,CAzFkB,OA0FnBO,OA1FmB,CA0FT,UAAM,CACd,MAAKC,SAAL,CAAeC,KAAf,GACD,CA5FkB,OA8FnBC,OA9FmB,CA8FT,UAAM,CACd,MAAKzD,KAAL,CAAW0D,MAAX,CAAkB,MAAKC,KAAL,CAAWtD,eAA7B,EACD,CAhGkB,OAkGnBuD,UAlGmB,CAkGN,UAAM,IACTC,CAAAA,iBADS,CACa,MAAK7D,KADlB,CACT6D,iBADS,IAETxD,CAAAA,eAFS,CAEW,MAAKsD,KAFhB,CAETtD,eAFS,CAGjB,GAAIA,eAAJ,CAAqB,CACnBwD,iBAAiB,CAACxD,eAAD,CAAkB,QAAlB,CAAjB,CACD,CACF,CAxGkB,CAEjB,MAAKsD,KAAL,CAAa,CACXpD,KAAK,CAAE,IADI,CAEXG,IAAI,CAAE,CACJC,KAAK,CAAE,EADH,CAEJmD,MAAM,CAAE,EAAI,CAFR,CAGJC,IAAI,CAAE,GAHF,CAFK,CAOX1D,eAAe,CAAE,IAPN,CAAb,CASA,MAAKkD,SAAL,CAAiB1D,KAAK,CAACmE,SAAN,EAAjB,CAXiB,aAYlB,C,4DA8FQ,iCACkB,KAAKhE,KADvB,CACCiE,OADD,aACCA,OADD,CACU9D,GADV,aACUA,GADV,IAECO,CAAAA,IAFD,CAEU,KAAKiD,KAFf,CAECjD,IAFD,CAGP,mBACE,2BAAK,SAAS,CAAC,mBAAf,eACE,2BAAK,SAAS,CAAC,sBAAf,eACE,2BAAK,SAAS,CAAC,oBAAf,eACE,oBAAC,SAAD,EACE,GAAG,CAAEP,GADP,CAEE,IAAI,CAAEO,IAFR,CAGE,aAAa,CAAE,KAAKJ,aAHtB,CAIE,UAAU,CAAE,KAAKG,cAJnB,CAKE,QAAQ,CAAE,KAAKiC,YALjB,EADF,CADF,cAUE,2BAAK,SAAS,CAAC,sBAAf,eACE,8BAAQ,OAAO,CAAEuB,OAAjB,iBADF,cAEE,8BAAQ,SAAS,CAAE,QAAnB,CAA6B,OAAO,CAAE,yBAAM,CAAA,MAAI,CAACL,UAAL,EAAN,EAAtC,iBAFF,CAVF,CADF,CADF,CAqBD,C,sBAnIoB/D,KAAK,CAACqE,S,EAqI7B,cAAenE,CAAAA,QAAf","sourcesContent":["import React from \"react\";\r\nimport ReactCrop from \"react-image-crop\";\r\nclass CropDemo extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      image: null,\r\n      crop: {\r\n        width: 90,\r\n        aspect: 1 / 1,\r\n        unit: \"%\",\r\n      },\r\n      croppedImageUrl: null,\r\n    };\r\n    this.inputFile = React.createRef();\r\n  }\r\n\r\n  componentWillReceiveProps = (nextProps) => {\r\n    const { src } = nextProps;\r\n    if (!src) {\r\n      this.setState({\r\n        croppedImageUrl: null,\r\n      });\r\n    }\r\n  };\r\n\r\n  onImageLoaded = (image) => {\r\n    this.imageRef = image;\r\n  };\r\n\r\n  onCropComplete = async (crop) => {\r\n    if (this.imageRef && crop.width && crop.height) {\r\n      const croppedImageUrl = await this.onGetCropImg(\r\n        this.imageRef,\r\n        crop,\r\n        \"newFile.jpeg\"\r\n      );\r\n      this.setState({ croppedImageUrl });\r\n      // console.log(croppedImageUrl)\r\n    }\r\n  };\r\n\r\n  onGetCropImg = (image, crop, fileName) => {\r\n    const canvas = document.createElement(\"canvas\");\r\n    const scaleX = image.naturalWidth / image.width;\r\n    const scaleY = image.naturalHeight / image.height;\r\n    canvas.width = 350;\r\n    canvas.height = 350;\r\n    const ctx = canvas.getContext(\"2d\");\r\n\r\n    ctx.drawImage(\r\n      image,\r\n      crop.x * scaleX,\r\n      crop.y * scaleY,\r\n      crop.width * scaleX,\r\n      crop.height * scaleY,\r\n      0,\r\n      0,\r\n      350,\r\n      350\r\n    );\r\n    return new Promise((resolve, reject) => {\r\n      canvas.toBlob((blob) => {\r\n        if (!blob) {\r\n          // reject(new Error('Canvas is empty'));\r\n          console.error(\"Canvas is empty\");\r\n          return;\r\n        }\r\n        blob.name = fileName;\r\n        window.URL.revokeObjectURL(this.fileUrl);\r\n        this.fileUrl = window.URL.createObjectURL(blob);\r\n        console.warn(\"he\", blob.size);\r\n        // resolve(this.fileUrl);\r\n        resolve(blob);\r\n        // resolve(canvas.toDataURL('image/jpeg'));\r\n        // console.log(canvas.toDataURL('image/jpeg'))\r\n      }, \"image/jpeg\");\r\n    });\r\n  };\r\n\r\n  onCropChange = (crop, percentCrop) => {\r\n    this.setState({ crop });\r\n  };\r\n\r\n  onSelectFile = (e) => {\r\n    if (e.target.files && e.target.files.length > 0) {\r\n      const reader = new FileReader();\r\n      reader.addEventListener(\"load\", () => {\r\n        this.setState({ image: reader.result });\r\n      });\r\n      reader.readAsDataURL(e.target.files[0]);\r\n    }\r\n  };\r\n  ScanNow = () => {\r\n    this.inputFile.click();\r\n  };\r\n\r\n  CropNow = () => {\r\n    this.props.onCrop(this.state.croppedImageUrl);\r\n  };\r\n\r\n  onSendBack = () => {\r\n    const { updateCustomPhoto } = this.props;\r\n    const { croppedImageUrl } = this.state;\r\n    if (croppedImageUrl) {\r\n      updateCustomPhoto(croppedImageUrl, \"custom\");\r\n    }\r\n  };\r\n\r\n  render() {\r\n    const { onClose, src } = this.props;\r\n    const { crop } = this.state;\r\n    return (\r\n      <div className=\"modal-custom-wrap\">\r\n        <div className=\"modal-custom-content\">\r\n          <div className=\"modal-custom-image\">\r\n            <ReactCrop\r\n              src={src}\r\n              crop={crop}\r\n              onImageLoaded={this.onImageLoaded}\r\n              onComplete={this.onCropComplete}\r\n              onChange={this.onCropChange}\r\n            />\r\n          </div>\r\n          <div className=\"modal-custom-buttons\">\r\n            <button onClick={onClose}>取消</button>\r\n            <button className={\"active\"} onClick={() => this.onSendBack()}>\r\n              保存\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\nexport default CropDemo;\r\n"]},"metadata":{},"sourceType":"module"}