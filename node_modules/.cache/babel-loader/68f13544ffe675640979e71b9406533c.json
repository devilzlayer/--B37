{"ast":null,"code":"import _objectSpread from\"/Users/cramj/Documents/New PWA/ubet-project (1)/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/cramj/Documents/New PWA/ubet-project (1)/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import{useHistory}from\"react-router-dom\";import cx from\"classnames\";import{isEmpty}from\"lodash\";import{Inbox as _Inbox}from\"../../service/\";import{Wrap}from\"../view/profile/\";import{withAuth}from\"../util/\";import\"../assets/scss/Inbox.scss\";var status=[\"未读\",\"已读\"];var Inbox=function Inbox(){var history=useHistory();var _useState=useState({status:0,list:[]}),_useState2=_slicedToArray(_useState,2),messages=_useState2[0],setMessages=_useState2[1];useEffect(function(){setMessages({status:0,list:[]});var req=_Inbox.read({record_type:\"message\"});req.promise.then(function(r){// console.info(r);\nsetMessages({status:1,list:r.info.map(function(m){return m;})});},function(e){if(!e.is_aborted){console.warn(e);}});return function(){return req.cancel();};},[]);var open=function open(_ref,i){var id=_ref.id;var _m=messages.list[i];if(!_m.content){setMessages(function(m){return _objectSpread(_objectSpread({},m),{},{status:0});});_Inbox.readCurrent({id:id}).promise.then(function(r){_m.opened=!_m.opened;_m.content=r.info.content;_m.message_status=1;setMessages(function(m){return _objectSpread(_objectSpread({},m),{},{list:m.list.filter(function(m,_i){return _i===i?_m:m;}),status:1});});},function(e){if(!e.is_aborted){console.warn(e);}});}else{_m.opened=!_m.opened;setMessages(function(m){return _objectSpread(_objectSpread({},m),{},{list:m.list.filter(function(m,_i){return _i===i?_m:m;})});});}};var _messagesList=messages.list.map(function(m,i){return/*#__PURE__*/React.createElement(\"div\",{className:cx(\"messages-list--item\",{opened:m.opened}),key:i,onClick:function onClick(e){return open(m,i,e);}},/*#__PURE__*/React.createElement(\"div\",{className:\"messages-list--item-wrap\"},/*#__PURE__*/React.createElement(\"div\",{className:\"m-content\"},/*#__PURE__*/React.createElement(\"p\",{className:\"subject\"},m.subject),/*#__PURE__*/React.createElement(\"p\",{className:\"timestamp\"},m.send_time)),/*#__PURE__*/React.createElement(\"div\",{className:\"m-status\"},/*#__PURE__*/React.createElement(\"p\",{className:cx(\"status\",{unread:m.message_status===0})},status[m.message_status]))),/*#__PURE__*/React.createElement(\"div\",{className:\"messages-list--item-content\"},/*#__PURE__*/React.createElement(\"p\",null,m.content)));});return/*#__PURE__*/React.createElement(Wrap,{className:\"messages-wrap mobile\",centerName:\"\\u4FE1\\u606F\",faq:false,isLoading:!messages.status,sublevel:[true,function(){return history.goBack();}]},/*#__PURE__*/React.createElement(\"div\",{className:\"messages-list\"},!isEmpty(_messagesList)?_messagesList:/*#__PURE__*/React.createElement(\"div\",{className:\"no-transactions\"},/*#__PURE__*/React.createElement(\"div\",{className:\"image-box\"}),/*#__PURE__*/React.createElement(\"span\",null,\"\\u6682\\u65E0\\u8BB0\\u5F55\"))));};// export default Inbox;\nexport default withAuth(Inbox,1);","map":{"version":3,"sources":["/Users/cramj/Documents/New PWA/ubet-project (1)/src/pwa/view/Inbox.jsx"],"names":["React","useEffect","useState","useHistory","cx","isEmpty","Inbox","_Inbox","Wrap","withAuth","status","history","list","messages","setMessages","req","read","record_type","promise","then","r","info","map","m","e","is_aborted","console","warn","cancel","open","i","id","_m","content","readCurrent","opened","message_status","filter","_i","_messagesList","subject","send_time","unread","goBack"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { useHistory } from \"react-router-dom\";\r\nimport cx from \"classnames\";\r\nimport { isEmpty } from \"lodash\";\r\n\r\nimport { Inbox as _Inbox } from \"../../service/\";\r\nimport { Wrap } from \"../view/profile/\";\r\nimport { withAuth } from \"../util/\";\r\n\r\nimport \"../assets/scss/Inbox.scss\";\r\n\r\nconst status = [\"未读\", \"已读\"];\r\n\r\nconst Inbox = () => {\r\n  const history = useHistory();\r\n\r\n  const [messages, setMessages] = useState({\r\n    status: 0,\r\n    list: [],\r\n  });\r\n\r\n  useEffect(() => {\r\n    setMessages({\r\n      status: 0,\r\n      list: [],\r\n    });\r\n\r\n    const req = _Inbox.read({\r\n      record_type: \"message\",\r\n    });\r\n\r\n    req.promise.then(\r\n      (r) => {\r\n        // console.info(r);\r\n\r\n        setMessages({\r\n          status: 1,\r\n          list: r.info.map((m) => m),\r\n        });\r\n      },\r\n      (e) => {\r\n        if (!e.is_aborted) {\r\n          console.warn(e);\r\n        }\r\n      }\r\n    );\r\n\r\n    return () => req.cancel();\r\n  }, []);\r\n\r\n  const open = ({ id }, i) => {\r\n    const _m = messages.list[i];\r\n\r\n    if (!_m.content) {\r\n      setMessages((m) => ({\r\n        ...m,\r\n        status: 0,\r\n      }));\r\n\r\n      _Inbox.readCurrent({ id }).promise.then(\r\n        (r) => {\r\n          _m.opened = !_m.opened;\r\n          _m.content = r.info.content;\r\n          _m.message_status = 1;\r\n\r\n          setMessages((m) => ({\r\n            ...m,\r\n            list: m.list.filter((m, _i) => (_i === i ? _m : m)),\r\n            status: 1,\r\n          }));\r\n        },\r\n        (e) => {\r\n          if (!e.is_aborted) {\r\n            console.warn(e);\r\n          }\r\n        }\r\n      );\r\n    } else {\r\n      _m.opened = !_m.opened;\r\n\r\n      setMessages((m) => ({\r\n        ...m,\r\n        list: m.list.filter((m, _i) => (_i === i ? _m : m)),\r\n      }));\r\n    }\r\n  };\r\n\r\n  const _messagesList = messages.list.map((m, i) => (\r\n    <div\r\n      className={cx(\"messages-list--item\", { opened: m.opened })}\r\n      key={i}\r\n      onClick={(e) => open(m, i, e)}\r\n    >\r\n      <div className=\"messages-list--item-wrap\">\r\n        <div className=\"m-content\">\r\n          <p className=\"subject\">{m.subject}</p>\r\n          <p className=\"timestamp\">{m.send_time}</p>\r\n        </div>\r\n        <div className=\"m-status\">\r\n          <p className={cx(\"status\", { unread: m.message_status === 0 })}>\r\n            {status[m.message_status]}\r\n          </p>\r\n        </div>\r\n      </div>\r\n      <div className=\"messages-list--item-content\">\r\n        <p>{m.content}</p>\r\n      </div>\r\n    </div>\r\n  ));\r\n\r\n  return (\r\n    <Wrap\r\n      className=\"messages-wrap mobile\"\r\n      centerName=\"信息\"\r\n      faq={false}\r\n      isLoading={!messages.status}\r\n      sublevel={[true, () => history.goBack()]}\r\n    >\r\n      <div className=\"messages-list\">\r\n        {!isEmpty(_messagesList) ? (\r\n          _messagesList\r\n        ) : (\r\n          <div className=\"no-transactions\">\r\n            <div className=\"image-box\" />\r\n            <span>暂无记录</span>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </Wrap>\r\n  );\r\n};\r\n\r\n// export default Inbox;\r\nexport default withAuth(Inbox, 1);"]},"metadata":{},"sourceType":"module"}