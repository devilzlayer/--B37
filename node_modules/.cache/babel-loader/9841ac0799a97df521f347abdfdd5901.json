{"ast":null,"code":"import _objectSpread from\"/Users/cramj/Documents/New PWA/GIT/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/cramj/Documents/New PWA/GIT/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,useContext}from\"react\";import Ticker from\"react-ticker\";import{Promotions}from\"../../service\";import{withAuth}from\"../util/\";import{SliderSA,ContentSA,UserSA,PromoOverSA,TickerOverSA}from\"../component/\";import{User}from'../../service/';var Home=function Home(_ref){var location=_ref.location,history=_ref.history;var state=location.state;var _useContext=useContext(User.Context),userAuth=_useContext.userAuth;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),promoOver=_useState2[0],setPromoOver=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),tickerOver=_useState4[0],setTickerOver=_useState4[1];var _useState5=useState({text:\"\",news:[]}),_useState6=_slicedToArray(_useState5,2),ticker=_useState6[0],setTicker=_useState6[1];useEffect(function(){var q=Promotions.getAnnouncements({num:1});q.promise.then(function(r){// console.log(r)\nsetTicker(function(t){return _objectSpread(_objectSpread({},t),{},{text:r.info.map(function(n){return n.content;}).join(\" \"),news:r.info.map(function(n){return{title:n.content,text:n.edit_time};})});});},function(e){if(!e.is_aborted){console.warn(e);}});return function(){return q.cancel();};},[]);useEffect(function(){if(state===null||state===void 0?void 0:state.from_login){// setPromoOver(true);\nhistory.replace();}},[history,state]);useEffect(function(){window.scrollTo(0,0);document.body.classList.add(\"pwa-home-page\");return function(){return document.body.classList.remove(\"pwa-home-page\");};},[]);var onSetTick=function onSetTick(){if(!userAuth.data){history.push('login');return false;}setTickerOver(true);};// console.log(ticker)\nreturn/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"app-sa-head\"},/*#__PURE__*/React.createElement(SliderSA,null),/*#__PURE__*/React.createElement(\"div\",{className:\"app-sa-ticker\",onClick:onSetTick},ticker.text?/*#__PURE__*/React.createElement(Ticker,{speed:3},function(){return/*#__PURE__*/React.createElement(\"p\",null,ticker.text);}):null),/*#__PURE__*/React.createElement(UserSA,null)),/*#__PURE__*/React.createElement(ContentSA,null),promoOver?/*#__PURE__*/React.createElement(PromoOverSA,{onClose:function onClose(){return setPromoOver(false);}}):null,tickerOver?/*#__PURE__*/React.createElement(TickerOverSA,{onClose:function onClose(){return setTickerOver(false);},news:ticker.news}):null);};// export default Home\nexport default withAuth(Home,0);","map":{"version":3,"sources":["/Users/cramj/Documents/New PWA/GIT/src/pwa/view/Home.js"],"names":["React","useState","useEffect","useContext","Ticker","Promotions","withAuth","SliderSA","ContentSA","UserSA","PromoOverSA","TickerOverSA","User","Home","location","history","state","Context","userAuth","promoOver","setPromoOver","tickerOver","setTickerOver","text","news","ticker","setTicker","q","getAnnouncements","num","promise","then","r","t","info","map","n","content","join","title","edit_time","e","is_aborted","console","warn","cancel","from_login","replace","window","scrollTo","document","body","classList","add","remove","onSetTick","data","push"],"mappings":"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","sourcesContent":["import React, { useState, useEffect , useContext } from \"react\";\r\nimport Ticker from \"react-ticker\";\r\n\r\nimport { Promotions } from \"../../service\";\r\nimport { withAuth } from \"../util/\";\r\nimport {\r\n  SliderSA,\r\n  ContentSA,\r\n  UserSA,\r\n  PromoOverSA,\r\n  TickerOverSA,\r\n} from \"../component/\";\r\nimport { User } from '../../service/';\r\n\r\n\r\nconst Home = ({ location, history }) => {\r\n  const { state } = location;\r\n  const { userAuth } = useContext(User.Context);\r\n  const [promoOver, setPromoOver] = useState(false);\r\n  const [tickerOver, setTickerOver] = useState(false);\r\n\r\n  const [ticker, setTicker] = useState({\r\n    text: \"\",\r\n    news: [],\r\n  });\r\n\r\n  useEffect(() => {\r\n    const q = Promotions.getAnnouncements({ num: 1 });\r\n\r\n    q.promise.then( (r) => {\r\n        // console.log(r)\r\n        setTicker((t) => ({\r\n          ...t,\r\n          text: r.info.map((n) => n.content).join(\" \"),\r\n          news: r.info.map((n) => ({ title: n.content, text: n.edit_time })),\r\n        }));\r\n      },\r\n      (e) => {\r\n        if (!e.is_aborted) {\r\n          console.warn(e);\r\n        }\r\n      }\r\n    );\r\n\r\n    return () => q.cancel();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (state?.from_login) {\r\n      // setPromoOver(true);\r\n      history.replace();\r\n    }\r\n  }, [history, state]);\r\n\r\n  useEffect(() => {\r\n\r\n    window.scrollTo(0, 0);\r\n    document.body.classList.add(\"pwa-home-page\");\r\n    return () => document.body.classList.remove(\"pwa-home-page\");\r\n\r\n  }, []);\r\n\r\n\r\n  const onSetTick = () =>{\r\n    if(!userAuth.data){\r\n      history.push('login')\r\n      return false\r\n    }\r\n    setTickerOver(true)\r\n\r\n  }\r\n\r\n\r\n  // console.log(ticker)\r\n  return (\r\n    <>\r\n      <div className=\"app-sa-head\">\r\n        <SliderSA />\r\n        <div className=\"app-sa-ticker\" onClick={onSetTick}>\r\n          {ticker.text ? (\r\n            <Ticker speed={3}>{() => <p>{ticker.text}</p>}</Ticker>\r\n          ) : null}\r\n        </div>\r\n        <UserSA />\r\n      </div>\r\n      <ContentSA />\r\n      {promoOver ? <PromoOverSA onClose={() => setPromoOver(false)} /> : null}\r\n      {tickerOver ? (\r\n        <TickerOverSA onClose={() => setTickerOver(false)} news={ticker.news} />\r\n      ) : null}\r\n    </>\r\n  );\r\n};\r\n\r\n// export default Home\r\nexport default withAuth(Home,0 );\r\n"]},"metadata":{},"sourceType":"module"}