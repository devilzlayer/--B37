{"ast":null,"code":"var _jsxFileName = \"/Users/cramj/Documents/New PWA/ubet-project (1)/src/view/Restore.js\";\nimport React, { useState, useRef, useEffect, useContext } from \"react\";\nimport { Link, useHistory } from \"react-router-dom\";\nimport { FormField, LiveChat } from \"../component/\";\nimport { User } from \"../service/\";\nimport \"../assets/scss/Restore.scss\";\n\nfunction Restore() {\n  const [isLoading, setLoading] = useState(false);\n  const history = useHistory();\n  const {\n    userAuth: {\n      data\n    },\n    setUserAuthFN\n  } = useContext(User.Context);\n  const [status, setStatus] = useState(1);\n  const [form, setForm] = useState({\n    username: \"\",\n    phone: \"\",\n    code: \"\"\n  });\n  const refUsername = useRef(null);\n  const refcellphone = useRef(null);\n  const refcode = useRef(null);\n  const [message, setMessage] = useState({\n    className: null,\n    source: null,\n    message: null\n  });\n\n  const notify = (state, source, message) => {\n    setMessage({\n      className: state ? \"valid\" : \"invalid\",\n      source,\n      message\n    });\n  };\n\n  const [active, setActive] = useState(false);\n  const [disabled, setDisabled] = useState(false);\n  const [buttonActive, setButtonActive] = useState(false);\n  const [livechat, setLiveChat] = useState(false);\n  useEffect(() => {\n    window.scrollTo(0, 0);\n    document.body.classList.add(\"login-page\");\n    return () => document.body.classList.remove(\"login-page\");\n  }, []);\n  useEffect(() => {\n    function numbersOnly(value) {\n      const re = /^[0-9]*$/;\n      return re.test(value);\n    }\n\n    if (form.username !== \"\" && form.phone !== \"\" && form.phone.length === 11) {\n      setButtonActive(true);\n    }\n\n    if (form.username !== \"\" && form.phone !== \"\" && form.phone.length === 11 && numbersOnly(form.phone) && form.code !== \"\") setActive(true);else setActive(false);\n  }, [form]);\n\n  const onChange = e => {\n    const {\n      name,\n      value\n    } = e.target;\n\n    if (message.message && message.source === name) {\n      setMessage({\n        className: null,\n        source: null,\n        message: null\n      });\n    }\n\n    setForm(f => ({ ...f,\n      [name]: value\n    }));\n  };\n\n  const update = () => {\n    setStatus(0);\n    User.retrievePassword({ ...User.read(),\n      phone: form.phone,\n      account: form.username,\n      verification_code: form.code\n    }).promise.then(r => {\n      console.info(r);\n      setLiveChat(true); // User.session({\n      //   ...User.read(),\n      // }).promise.then((r) => setUserAuthFN(1, r.info));\n    }, e => {\n      console.warn(e);\n    });\n  };\n\n  function verification() {\n    setButtonActive(false);\n    setTimeout(() => {\n      setButtonActive(true);\n    }, 60000);\n\n    if (form.phone !== \"\") {\n      const req = User.mobileVerification({\n        type: \"verification_code\",\n        phone: form.phone,\n        ...User.read()\n      });\n      req.promise.then(r => {\n        console.log(\"Verification sent!\", r);\n      }, e => {\n        console.warn(\"Verification nto generated\", e);\n      });\n    } else {// console.log('Empty')\n    }\n  }\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"restoree-wrap\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"restore-form\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"restore-form-wrap\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"restore-form-outer\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"restore-header\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"load-spin\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"logo\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"divider\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 15\n    }\n  }, \"\\u8D5E\\u52A9\\u4F19\\u4F34\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sub-logo\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sub-text\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 15\n    }\n  }, \"\\u5965\\u683C\\u65AF\\u5821\")), /*#__PURE__*/React.createElement(\"div\", {\n    className: `restore-form-inner with-loader${isLoading ? \" loading\" : \"\"}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"restore-form-outer-bottom\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"auth-tabs\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"ui-tabs\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: `ui-tabs--tab active`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 21\n    }\n  }, \"\\u8054\\u7CFB\\u5BA2\\u670D\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"ui-tabs--tab nonactive\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 166,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(Link, {\n    to: \"/login\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 23\n    }\n  }, \"\\u767B\\u5F55\")))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 171,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form-inner\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 172,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form-inner-content\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 173,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(FormField, {\n    field: {\n      label: \"用户名\"\n    },\n    input: {\n      id: \"username\",\n      name: \"username\",\n      type: \"text\",\n      placeholder: \"请输入用户名\",\n      ref: refUsername,\n      maxLength: 12,\n      onChange\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 174,\n      columnNumber: 23\n    }\n  }), /*#__PURE__*/React.createElement(FormField, {\n    field: {\n      label: \"手机号码\"\n    },\n    input: {\n      id: \"phone\",\n      name: \"phone\",\n      type: \"text\",\n      placeholder: \"请输入手机号码\",\n      ref: refcellphone,\n      maxLength: 11,\n      onChange,\n      onInput: () => refcellphone.current.value = refcellphone.current.value.replace(/[^0-9]/g, \"\")\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 23\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form-field verification\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 23\n    }\n  }, /*#__PURE__*/React.createElement(\"input\", {\n    id: \"code\",\n    name: \"code\",\n    type: \"text\",\n    placeholder: \"\\u8BF7\\u8F93\\u5165\\u624B\\u673A\\u9A8C\\u8BC1\\u7801\",\n    ref: refcode,\n    onChange: onChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 204,\n      columnNumber: 25\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    className: `code ${buttonActive && \"active\"}`,\n    onClick: buttonActive ? () => verification() : null,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 25\n    }\n  }, \"\\u53D1\\u9001\\u9A8C\\u8BC1\\u7801\")), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"submit\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 219,\n      columnNumber: 23\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: `form-button ${active && !disabled && \"form-button-active\"}`,\n    onClick: active && !disabled ? update : null,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 220,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 226,\n      columnNumber: 27\n    }\n  }, \"\\u4E0B\\u4E00\\u6B65\"))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"support\",\n    onClick: () => setLiveChat(true),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 229,\n      columnNumber: 23\n    }\n  }, \"\\u8054\\u7CFB\\u5BA2\\u670D\"))))))))), /*#__PURE__*/React.createElement(LiveChat, {\n    popup: livechat,\n    onPop: () => setLiveChat(false),\n    withoutTop: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 243,\n      columnNumber: 7\n    }\n  }));\n}\n\nexport default Restore;","map":{"version":3,"sources":["/Users/cramj/Documents/New PWA/ubet-project (1)/src/view/Restore.js"],"names":["React","useState","useRef","useEffect","useContext","Link","useHistory","FormField","LiveChat","User","Restore","isLoading","setLoading","history","userAuth","data","setUserAuthFN","Context","status","setStatus","form","setForm","username","phone","code","refUsername","refcellphone","refcode","message","setMessage","className","source","notify","state","active","setActive","disabled","setDisabled","buttonActive","setButtonActive","livechat","setLiveChat","window","scrollTo","document","body","classList","add","remove","numbersOnly","value","re","test","length","onChange","e","name","target","f","update","retrievePassword","read","account","verification_code","promise","then","r","console","info","warn","verification","setTimeout","req","mobileVerification","type","log","label","id","placeholder","ref","maxLength","onInput","current","replace"],"mappings":"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","sourcesContent":["import React, { useState, useRef, useEffect, useContext } from \"react\";\r\nimport { Link, useHistory } from \"react-router-dom\";\r\n\r\nimport { FormField, LiveChat } from \"../component/\";\r\nimport { User } from \"../service/\";\r\n\r\nimport \"../assets/scss/Restore.scss\";\r\n\r\nfunction Restore() {\r\n  const [isLoading, setLoading] = useState(false);\r\n  const history = useHistory();\r\n\r\n  const {\r\n    userAuth: { data },\r\n    setUserAuthFN,\r\n  } = useContext(User.Context);\r\n\r\n  const [status, setStatus] = useState(1);\r\n\r\n  const [form, setForm] = useState({\r\n    username: \"\",\r\n    phone: \"\",\r\n    code: \"\",\r\n  });\r\n\r\n  const refUsername = useRef(null);\r\n  const refcellphone = useRef(null);\r\n  const refcode = useRef(null);\r\n\r\n  const [message, setMessage] = useState({\r\n    className: null,\r\n    source: null,\r\n    message: null,\r\n  });\r\n\r\n  const notify = (state, source, message) => {\r\n    setMessage({\r\n      className: state ? \"valid\" : \"invalid\",\r\n      source,\r\n      message,\r\n    });\r\n  };\r\n\r\n  const [active, setActive] = useState(false);\r\n  const [disabled, setDisabled] = useState(false);\r\n  const [buttonActive, setButtonActive] = useState(false);\r\n  const [livechat, setLiveChat] = useState(false);\r\n\r\n  useEffect(() => {\r\n    window.scrollTo(0, 0);\r\n\r\n    document.body.classList.add(\"login-page\");\r\n\r\n    return () => document.body.classList.remove(\"login-page\");\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    function numbersOnly(value) {\r\n      const re = /^[0-9]*$/;\r\n      return re.test(value);\r\n    }\r\n\r\n    if (form.username !== \"\" && form.phone !== \"\" && form.phone.length === 11) {\r\n      setButtonActive(true);\r\n    }\r\n\r\n    if (\r\n      form.username !== \"\" &&\r\n      form.phone !== \"\" &&\r\n      form.phone.length === 11 &&\r\n      numbersOnly(form.phone) &&\r\n      form.code !== \"\"\r\n    )\r\n      setActive(true);\r\n    else setActive(false);\r\n  }, [form]);\r\n\r\n  const onChange = (e) => {\r\n    const { name, value } = e.target;\r\n\r\n    if (message.message && message.source === name) {\r\n      setMessage({\r\n        className: null,\r\n        source: null,\r\n        message: null,\r\n      });\r\n    }\r\n\r\n    setForm((f) => ({\r\n      ...f,\r\n      [name]: value,\r\n    }));\r\n  };\r\n\r\n  const update = () => {\r\n    setStatus(0);\r\n\r\n    User.retrievePassword({\r\n      ...User.read(),\r\n      phone: form.phone,\r\n      account: form.username,\r\n      verification_code: form.code,\r\n    }).promise.then(\r\n      (r) => {\r\n        console.info(r);\r\n        setLiveChat(true);\r\n\r\n        // User.session({\r\n        //   ...User.read(),\r\n        // }).promise.then((r) => setUserAuthFN(1, r.info));\r\n      },\r\n      (e) => {\r\n        console.warn(e);\r\n      }\r\n    );\r\n  };\r\n\r\n  function verification() {\r\n    setButtonActive(false);\r\n\r\n    setTimeout(() => {\r\n      setButtonActive(true);\r\n    }, 60000);\r\n\r\n    if (form.phone !== \"\") {\r\n      const req = User.mobileVerification({\r\n        type: \"verification_code\",\r\n        phone: form.phone,\r\n        ...User.read(),\r\n      });\r\n\r\n      req.promise.then(\r\n        (r) => {\r\n          console.log(\"Verification sent!\", r);\r\n        },\r\n        (e) => {\r\n          console.warn(\"Verification nto generated\", e);\r\n        }\r\n      );\r\n    } else {\r\n      // console.log('Empty')\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"restoree-wrap\">\r\n      <div className=\"restore-form\">\r\n        <div className=\"restore-form-wrap\">\r\n          <div className=\"restore-form-outer\">\r\n            <div className=\"restore-header\">\r\n              <div className=\"load-spin\"></div>\r\n              <div className=\"logo\"></div>\r\n              <div className=\"divider\">赞助伙伴</div>\r\n              <div className=\"sub-logo\"></div>\r\n              <div className=\"sub-text\">奥格斯堡</div>\r\n            </div>\r\n            <div\r\n              className={`restore-form-inner with-loader${\r\n                isLoading ? \" loading\" : \"\"\r\n              }`}\r\n            >\r\n              <div className=\"restore-form-outer-bottom\">\r\n                <div className=\"auth-tabs\">\r\n                  <div className=\"ui-tabs\">\r\n                    <div className={`ui-tabs--tab active`}>联系客服</div>\r\n                    <div className={\"ui-tabs--tab nonactive\"}>\r\n                      <Link to=\"/login\">登录</Link>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                <div className=\"form\">\r\n                  <div className=\"form-inner\">\r\n                    <div className=\"form-inner-content\">\r\n                      <FormField\r\n                        field={{ label: \"用户名\" }}\r\n                        input={{\r\n                          id: \"username\",\r\n                          name: \"username\",\r\n                          type: \"text\",\r\n                          placeholder: \"请输入用户名\",\r\n                          ref: refUsername,\r\n                          maxLength: 12,\r\n                          onChange,\r\n                        }}\r\n                      />\r\n                      <FormField\r\n                        field={{ label: \"手机号码\" }}\r\n                        input={{\r\n                          id: \"phone\",\r\n                          name: \"phone\",\r\n                          type: \"text\",\r\n                          placeholder: \"请输入手机号码\",\r\n                          ref: refcellphone,\r\n                          maxLength: 11,\r\n                          onChange,\r\n                          onInput: () =>\r\n                            (refcellphone.current.value = refcellphone.current.value.replace(\r\n                              /[^0-9]/g,\r\n                              \"\"\r\n                            )),\r\n                        }}\r\n                      />\r\n                      <div className={\"form-field verification\"}>\r\n                        <input\r\n                          id=\"code\"\r\n                          name=\"code\"\r\n                          type=\"text\"\r\n                          placeholder=\"请输入手机验证码\"\r\n                          ref={refcode}\r\n                          onChange={onChange}\r\n                        />\r\n                        <button\r\n                          className={`code ${buttonActive && \"active\"}`}\r\n                          onClick={buttonActive ? () => verification() : null}\r\n                        >\r\n                          发送验证码\r\n                        </button>\r\n                      </div>\r\n                      <div className=\"submit\">\r\n                        <div\r\n                          className={`form-button ${\r\n                            active && !disabled && \"form-button-active\"\r\n                          }`}\r\n                          onClick={active && !disabled ? update : null}\r\n                        >\r\n                          <span>下一步</span>\r\n                        </div>\r\n                      </div>\r\n                      <div\r\n                        className=\"support\"\r\n                        onClick={() => setLiveChat(true)}\r\n                      >\r\n                        联系客服\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <LiveChat popup={livechat} onPop={() => setLiveChat(false)} withoutTop />\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Restore;\r\n"]},"metadata":{},"sourceType":"module"}