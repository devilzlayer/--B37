{"ast":null,"code":"var _jsxFileName = \"/Users/cramj/Documents/New PWA/GIT/src/view/Login.js\";\nimport React, { useState, useEffect, useRef } from \"react\";\nimport { Link, Redirect, useHistory, useLocation } from \"react-router-dom\";\nimport { UITabs, FormField } from \"../component/\";\nimport { User as Service } from \"../service/\";\nimport \"../assets/scss/Login.scss\";\n\nfunction useQuery() {\n  return new URLSearchParams(useLocation().search);\n}\n\nfunction FormSignin(props) {\n  const {\n    onLoading\n  } = props;\n  const {\n    state: {\n      referrer = \"/\"\n    } = {}\n  } = useLocation();\n  const refUsername = useRef(null);\n  const refPassword = useRef(null);\n  const [isValid, setValidity] = useState(true);\n  const [isLogged, setLogged] = useState(false);\n  const [active, setActive] = useState(false);\n  const [user, setUser] = useState({\n    username: null,\n    password: null\n  });\n  useEffect(() => {\n    if (isValid && user.username !== null && user.password !== null) setActive(true);\n  }, [user, isValid]);\n\n  function userChange(e) {\n    if (!isValid && e.target.name === \"password\" || e.target.name === \"username\" && user.password) {\n      setValidity(true);\n    }\n\n    setUser({ ...user,\n      [e.target.name]: e.target.value\n    });\n  }\n\n  function userLogin() {\n    if (!user.password) {\n      return void refPassword.current.focus();\n    }\n\n    onLoading(true);\n    const req = Service.login(user);\n    req.promise.then(r => {\n      localStorage.setItem(\"user\", JSON.stringify(user));\n      onLoading(false);\n      setLogged(true);\n    }, e => {\n      onLoading(false);\n      setValidity(false);\n      refPassword.current.focus();\n    });\n  }\n\n  if (isLogged) {\n    return /*#__PURE__*/React.createElement(Redirect, {\n      to: referrer,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 77,\n        columnNumber: 12\n      }\n    });\n  }\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form form--signin\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form-inner\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form-inner-content\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(FormField, {\n    field: {\n      label: \"用户名\"\n    },\n    input: {\n      id: \"username\",\n      name: \"username\",\n      type: \"text\",\n      placeholder: \"用户名(6至12位)\",\n      required: true,\n      onChange: userChange,\n      ref: refUsername\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(FormField, {\n    isValid: isValid,\n    field: {\n      label: \"密码\"\n    },\n    input: {\n      id: \"password\",\n      name: \"password\",\n      type: \"password\",\n      placeholder: \"密码(至少6位)\",\n      required: true,\n      onChange: userChange,\n      ref: refPassword\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 11\n    }\n  }), !isValid ? /*#__PURE__*/React.createElement(\"p\", {\n    style: {\n      color: \"#e4451b\",\n      marginTop: -15\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 13\n    }\n  }, \"\\u7528\\u6237\\u540D\\u6216\\u5BC6\\u7801\\u8F93\\u5165\\u4E0D\\u6B63\\u786E\") : null), /*#__PURE__*/React.createElement(\"button\", {\n    className: `submit ${active ? \"active\" : null}`,\n    onClick: active ? userLogin : null,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 9\n    }\n  }, \"\\u767B\\u5F55\")), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"restore-wrap\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Link, {\n    to: \"/restore\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 9\n    }\n  }, \"\\u5FD8\\u8BB0\\u5BC6\\u7801\\u4E86\\u5417 \\uFF1F\")));\n}\n\nfunction FormSignup(props) {\n  const {\n    onLoading\n  } = props;\n  const refUsername = useRef(null);\n  const refPassword = useRef(null);\n  const refPasswordOK = useRef(null);\n  const refTelephone = useRef(null);\n  const refRef = useRef(null);\n  const [isValid, setValidity] = useState(0);\n  const [isValidPassword, setPasswordValidity] = useState(0);\n  const [isValidPasswordok, setPasswordokValidity] = useState(0);\n  const [isValidTelephone, setTelephoneValidity] = useState(0);\n  const [isCreated, setCreated] = useState(false);\n  const [agent] = useState(props.agentName);\n  const [active, setActive] = useState(false);\n  const [oldUsername, setOldUsername] = useState(\"null\");\n  const [user, setUser] = useState({\n    username: null,\n    password: null,\n    passwordok: null\n  });\n  useEffect(() => {\n    if (!user.agentName && agent) {\n      setUser({ ...user,\n        agentName: agent\n      });\n    }\n  }, [user, agent]);\n\n  function onFocus() {\n    if (!user.username || user.username.length < 6) {\n      void refUsername.current.focus();\n    }\n  }\n\n  function outOfFocus(e) {\n    const userValid = !user.username || user.username.length < 6;\n\n    if (e.target.id === \"username\") {\n      if (!/^[a-z0-9]{6,12}$/i.test(user.username)) {\n        setValidity(1);\n        return null;\n      } else if (isValid !== 2) {\n        return setValidity(0);\n      }\n    }\n\n    if (e.target.id === \"password\") {\n      if (!userValid && user.password) {\n        if (user.password.length < 6) return setPasswordValidity(1);else return setPasswordValidity(0);\n      } else {\n        return setPasswordValidity(0);\n      }\n    }\n\n    if (e.target.id === \"passwordok\") {\n      if (!userValid && user.password !== user.passwordok) {\n        setPasswordokValidity(1);\n        return null;\n      } else {\n        return setPasswordokValidity(0);\n      }\n    }\n\n    if (e.target.id === \"telephone\") {\n      if (!userValid && user.telephone) {\n        if (user.telephone.length !== 11) setTelephoneValidity(1);\n        return null;\n      }\n    }\n  }\n\n  function userChange(e) {\n    if (e.target.name === \"telephone\") {\n      if (e.target.value.length === 11) {\n        setActive(true);\n        setTelephoneValidity(0);\n      } else if (active && !isValidTelephone) {\n        setActive(false);\n        setTelephoneValidity(1);\n      }\n    }\n\n    if (e.target.name === \"username\") {\n      if (isValid === 2 && e.target.value !== oldUsername) {\n        setValidity(0);\n      }\n    }\n\n    setUser({ ...user,\n      [e.target.name]: e.target.value\n    });\n  }\n\n  function userCreate() {\n    onLoading(true);\n    const req = Service.create(user);\n    req.promise.then(r => {\n      localStorage.setItem(\"user\", JSON.stringify({\n        username: user.username,\n        password: user.password\n      }));\n      onLoading(false);\n      setCreated(true);\n    }, e => {\n      console.warn(e);\n      onLoading(false);\n      setValidity(2);\n      setOldUsername(user.username);\n      refUsername.current.focus();\n    });\n  }\n\n  if (isCreated) {\n    return /*#__PURE__*/React.createElement(Redirect, {\n      to: \"/\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 260,\n        columnNumber: 12\n      }\n    });\n  }\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form form--signup\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 264,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form-inner\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 265,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form-inner-content signup\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 266,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(FormField, {\n    isValid: !isValid,\n    field: {\n      label: \"用户名\"\n    },\n    input: {\n      id: \"username\",\n      name: \"username\",\n      type: \"text\",\n      placeholder: \"用户名(6至12位)\",\n      required: true,\n      maxLength: 12,\n      onChange: userChange,\n      onBlur: outOfFocus,\n      ref: refUsername\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 267,\n      columnNumber: 11\n    }\n  }), isValid === 1 ? /*#__PURE__*/React.createElement(\"p\", {\n    style: {\n      color: \"#e4451b\",\n      marginTop: -19\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 283,\n      columnNumber: 13\n    }\n  }, \"6-12\\u4E2A\\u5B57\\u6BCD\\u6570\\u5B57\") : null, isValid === 2 ? /*#__PURE__*/React.createElement(\"p\", {\n    style: {\n      color: \"#e4451b\",\n      marginTop: -19\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 286,\n      columnNumber: 13\n    }\n  }, \"\\u6CE8\\u518C\\u5931\\u8D25\\uFF0C\\u4F1A\\u5458\\u5E10\\u53F7\\u5DF2\\u88AB\\u6CE8\\u518C\") : null, /*#__PURE__*/React.createElement(FormField, {\n    isValid: !isValidPassword,\n    field: {\n      label: \"密码\"\n    },\n    input: {\n      id: \"password\",\n      name: \"password\",\n      type: \"password\",\n      placeholder: \"密码(至少6位)\",\n      required: true,\n      onFocus: onFocus,\n      onChange: userChange,\n      onBlur: outOfFocus,\n      ref: refPassword\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 290,\n      columnNumber: 11\n    }\n  }), isValidPassword === 1 ? /*#__PURE__*/React.createElement(\"p\", {\n    style: {\n      color: \"#e4451b\",\n      marginTop: -19\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 306,\n      columnNumber: 13\n    }\n  }, \"\\u5BC6\\u7801\\u6700\\u77ED\\u4E3A6\\u4F4D\") : null, /*#__PURE__*/React.createElement(FormField, {\n    isValid: !isValidPasswordok,\n    field: {\n      label: \"请再次输入密码\"\n    },\n    input: {\n      id: \"passwordok\",\n      name: \"passwordok\",\n      type: \"password\",\n      placeholder: \"请再次输入密码\",\n      required: true,\n      onFocus: onFocus,\n      onChange: userChange,\n      onBlur: outOfFocus,\n      ref: refPasswordOK\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 308,\n      columnNumber: 11\n    }\n  }), isValidPasswordok === 1 ? /*#__PURE__*/React.createElement(\"p\", {\n    style: {\n      color: \"#e4451b\",\n      marginTop: -19\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 324,\n      columnNumber: 13\n    }\n  }, \"\\u4E24\\u6B21\\u8F93\\u5165\\u5BC6\\u7801\\u4E0D\\u4E00\\u81F4\") : null, /*#__PURE__*/React.createElement(FormField, {\n    isValid: !isValidTelephone,\n    field: {\n      label: \"请输入手机号码\"\n    },\n    input: {\n      id: \"telephone\",\n      name: \"telephone\",\n      type: \"text\",\n      placeholder: \"请输入手机号码\",\n      maxLength: 11,\n      required: true,\n      onChange: userChange,\n      onFocus: onFocus,\n      onBlur: outOfFocus,\n      ref: refTelephone,\n      onInput: () => refTelephone.current.value = refTelephone.current.value.replace(/[^0-9]/g, \"\")\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 328,\n      columnNumber: 11\n    }\n  }), isValidTelephone === 1 ? /*#__PURE__*/React.createElement(\"p\", {\n    style: {\n      color: \"#e4451b\",\n      marginTop: -19\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 350,\n      columnNumber: 13\n    }\n  }, \"\\u8BF7\\u8F93\\u516511\\u4F4D\\u624B\\u673A\\u53F7\") : null, /*#__PURE__*/React.createElement(FormField, {\n    field: {\n      label: \"好友优惠推荐码\"\n    },\n    input: {\n      id: \"agentName\",\n      name: \"agentName\",\n      type: \"text\",\n      placeholder: \"好友优惠推荐码(选填)\",\n      required: true,\n      onChange: userChange,\n      ref: refRef\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 352,\n      columnNumber: 11\n    }\n  })), /*#__PURE__*/React.createElement(\"button\", {\n    className: `submit ${active ? \"active\" : null}`,\n    onClick: active ? userCreate : null,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 365,\n      columnNumber: 9\n    }\n  }, \"\\u6CE8\\u518C\")));\n}\n\nfunction Login() {\n  const query = useQuery();\n  const history = useHistory();\n  const [tab, setTab] = useState(query.get(\"tab\") || \"signin\");\n  const [isLoading, setLoading] = useState(false);\n  useEffect(() => {\n    window.scrollTo(0, 0);\n    document.body.classList.add(\"login-page\");\n    return () => document.body.classList.remove(\"login-page\");\n  }, []);\n  useEffect(() => {\n    history.push({\n      search: `?tab=${tab}`\n    });\n  }, [history, tab]);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"login-wrap\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 396,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"login-form\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 397,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"login-form-wrap\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 398,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"login-form-outer\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 399,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"login-header\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 400,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"load-spin\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 401,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"logo\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 402,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"divider\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 403,\n      columnNumber: 15\n    }\n  }, \"\\u8D5E\\u52A9\\u4F19\\u4F34\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sub-logo\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 404,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sub-text\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 405,\n      columnNumber: 15\n    }\n  }, \"\\u5965\\u683C\\u65AF\\u5821\")), /*#__PURE__*/React.createElement(\"div\", {\n    className: `login-form-inner with-loader${isLoading ? \" loading\" : \"\"}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 407,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"login-form-outer-bottom\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 412,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"auth-tabs\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 413,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"ui-tabs\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 414,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: `ui-tabs--tab active`,\n    onClick: null,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 415,\n      columnNumber: 21\n    }\n  }, tab === \"signin\" ? \"登录\" : \"注册\"), /*#__PURE__*/React.createElement(\"div\", {\n    onClick: e => setTab(tab === \"signin\" ? \"signup\" : \"signin\"),\n    className: \"ui-tabs--tab nonactive\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 418,\n      columnNumber: 21\n    }\n  }, tab === \"signin\" ? \"注册\" : \"登录\"))), /*#__PURE__*/React.createElement(\"div\", {\n    className: `auth-forms tab--${tab}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 428,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(FormSignin, {\n    onLoading: setLoading,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 429,\n      columnNumber: 19\n    }\n  }), /*#__PURE__*/React.createElement(FormSignup, {\n    onLoading: setLoading,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 430,\n      columnNumber: 19\n    }\n  }))))))));\n}\n\nexport default Login;","map":{"version":3,"sources":["/Users/cramj/Documents/New PWA/GIT/src/view/Login.js"],"names":["React","useState","useEffect","useRef","Link","Redirect","useHistory","useLocation","UITabs","FormField","User","Service","useQuery","URLSearchParams","search","FormSignin","props","onLoading","state","referrer","refUsername","refPassword","isValid","setValidity","isLogged","setLogged","active","setActive","user","setUser","username","password","userChange","e","target","name","value","userLogin","current","focus","req","login","promise","then","r","localStorage","setItem","JSON","stringify","label","id","type","placeholder","required","onChange","ref","color","marginTop","FormSignup","refPasswordOK","refTelephone","refRef","isValidPassword","setPasswordValidity","isValidPasswordok","setPasswordokValidity","isValidTelephone","setTelephoneValidity","isCreated","setCreated","agent","agentName","oldUsername","setOldUsername","passwordok","onFocus","length","outOfFocus","userValid","test","telephone","userCreate","create","console","warn","maxLength","onBlur","onInput","replace","Login","query","history","tab","setTab","get","isLoading","setLoading","window","scrollTo","document","body","classList","add","remove","push"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\r\nimport { Link, Redirect, useHistory, useLocation } from \"react-router-dom\";\r\n\r\nimport { UITabs, FormField } from \"../component/\";\r\nimport { User as Service } from \"../service/\";\r\n\r\nimport \"../assets/scss/Login.scss\";\r\n\r\nfunction useQuery() {\r\n  return new URLSearchParams(useLocation().search);\r\n}\r\n\r\nfunction FormSignin(props) {\r\n  const { onLoading } = props;\r\n\r\n  const { state: { referrer = \"/\" } = {} } = useLocation();\r\n\r\n  const refUsername = useRef(null);\r\n  const refPassword = useRef(null);\r\n\r\n  const [isValid, setValidity] = useState(true);\r\n  const [isLogged, setLogged] = useState(false);\r\n  const [active, setActive] = useState(false);\r\n\r\n  const [user, setUser] = useState({\r\n    username: null,\r\n    password: null,\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (isValid && user.username !== null && user.password !== null)\r\n      setActive(true);\r\n  }, [user, isValid]);\r\n\r\n  function userChange(e) {\r\n    if (\r\n      (!isValid && e.target.name === \"password\") ||\r\n      (e.target.name === \"username\" && user.password)\r\n    ) {\r\n      setValidity(true);\r\n    }\r\n\r\n    setUser({\r\n      ...user,\r\n      [e.target.name]: e.target.value,\r\n    });\r\n  }\r\n\r\n  function userLogin() {\r\n    if (!user.password) {\r\n      return void refPassword.current.focus();\r\n    }\r\n\r\n    onLoading(true);\r\n\r\n    const req = Service.login(user);\r\n\r\n    req.promise.then(\r\n      (r) => {\r\n        localStorage.setItem(\"user\", JSON.stringify(user));\r\n\r\n        onLoading(false);\r\n\r\n        setLogged(true);\r\n      },\r\n      (e) => {\r\n        onLoading(false);\r\n\r\n        setValidity(false);\r\n\r\n        refPassword.current.focus();\r\n      }\r\n    );\r\n  }\r\n\r\n  if (isLogged) {\r\n    return <Redirect to={referrer} />;\r\n  }\r\n\r\n  return (\r\n    <div className=\"form form--signin\">\r\n      <div className=\"form-inner\">\r\n        <div className=\"form-inner-content\">\r\n          <FormField\r\n            field={{ label: \"用户名\" }}\r\n            input={{\r\n              id: \"username\",\r\n              name: \"username\",\r\n              type: \"text\",\r\n              placeholder: \"用户名(6至12位)\",\r\n              required: true,\r\n              onChange: userChange,\r\n              ref: refUsername,\r\n            }}\r\n          />\r\n          <FormField\r\n            isValid={isValid}\r\n            field={{ label: \"密码\" }}\r\n            input={{\r\n              id: \"password\",\r\n              name: \"password\",\r\n              type: \"password\",\r\n              placeholder: \"密码(至少6位)\",\r\n              required: true,\r\n              onChange: userChange,\r\n              ref: refPassword,\r\n            }}\r\n          />\r\n          {!isValid ? (\r\n            <p style={{ color: \"#e4451b\", marginTop: -15 }}>\r\n              用户名或密码输入不正确\r\n            </p>\r\n          ) : null}\r\n        </div>\r\n        <button\r\n          className={`submit ${active ? \"active\" : null}`}\r\n          onClick={active ? userLogin : null}\r\n        >\r\n          登录\r\n        </button>\r\n      </div>\r\n      <div className=\"restore-wrap\">\r\n        <Link to=\"/restore\">忘记密码了吗 ？</Link>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction FormSignup(props) {\r\n  const { onLoading } = props;\r\n\r\n  const refUsername = useRef(null);\r\n  const refPassword = useRef(null);\r\n  const refPasswordOK = useRef(null);\r\n  const refTelephone = useRef(null);\r\n  const refRef = useRef(null);\r\n\r\n  const [isValid, setValidity] = useState(0);\r\n  const [isValidPassword, setPasswordValidity] = useState(0);\r\n  const [isValidPasswordok, setPasswordokValidity] = useState(0);\r\n  const [isValidTelephone, setTelephoneValidity] = useState(0);\r\n  const [isCreated, setCreated] = useState(false);\r\n  const [agent] = useState(props.agentName);\r\n  const [active, setActive] = useState(false);\r\n  const [oldUsername, setOldUsername] = useState(\"null\");\r\n\r\n  const [user, setUser] = useState({\r\n    username: null,\r\n    password: null,\r\n    passwordok: null,\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (!user.agentName && agent) {\r\n      setUser({\r\n        ...user,\r\n        agentName: agent,\r\n      });\r\n    }\r\n  }, [user, agent]);\r\n\r\n  function onFocus() {\r\n    if (!user.username || user.username.length < 6) {\r\n      void refUsername.current.focus();\r\n    }\r\n  }\r\n\r\n  function outOfFocus(e) {\r\n    const userValid = !user.username || user.username.length < 6;\r\n    if (e.target.id === \"username\") {\r\n      if (!/^[a-z0-9]{6,12}$/i.test(user.username)) {\r\n        setValidity(1);\r\n        return null;\r\n      } else if (isValid !== 2) {\r\n        return setValidity(0);\r\n      }\r\n    }\r\n    if (e.target.id === \"password\") {\r\n      if (!userValid && user.password) {\r\n        if (user.password.length < 6) return setPasswordValidity(1);\r\n        else return setPasswordValidity(0);\r\n      } else {\r\n        return setPasswordValidity(0);\r\n      }\r\n    }\r\n\r\n    if (e.target.id === \"passwordok\") {\r\n      if (!userValid && user.password !== user.passwordok) {\r\n        setPasswordokValidity(1);\r\n        return null;\r\n      } else {\r\n        return setPasswordokValidity(0);\r\n      }\r\n    }\r\n\r\n    if (e.target.id === \"telephone\") {\r\n      if (!userValid && user.telephone) {\r\n        if (user.telephone.length !== 11) setTelephoneValidity(1);\r\n        return null;\r\n      }\r\n    }\r\n  }\r\n\r\n  function userChange(e) {\r\n    if (e.target.name === \"telephone\") {\r\n      if (e.target.value.length === 11) {\r\n        setActive(true);\r\n        setTelephoneValidity(0);\r\n      } else if (active && !isValidTelephone) {\r\n        setActive(false);\r\n        setTelephoneValidity(1);\r\n      }\r\n    }\r\n\r\n    if (e.target.name === \"username\") {\r\n      if (isValid === 2 && e.target.value !== oldUsername) {\r\n        setValidity(0);\r\n      }\r\n    }\r\n\r\n    setUser({\r\n      ...user,\r\n      [e.target.name]: e.target.value,\r\n    });\r\n  }\r\n\r\n  function userCreate() {\r\n    onLoading(true);\r\n\r\n    const req = Service.create(user);\r\n\r\n    req.promise.then(\r\n      (r) => {\r\n        localStorage.setItem(\r\n          \"user\",\r\n          JSON.stringify({\r\n            username: user.username,\r\n            password: user.password,\r\n          })\r\n        );\r\n\r\n        onLoading(false);\r\n\r\n        setCreated(true);\r\n      },\r\n      (e) => {\r\n        console.warn(e);\r\n\r\n        onLoading(false);\r\n\r\n        setValidity(2);\r\n        setOldUsername(user.username);\r\n\r\n        refUsername.current.focus();\r\n      }\r\n    );\r\n  }\r\n\r\n  if (isCreated) {\r\n    return <Redirect to=\"/\" />;\r\n  }\r\n\r\n  return (\r\n    <div className=\"form form--signup\">\r\n      <div className=\"form-inner\">\r\n        <div className=\"form-inner-content signup\">\r\n          <FormField\r\n            isValid={!isValid}\r\n            field={{ label: \"用户名\" }}\r\n            input={{\r\n              id: \"username\",\r\n              name: \"username\",\r\n              type: \"text\",\r\n              placeholder: \"用户名(6至12位)\",\r\n              required: true,\r\n              maxLength: 12,\r\n              onChange: userChange,\r\n              onBlur: outOfFocus,\r\n              ref: refUsername,\r\n            }}\r\n          />\r\n          {isValid === 1 ? (\r\n            <p style={{ color: \"#e4451b\", marginTop: -19 }}>6-12个字母数字</p>\r\n          ) : null}\r\n          {isValid === 2 ? (\r\n            <p style={{ color: \"#e4451b\", marginTop: -19 }}>\r\n              注册失败，会员帐号已被注册\r\n            </p>\r\n          ) : null}\r\n          <FormField\r\n            isValid={!isValidPassword}\r\n            field={{ label: \"密码\" }}\r\n            input={{\r\n              id: \"password\",\r\n              name: \"password\",\r\n              type: \"password\",\r\n              placeholder: \"密码(至少6位)\",\r\n              required: true,\r\n              onFocus: onFocus,\r\n              onChange: userChange,\r\n              onBlur: outOfFocus,\r\n              ref: refPassword,\r\n            }}\r\n          />\r\n          {isValidPassword === 1 ? (\r\n            <p style={{ color: \"#e4451b\", marginTop: -19 }}>密码最短为6位</p>\r\n          ) : null}\r\n          <FormField\r\n            isValid={!isValidPasswordok}\r\n            field={{ label: \"请再次输入密码\" }}\r\n            input={{\r\n              id: \"passwordok\",\r\n              name: \"passwordok\",\r\n              type: \"password\",\r\n              placeholder: \"请再次输入密码\",\r\n              required: true,\r\n              onFocus: onFocus,\r\n              onChange: userChange,\r\n              onBlur: outOfFocus,\r\n              ref: refPasswordOK,\r\n            }}\r\n          />\r\n          {isValidPasswordok === 1 ? (\r\n            <p style={{ color: \"#e4451b\", marginTop: -19 }}>\r\n              两次输入密码不一致\r\n            </p>\r\n          ) : null}\r\n          <FormField\r\n            isValid={!isValidTelephone}\r\n            field={{ label: \"请输入手机号码\" }}\r\n            input={{\r\n              id: \"telephone\",\r\n              name: \"telephone\",\r\n              type: \"text\",\r\n              placeholder: \"请输入手机号码\",\r\n              maxLength: 11,\r\n              required: true,\r\n              onChange: userChange,\r\n              onFocus: onFocus,\r\n              onBlur: outOfFocus,\r\n              ref: refTelephone,\r\n              onInput: () =>\r\n                (refTelephone.current.value = refTelephone.current.value.replace(\r\n                  /[^0-9]/g,\r\n                  \"\"\r\n                )),\r\n            }}\r\n          />\r\n          {isValidTelephone === 1 ? (\r\n            <p style={{ color: \"#e4451b\", marginTop: -19 }}>请输入11位手机号</p>\r\n          ) : null}\r\n          <FormField\r\n            field={{ label: \"好友优惠推荐码\" }}\r\n            input={{\r\n              id: \"agentName\",\r\n              name: \"agentName\",\r\n              type: \"text\",\r\n              placeholder: \"好友优惠推荐码(选填)\",\r\n              required: true,\r\n              onChange: userChange,\r\n              ref: refRef,\r\n            }}\r\n          />\r\n        </div>\r\n        <button\r\n          className={`submit ${active ? \"active\" : null}`}\r\n          onClick={active ? userCreate : null}\r\n        >\r\n          注册\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction Login() {\r\n  const query = useQuery();\r\n  const history = useHistory();\r\n\r\n  const [tab, setTab] = useState(query.get(\"tab\") || \"signin\");\r\n  const [isLoading, setLoading] = useState(false);\r\n\r\n  useEffect(() => {\r\n    window.scrollTo(0, 0);\r\n\r\n    document.body.classList.add(\"login-page\");\r\n\r\n    return () => document.body.classList.remove(\"login-page\");\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    history.push({ search: `?tab=${tab}` });\r\n  }, [history, tab]);\r\n\r\n  return (\r\n    <div className=\"login-wrap\">\r\n      <div className=\"login-form\">\r\n        <div className=\"login-form-wrap\">\r\n          <div className=\"login-form-outer\">\r\n            <div className=\"login-header\">\r\n              <div className=\"load-spin\"></div>\r\n              <div className=\"logo\"></div>\r\n              <div className=\"divider\">赞助伙伴</div>\r\n              <div className=\"sub-logo\"></div>\r\n              <div className=\"sub-text\">奥格斯堡</div>\r\n            </div>\r\n            <div\r\n              className={`login-form-inner with-loader${\r\n                isLoading ? \" loading\" : \"\"\r\n              }`}\r\n            >\r\n              <div className=\"login-form-outer-bottom\">\r\n                <div className=\"auth-tabs\">\r\n                  <div className=\"ui-tabs\">\r\n                    <div className={`ui-tabs--tab active`} onClick={null}>\r\n                      {tab === \"signin\" ? \"登录\" : \"注册\"}\r\n                    </div>\r\n                    <div\r\n                      onClick={(e) =>\r\n                        setTab(tab === \"signin\" ? \"signup\" : \"signin\")\r\n                      }\r\n                      className={\"ui-tabs--tab nonactive\"}\r\n                    >\r\n                      {tab === \"signin\" ? \"注册\" : \"登录\"}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                <div className={`auth-forms tab--${tab}`}>\r\n                  <FormSignin onLoading={setLoading} />\r\n                  <FormSignup onLoading={setLoading} />\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Login;\r\n"]},"metadata":{},"sourceType":"module"}