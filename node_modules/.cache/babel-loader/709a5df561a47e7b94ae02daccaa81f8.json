{"ast":null,"code":"var _jsxFileName = \"/Users/cramj/Documents/New PWA/GIT/src/view/profile/transferhistory/withdrawalhistory.js\";\nimport React, { useEffect, useState, useMemo } from \"react\";\nimport { map, filter, isEmpty } from 'lodash';\nimport * as moment from \"moment\";\nimport { Service } from '../';\nimport { toDate } from \"../../../util\";\n\nconst CardItem = props => {\n  // console.log(props)\n  const {\n    label,\n    time,\n    value,\n    status,\n    index,\n    className,\n    obj,\n    onSetKey,\n    setKey\n  } = props; //成功 SUCCESS\n  //失败 FAILURE\n  //未审核 UNREVIEWED\n  //出款中 WITHDRAWING\n  //已审核 AUDITED\n  //汇款中 REMITTANCE\n\n  let statusText = \"\";\n  let classStatus = \"\";\n  let cancel = false;\n  let fail = false;\n\n  if (status === \"成功\") {\n    statusText = \"成功\";\n    classStatus = \"success\";\n  }\n\n  if (status === \"失败\") {\n    statusText = \"失败\";\n    classStatus = \"failure\";\n    fail = true;\n  }\n\n  if (status === \"未审核\") {\n    statusText = \"未审核\";\n    classStatus = \"unreviewed\";\n    cancel = true;\n  }\n\n  if (status === \"出款中\") {\n    statusText = \"出款中\";\n    classStatus = \"withdrawing\";\n  }\n\n  if (status === \"汇款中\") {\n    statusText = \"汇款中\";\n    classStatus = \"remittance\";\n  } // if(status === \"已审核\"){\n  // \tstatusText = \"已审核\"\n  // \tclassStatus = \"audited\"\n  // }\n\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: `withdrawal-history-card-item ${className ? className : \"\"}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"cl-item withdrawal-history-card-text\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 71,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"p\", {\n    className: \"cl-card-text\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 72,\n      columnNumber: 11\n    }\n  }, label), /*#__PURE__*/React.createElement(\"p\", {\n    className: \"cl-card-time\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 73,\n      columnNumber: 11\n    }\n  }, time)), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"cl-item withdrawal-history-card-value\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 9\n    }\n  }, cancel && /*#__PURE__*/React.createElement(\"span\", {\n    className: \"cancel\",\n    onClick: () => props.onCancel(obj),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 13\n    }\n  }, \"\\u53D6\\u6D88\\u63D0\\u6B3E\"), /*#__PURE__*/React.createElement(\"p\", {\n    className: \"cl-card-amount\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 11\n    }\n  }, \"\\u91D1\\u989D: \", /*#__PURE__*/React.createElement(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 17\n    }\n  }, value)), /*#__PURE__*/React.createElement(\"p\", {\n    className: `cl-card-status ${classStatus}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 13\n    }\n  }, statusText, fail && /*#__PURE__*/React.createElement(\"span\", {\n    className: \"fail\",\n    onClick: () => onSetKey(index),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 17\n    }\n  }, setKey === index && /*#__PURE__*/React.createElement(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 40\n    }\n  }, obj.verifyComment), /*#__PURE__*/React.createElement(\"i\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 19\n    }\n  }))))));\n};\n\nconst WithdrawalHistory = props => {\n  const {\n    id,\n    refresh,\n    onStop\n  } = props;\n  const [key, setKey] = useState(null);\n  const [items, setItems] = useState({\n    status: 0,\n    list: []\n  });\n  const [load, setLoad] = useState(false);\n  const [range, setRange] = useState(\"today\");\n  const [customRange, setCustomRange] = useState({\n    from: moment().subtract(30, \"days\").toDate(),\n    to: moment().toDate()\n  });\n  useEffect(() => {\n    if (refresh == id) {\n      setLoad(true);\n    }\n  }, [refresh]);\n  useEffect(() => {\n    const fetch = () => {\n      const response = Service.Transaction.read({ ...Service.User.read(),\n        record_type: \"debit\"\n      });\n      response.promise.then(result => {\n        // console.log(result);\n        if (result.status === 1) {\n          // setItems(result.info);\n          setItems({\n            status: 1,\n            list: result.info.map(t => ({ ...t,\n              ts: toDate(t.requestTime, true)\n            }))\n          });\n          setLoad(false);\n          onStop();\n        }\n      }, e => {\n        console.log(\"Unable to response:\", e);\n      });\n    };\n\n    fetch();\n  }, [load]);\n\n  const onCancel = async w => {\n    console.log(w); // const r = await Service.User.withdrawCancel({ id: w.id }).promise;\n\n    const response = await Service.User.withdrawCancel({\n      id: w.id\n    }).promise; // console.log(response);\n\n    if (response.status === 1) {\n      setLoad(true);\n    }\n  };\n\n  const onSetKey = value => {\n    setKey(null);\n    if (key !== value) setKey(value);\n  };\n\n  const __withdraws = useMemo(() => {\n    const _rangeMap = {\n      today: () => {\n        const today = moment();\n        return [today.startOf(\"day\").unix(), today.endOf(\"day\").unix()];\n      },\n      yesterday: () => {\n        const yesterday = moment().subtract(1, \"days\");\n        return [yesterday.startOf(\"day\").unix(), yesterday.endOf(\"day\").unix()];\n      },\n      week: () => {\n        return [moment().subtract(1, \"weeks\").startOf(\"day\").unix(), moment().endOf(\"day\").unix()];\n      },\n      month: () => {\n        return [moment().subtract(30, \"days\").startOf(\"day\").unix(), moment().endOf(\"day\").unix()];\n      },\n      custom: () => {\n        let {\n          from,\n          to\n        } = customRange;\n        return [moment(from).startOf(\"day\").unix(), moment(to).endOf(\"day\").unix()];\n      }\n    };\n\n    const [from, to] = _rangeMap[range](); // return withdraws.list.filter((t) => t.ts >= from && t.ts < to);\n\n\n    return filter(items.list, t => t.ts >= from && t.ts < to);\n  }, [items.list, customRange, range]); // console.log(__withdraws)\n\n\n  if (!isEmpty(__withdraws)) {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"withdrawal-history-card-body\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 211,\n        columnNumber: 17\n      }\n    }, map(__withdraws, (obj, i) => {\n      return /*#__PURE__*/React.createElement(CardItem, {\n        obj: obj,\n        key: i,\n        index: i,\n        label: obj.cardNumber,\n        time: obj.requestTime,\n        value: obj.amount,\n        status: obj.status,\n        onCancel: val => onCancel(val),\n        onSetKey: val => onSetKey(val),\n        setKey: key,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 215,\n          columnNumber: 29\n        }\n      });\n    }));\n  }\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"no-transactions\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"image-box\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 235,\n      columnNumber: 17\n    }\n  }), /*#__PURE__*/React.createElement(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 236,\n      columnNumber: 17\n    }\n  }, \"\\u6682\\u65E0\\u8BB0\\u5F55\"));\n};\n\nexport default WithdrawalHistory;","map":{"version":3,"sources":["/Users/cramj/Documents/New PWA/GIT/src/view/profile/transferhistory/withdrawalhistory.js"],"names":["React","useEffect","useState","useMemo","map","filter","isEmpty","moment","Service","toDate","CardItem","props","label","time","value","status","index","className","obj","onSetKey","setKey","statusText","classStatus","cancel","fail","onCancel","verifyComment","WithdrawalHistory","id","refresh","onStop","key","items","setItems","list","load","setLoad","range","setRange","customRange","setCustomRange","from","subtract","to","fetch","response","Transaction","read","User","record_type","promise","then","result","info","t","ts","requestTime","e","console","log","w","withdrawCancel","__withdraws","_rangeMap","today","startOf","unix","endOf","yesterday","week","month","custom","i","cardNumber","amount","val"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useMemo } from \"react\";\r\nimport { map , filter ,isEmpty} from 'lodash'\r\nimport * as moment from \"moment\";\r\n\r\nimport { Service } from '../'\r\n\r\nimport { toDate } from \"../../../util\";\r\n\r\n\r\n\r\nconst CardItem = (props) => {\r\n    // console.log(props)\r\n    const {\r\n      label,\r\n      time,\r\n      value,\r\n      status,\r\n      index,\r\n      className,\r\n      obj,\r\n      onSetKey,\r\n      setKey,\r\n    } = props;\r\n    //成功 SUCCESS\r\n    //失败 FAILURE\r\n    //未审核 UNREVIEWED\r\n    //出款中 WITHDRAWING\r\n    //已审核 AUDITED\r\n    //汇款中 REMITTANCE\r\n  \r\n    let statusText = \"\";\r\n    let classStatus = \"\";\r\n    let cancel = false;\r\n    let fail = false;\r\n    if (status === \"成功\") {\r\n      statusText = \"成功\";\r\n      classStatus = \"success\";\r\n    }\r\n  \r\n    if (status === \"失败\") {\r\n      statusText = \"失败\";\r\n      classStatus = \"failure\";\r\n      fail = true;\r\n    }\r\n  \r\n    if (status === \"未审核\") {\r\n      statusText = \"未审核\";\r\n      classStatus = \"unreviewed\";\r\n      cancel = true;\r\n    }\r\n  \r\n    if (status === \"出款中\") {\r\n      statusText = \"出款中\";\r\n      classStatus = \"withdrawing\";\r\n    }\r\n  \r\n    if (status === \"汇款中\") {\r\n      statusText = \"汇款中\";\r\n      classStatus = \"remittance\";\r\n    }\r\n  \r\n    // if(status === \"已审核\"){\r\n    // \tstatusText = \"已审核\"\r\n    // \tclassStatus = \"audited\"\r\n    // }\r\n  \r\n    return (\r\n      <div\r\n        className={`withdrawal-history-card-item ${className ? className : \"\"}`}\r\n      >\r\n        <div className=\"cl-item withdrawal-history-card-text\">\r\n          <p className=\"cl-card-text\">{label}</p>\r\n          <p className=\"cl-card-time\">{time}</p>\r\n        </div>\r\n        <div className=\"cl-item withdrawal-history-card-value\">\r\n          {cancel && (\r\n            <span className=\"cancel\" onClick={() => props.onCancel(obj)}>\r\n              取消提款\r\n            </span>\r\n          )}\r\n          <p className=\"cl-card-amount\">\r\n            金额: <span>{value}</span>\r\n          </p>\r\n          <p className={`cl-card-status ${classStatus}`}>\r\n            <span>\r\n              {statusText}\r\n              {fail && (\r\n                <span className=\"fail\" onClick={() => onSetKey(index)}>\r\n                  {setKey === index && <span>{obj.verifyComment}</span>}\r\n                  <i />\r\n                </span>\r\n              )}\r\n            </span>\r\n          </p>\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\nconst WithdrawalHistory = (props) => {\r\n  const { id ,refresh , onStop } = props\r\n\r\n  const [key, setKey] = useState(null);\r\n\r\n  const [items, setItems] = useState({\r\n    status: 0,\r\n    list: [],\r\n  });\r\n  const [load, setLoad] = useState(false);\r\n\r\n  const [range, setRange] = useState(\"today\");\r\n  const [customRange, setCustomRange] = useState({\r\n    from: moment().subtract(30, \"days\").toDate(),\r\n    to: moment().toDate(),\r\n  });\r\n\r\n  useEffect(() =>{\r\n    if(refresh == id ){\r\n      setLoad(true)\r\n    }\r\n  },[refresh])\r\n\r\n  useEffect(() => {\r\n    const fetch = () => {\r\n      const response = Service.Transaction.read({\r\n        ...Service.User.read(),\r\n        record_type: \"debit\",\r\n      });\r\n\r\n      response.promise.then(\r\n        (result) => {\r\n          // console.log(result);\r\n          if (result.status === 1) {\r\n            // setItems(result.info);\r\n            setItems({\r\n              status: 1,\r\n              list: result.info.map((t) => ({\r\n                ...t,\r\n                ts: toDate(t.requestTime, true),\r\n              })),\r\n            });\r\n            setLoad(false);\r\n            onStop()\r\n\r\n          }\r\n        },\r\n        (e) => {\r\n          console.log(\"Unable to response:\", e);\r\n        }\r\n      );\r\n    };\r\n    fetch();\r\n  }, [load]);\r\n\r\n  const onCancel = async (w) => {\r\n    console.log(w);\r\n    // const r = await Service.User.withdrawCancel({ id: w.id }).promise;\r\n    const response = await Service.User.withdrawCancel({ id: w.id }).promise;\r\n    // console.log(response);\r\n    if (response.status === 1) {\r\n      setLoad(true);\r\n    }\r\n  };\r\n\r\n  const onSetKey = (value) => {\r\n    setKey(null);\r\n    if (key !== value) setKey(value);\r\n  };\r\n\r\n\r\n  const __withdraws = useMemo(() => {\r\n    const _rangeMap = {\r\n      today: () => {\r\n        const today = moment();\r\n        return [today.startOf(\"day\").unix(), today.endOf(\"day\").unix()];\r\n      },\r\n      yesterday: () => {\r\n        const yesterday = moment().subtract(1, \"days\");\r\n        return [yesterday.startOf(\"day\").unix(), yesterday.endOf(\"day\").unix()];\r\n      },\r\n      week: () => {\r\n        return [\r\n          moment().subtract(1, \"weeks\").startOf(\"day\").unix(),\r\n          moment().endOf(\"day\").unix(),\r\n        ];\r\n      },\r\n      month: () => {\r\n        return [\r\n          moment().subtract(30, \"days\").startOf(\"day\").unix(),\r\n          moment().endOf(\"day\").unix(),\r\n        ];\r\n      },\r\n      custom: () => {\r\n        let { from, to } = customRange;\r\n        return [\r\n          moment(from).startOf(\"day\").unix(),\r\n          moment(to).endOf(\"day\").unix(),\r\n        ];\r\n      },\r\n    };\r\n\r\n    const [from, to] = _rangeMap[range]();\r\n\r\n    // return withdraws.list.filter((t) => t.ts >= from && t.ts < to);\r\n    return filter(items.list, (t) => t.ts >= from && t.ts < to);\r\n  }, [items.list, customRange, range]);\r\n\r\n  // console.log(__withdraws)\r\n\r\n    if(!isEmpty(__withdraws)){\r\n        return  <div className=\"withdrawal-history-card-body\">\r\n                    {\r\n                    map(__withdraws, (obj, i) => {\r\n                        return (\r\n                            <CardItem\r\n                                obj={obj}\r\n                                key={i}\r\n                                index={i}\r\n                                label={obj.cardNumber}\r\n                                time={obj.requestTime}\r\n                                value={obj.amount}\r\n                                status={obj.status}\r\n                                onCancel={(val) => onCancel(val)}\r\n                                onSetKey={(val) => onSetKey(val)}\r\n                                setKey={key}\r\n                          />\r\n                        );\r\n                    })\r\n                    }\r\n\r\n                </div>\r\n    }\r\n\r\n    return  <div className=\"no-transactions\">\r\n                <div className=\"image-box\" />\r\n                <span>暂无记录</span>\r\n            </div>\r\n\r\n\r\n}\r\n\r\nexport default WithdrawalHistory"]},"metadata":{},"sourceType":"module"}