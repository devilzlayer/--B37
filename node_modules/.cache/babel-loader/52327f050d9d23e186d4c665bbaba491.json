{"ast":null,"code":"import _defineProperty from\"/Users/cramj/Documents/New PWA/ubet-project (1)/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/Users/cramj/Documents/New PWA/ubet-project (1)/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/cramj/Documents/New PWA/ubet-project (1)/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,useContext}from\"react\";import{useParams,useHistory,useLocation}from\"react-router-dom\";import Picker from\"react-mobile-picker\";import ReactSlider from\"react-slider\";import cx from\"classnames\";import BigNumber from\"bignumber.js\";import useClickOutside from\"click-outside-hook\";import{withAuth}from\"../util/\";import{Icon}from\"../../component/\";import{User,Game as Service}from\"../../service/\";import\"../assets/scss/GameSA.scss\";var externals=[1204,1209,1211];function Game(){var history=useHistory();var _useLocation=useLocation(),search=_useLocation.search;// eslint-disable-next-line\nvar _useState=useState(search.includes(\"from_home=1\")),_useState2=_slicedToArray(_useState,2),fromHome=_useState2[0],setFromHome=_useState2[1];useEffect(function(){if(fromHome){history.replace({search:\"\"});}},[history,fromHome]);var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),loading=_useState4[0],setLoading=_useState4[1];var _useContext=useContext(User.Context),userAuth=_useContext.userAuth,setUserAuthFN=_useContext.setUserAuthFN;var _useParams=useParams(),id=_useParams.id,name=_useParams.name;var isExternal=externals.includes(+id);var _useState5=useState({}),_useState6=_slicedToArray(_useState5,2),message=_useState6[0],setMessage=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),iframe=_useState8[0],setIframe=_useState8[1];var _useState9=useState(0),_useState10=_slicedToArray(_useState9,2),iframeI=_useState10[0],setIframeI=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),fullScreen=_useState12[0],setFullScreen=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),overlayState=_useState14[0],setOverlayState=_useState14[1];var refClickOut=useClickOutside(function(){return setOverlayState(false);});var _useState15=useState([]),_useState16=_slicedToArray(_useState15,2),balances=_useState16[0],setBalances=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),balanceTransferred=_useState18[0],setBalanceTransferred=_useState18[1];var _useState19=useState(0),_useState20=_slicedToArray(_useState19,2),balanceUpdateI=_useState20[0],setBalanceUpdateI=_useState20[1];var _useState21=useState(false),_useState22=_slicedToArray(_useState21,2),balanceLoad=_useState22[0],setBalanceLoad=_useState22[1];var _useState23=useState({}),_useState24=_slicedToArray(_useState23,2),balancesMap=_useState24[0],setBalancesMap=_useState24[1];var _useState25=useState(null),_useState26=_slicedToArray(_useState25,2),balanceOver=_useState26[0],setBalanceOver=_useState26[1];var _useState27=useState({from:\"中央钱包\",to:name,amount:\"\"}),_useState28=_slicedToArray(_useState27,2),balanceForm=_useState28[0],setBalanceForm=_useState28[1];var _useState29=useState(0),_useState30=_slicedToArray(_useState29,2),sliderPercent=_useState30[0],setSliderPercent=_useState30[1];var _useState31=useState({name:\"\",balance:0}),_useState32=_slicedToArray(_useState31,2),balanceCurrent=_useState32[0],setBalanceCurrent=_useState32[1];var goBack=function goBack(){return history.push(\"/\");};var refresh=function refresh(){return setIframeI(iframeI+1);};var _useState33=useState([]),_useState34=_slicedToArray(_useState33,2),focHeight=_useState34[0],setFocHeight=_useState34[1];useEffect(function(){var _window=window,height=_window.innerHeight;setFocHeight(height);window.scrollTo(0,0);},[]);useEffect(function(){if(isExternal){return function(){};}setBalances([]);setBalancesMap({});setBalanceCurrent(function(bc){return{name:name,balance:0};});Service.balances(_objectSpread({},User.read())).then(function(_balances){var __balances=_balances.filter(function(b){return!b.error;}).map(function(b){return\"\".concat(b.game.name,\": \").concat(b.balance,\" \\xA5\");});__balances.push(\"\\u4E2D\\u592E\\u94B1\\u5305: \".concat(userAuth.data.balance,\" \\xA5\"));setBalanceForm(function(balanceForm){return _objectSpread({},balanceForm);});setBalances(__balances);var __balancesMap={};_balances.filter(function(b){return!b.error;}).forEach(function(b){__balancesMap[b.game.name]=b;});__balancesMap[\"中央钱包\"]={game:{id:0,name:\"wallet\"},wallet:true,balance:userAuth.data.balance};setBalanceCurrent(function(bc){return _objectSpread(_objectSpread({},bc),{},{balance:__balancesMap[name].balance});});setBalancesMap(__balancesMap);});},[balanceUpdateI,userAuth.data.balance,isExternal,name]);useEffect(function(){setLoading(true);var user=User.read();var req=Service.activate(_objectSpread({num:1,type:\"active\",gameid:id},user));function LogIn(){Service.login(_objectSpread({num:1,gameid:id},user)).promise.then(function(r){if(!isExternal){setLoading(false);setIframe(r.info);}else{if(fromHome){window.location.href=r.info;}else{history.push(\"/\");}}},function(e){console.error(\"Unable to login to the game\",e);});}req.promise.then(function(r){console.log(r);LogIn();},function(e){if(!e.is_aborted){console.error(\"Unable to activate the game:\",e);LogIn();}});return function(){return req.cancel();};},[id,history,fromHome,isExternal]);useEffect(function(){document.body.style.overflow=balanceOver?\"hidden\":\"auto\";return function(){document.body.style.overflow=\"auto\";};},[balanceOver]);var PickerWrap=function PickerWrap(_ref){var dist=_ref.dist;return/*#__PURE__*/React.createElement(\"div\",{className:\"picker-wrap\"},balances.length?/*#__PURE__*/React.createElement(Picker,{height:120,valueGroups:_defineProperty({},dist,balanceForm[dist]),optionGroups:_defineProperty({},dist,balances),onChange:function onChange(key,value){return setBalanceForm(_objectSpread(_objectSpread({},balanceForm),{},_defineProperty({},key,value)));}}):null);};var setAmount=function setAmount(e){// console.log(e.target.validity.valid);\nvar amount=e.target?e.target.value:e;var percent=+BigNumber(amount/userAuth.data.balance*100).toFixed(0);setBalanceForm(function(form){return _objectSpread(_objectSpread({},form),{},{amount:amount});});setSliderPercent(percent);};var transfer=function transfer(e){if(!balanceForm.amount||isNaN(+balanceForm.amount)){return void console.warn(\"[transfer] No amount\");}var _getMap=function _getMap(n){return balancesMap[n.split(\": \")[0]]||null;};var _from=_getMap(balanceForm.from);var _to=_getMap(balanceForm.to);if(_from.game.id===_to.game.id){return void console.warn(\"[transfer] Same game\");}if(_from.balance===0){return void console.warn(\"[transfer] Zero balance\");}if(_from.balance<+balanceForm.amount){return void console.warn(\"[transfer] Not enough game balance\");}console.info(\"You're transfering \".concat(balanceForm.amount,\" \\xA5 from \").concat(_from.game.name,\" to \").concat(_to.game.name));balanceForm.amount=BigNumber(balanceForm.amount).toFixed(0);setBalanceLoad(true);Service.transfer(_objectSpread(_objectSpread({},User.read()),{},{amount:+balanceForm.amount,from:_from.game.id,to:_to.game.id})).then(function(r){console.info(\"You have successfully transferred \".concat(balanceForm.amount,\" \\xA5 from \").concat(_from.game.name,\" to \").concat(_to.game.name,\": \").concat(r.info));setMessage({title:'转账成功',valid:true});setBalanceLoad(false);setBalanceTransferred(true);},function(e){console.error(e);setMessage({title:'系统提示',message:e});setBalanceLoad(false);setBalanceTransferred(true);});};var finishTransfer=function finishTransfer(){setOverlayState(false);setBalanceTransferred(false);setBalanceForm(function(bf){return _objectSpread(_objectSpread({},bf),{},{amount:\"\"});});setSliderPercent(0);setBalanceUpdateI(function(i){return i+1;});User.session(_objectSpread({},User.read())).promise.then(function(r){return setUserAuthFN(1,r.info);});};var onlyNumbers=function onlyNumbers(e){var value=e.currentTarget.value;var regexp=/^[0-9\\b]+$/;if(!value||regexp.test(value)){setAmount(value);}};return/*#__PURE__*/React.createElement(\"div\",{className:cx(\"game-sa\",\"with-loader\",{loading:loading,\"full-screen\":fullScreen})},/*#__PURE__*/React.createElement(\"button\",{className:\"full-screen-exit\",onClick:function onClick(){return setFullScreen(false);}},/*#__PURE__*/React.createElement(\"i\",null)),/*#__PURE__*/React.createElement(\"div\",{className:\"load-spin\"}),/*#__PURE__*/React.createElement(\"div\",{className:cx(\"game-sa-head\",{hidden:fullScreen}),style:isExternal?{display:\"none\"}:{}},/*#__PURE__*/React.createElement(\"div\",{className:\"sa-head-left\"},/*#__PURE__*/React.createElement(\"button\",{onClick:goBack})),/*#__PURE__*/React.createElement(\"div\",{className:\"sa-head-middle\"},/*#__PURE__*/React.createElement(\"h1\",null,name)),/*#__PURE__*/React.createElement(\"div\",{className:\"sa-head-right\"},/*#__PURE__*/React.createElement(\"button\",{className:\"balance\",onClick:function onClick(e){return setOverlayState(true);},disabled:!balances.length},/*#__PURE__*/React.createElement(\"i\",null)),/*#__PURE__*/React.createElement(\"button\",{className:\"refresh\",onClick:refresh},/*#__PURE__*/React.createElement(\"i\",null)),/*#__PURE__*/React.createElement(\"button\",{className:\"full-screen\",onClick:function onClick(){return setFullScreen(true);}},/*#__PURE__*/React.createElement(\"i\",null)))),/*#__PURE__*/React.createElement(\"div\",{className:\"game-sa-content\"},iframe?/*#__PURE__*/React.createElement(\"iframe\",{key:iframeI,title:\"IFRAME-N\".concat(id),src:iframe,style:{height:fullScreen?focHeight:focHeight-60}}):null),/*#__PURE__*/React.createElement(\"div\",{className:\"game-sa-overlay\".concat(overlayState?\" shown\":\"\")},/*#__PURE__*/React.createElement(\"div\",{className:\"overlay-sublayer\",ref:refClickOut},/*#__PURE__*/React.createElement(\"div\",{className:\"overlay-layer with-loader\".concat(balanceLoad?\" loading\":\"\")},/*#__PURE__*/React.createElement(\"div\",{className:\"load-spin\"}),balanceTransferred?/*#__PURE__*/React.createElement(\"div\",{className:\"form response\"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-head not-message\"},/*#__PURE__*/React.createElement(\"h2\",{className:!message.valid?'hide':''},message.title),/*#__PURE__*/React.createElement(\"button\",{className:\"close\",onClick:finishTransfer},/*#__PURE__*/React.createElement(Icon,{name:\"close-circle-sharp\"}))),/*#__PURE__*/React.createElement(\"div\",{className:\"form-body not-message\"},message.message&&/*#__PURE__*/React.createElement(\"p\",{className:\"game-transfer-p\"},message.message),/*#__PURE__*/React.createElement(\"div\",{className:\"form-submit\"},/*#__PURE__*/React.createElement(\"button\",{onClick:finishTransfer},\"\\u786E\\u8BA4\")))):/*#__PURE__*/React.createElement(\"div\",{className:\"form\"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-head\"},/*#__PURE__*/React.createElement(\"h2\",null,\"\\u8F6C\\u8D26\"),/*#__PURE__*/React.createElement(\"button\",{className:\"close\",onClick:function onClick(e){return setOverlayState(false);}},/*#__PURE__*/React.createElement(Icon,{name:\"close-circle-sharp\"}))),/*#__PURE__*/React.createElement(\"div\",{className:\"form-body\"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-body-wrap\"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-field transfer-wrap\"},/*#__PURE__*/React.createElement(\"div\",{className:\"transfer--item\"},/*#__PURE__*/React.createElement(\"p\",{className:\"title\"},\"\\u8F6C\\u51FA\\u94B1\\u5305\"),/*#__PURE__*/React.createElement(\"p\",{className:\"game\"},\"\\u4E2D\\u592E\\u94B1\\u5305\"),/*#__PURE__*/React.createElement(\"p\",{className:\"balance\"},BigNumber(userAuth.data.balance).toFormat(2))),/*#__PURE__*/React.createElement(\"div\",{className:\"transfer--item icon\"},/*#__PURE__*/React.createElement(Icon,{name:\"arrow-left\"})),/*#__PURE__*/React.createElement(\"div\",{className:\"transfer--item\"},/*#__PURE__*/React.createElement(\"p\",{className:\"title\"},\"\\u8F6C\\u5165\\u94B1\\u5305\"),/*#__PURE__*/React.createElement(\"p\",{className:\"game\"},balanceCurrent.name),/*#__PURE__*/React.createElement(\"p\",{className:\"balance\"},BigNumber(balanceCurrent.balance).toFormat(2)))),/*#__PURE__*/React.createElement(\"div\",{className:\"form-field\"},/*#__PURE__*/React.createElement(\"div\",{className:\"slider-wrap\"},/*#__PURE__*/React.createElement(\"p\",null,\"0\"),/*#__PURE__*/React.createElement(\"div\",{className:\"slider-subwrap\"},/*#__PURE__*/React.createElement(ReactSlider,{className:\"slider-picker\",thumbClassName:\"thumb\",trackClassName:\"track\",value:sliderPercent,onChange:function onChange(percent){var amount=BigNumber(percent*userAuth.data.balance/100).toFixed(0);setSliderPercent(percent);setBalanceForm(function(bf){return _objectSpread(_objectSpread({},bf),{},{amount:amount});});}})),/*#__PURE__*/React.createElement(\"p\",{onClick:function onClick(){var amount=BigNumber(userAuth.data.balance).toFixed(0);setSliderPercent(100);setBalanceForm(function(bf){return _objectSpread(_objectSpread({},bf),{},{amount:amount});});}},\"MAX\"))),/*#__PURE__*/React.createElement(\"div\",{className:\"form-field\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"amount\"},\"\\u91D1\\u989D/\\u8F6C\\u5165\\u91D1\\u989D\"),/*#__PURE__*/React.createElement(\"div\",{className:\"input--wrap\"},/*#__PURE__*/React.createElement(\"input\",{id:\"amount\",type:\"text\",placeholder:\"0.00\",pattern:\"[0-9]*\",value:balanceForm.amount,onChange:function onChange(e){return onlyNumbers(e);}})))),/*#__PURE__*/React.createElement(\"div\",{className:\"form-submit\"},/*#__PURE__*/React.createElement(\"button\",{onClick:transfer},\"\\u7ACB\\u5373\\u8F6C\\u8D26\"))))))),/*#__PURE__*/React.createElement(\"div\",{className:\"game-sa-overlay picker-over\".concat(balanceOver?\" shown\":\"\")},/*#__PURE__*/React.createElement(\"div\",{className:\"picker-container\"},/*#__PURE__*/React.createElement(\"div\",{className:\"picker-head\"},/*#__PURE__*/React.createElement(\"button\",{onClick:function onClick(e){return setBalanceOver(null);}},\"\\u53D6\\u6D88\"),/*#__PURE__*/React.createElement(\"p\",null,balanceOver===\"from\"?\"推出\":\"进入\"),/*#__PURE__*/React.createElement(\"button\",{onClick:function onClick(e){return setBalanceOver(null);}},\"\\u786E\\u5B9A\")),balanceOver?/*#__PURE__*/React.createElement(PickerWrap,{dist:balanceOver}):null)));}export default withAuth(Game,1);","map":{"version":3,"sources":["/Users/cramj/Documents/New PWA/ubet-project (1)/src/pwa/view/Game.js"],"names":["React","useState","useEffect","useContext","useParams","useHistory","useLocation","Picker","ReactSlider","cx","BigNumber","useClickOutside","withAuth","Icon","User","Game","Service","externals","history","search","includes","fromHome","setFromHome","replace","loading","setLoading","Context","userAuth","setUserAuthFN","id","name","isExternal","message","setMessage","iframe","setIframe","iframeI","setIframeI","fullScreen","setFullScreen","overlayState","setOverlayState","refClickOut","balances","setBalances","balanceTransferred","setBalanceTransferred","balanceUpdateI","setBalanceUpdateI","balanceLoad","setBalanceLoad","balancesMap","setBalancesMap","balanceOver","setBalanceOver","from","to","amount","balanceForm","setBalanceForm","sliderPercent","setSliderPercent","balance","balanceCurrent","setBalanceCurrent","goBack","push","refresh","focHeight","setFocHeight","window","height","innerHeight","scrollTo","bc","read","then","_balances","__balances","filter","b","error","map","game","data","__balancesMap","forEach","wallet","user","req","activate","num","type","gameid","LogIn","login","promise","r","info","location","href","e","console","log","is_aborted","cancel","document","body","style","overflow","PickerWrap","dist","length","key","value","setAmount","target","percent","toFixed","form","transfer","isNaN","warn","_getMap","n","split","_from","_to","title","valid","finishTransfer","bf","i","session","onlyNumbers","currentTarget","regexp","test","hidden","display","toFormat"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useContext } from \"react\";\r\nimport { useParams, useHistory, useLocation } from \"react-router-dom\";\r\nimport Picker from \"react-mobile-picker\";\r\nimport ReactSlider from \"react-slider\";\r\nimport cx from \"classnames\";\r\nimport BigNumber from \"bignumber.js\";\r\nimport useClickOutside from \"click-outside-hook\";\r\n\r\nimport { withAuth } from \"../util/\";\r\nimport { Icon } from \"../../component/\";\r\nimport { User, Game as Service } from \"../../service/\";\r\n\r\nimport \"../assets/scss/GameSA.scss\";\r\n\r\nconst externals = [1204, 1209, 1211];\r\n\r\nfunction Game() {\r\n  const history = useHistory();\r\n\r\n  const { search } = useLocation();\r\n  // eslint-disable-next-line\r\n  const [fromHome, setFromHome] = useState(search.includes(\"from_home=1\"));\r\n\r\n  useEffect(() => {\r\n    if (fromHome) {\r\n      history.replace({ search: \"\" });\r\n    }\r\n  }, [history, fromHome]);\r\n\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const { userAuth, setUserAuthFN } = useContext(User.Context);\r\n\r\n  const { id, name } = useParams();\r\n  const isExternal = externals.includes(+id);\r\n\r\n  const [message , setMessage] = useState({});\r\n  const [iframe, setIframe] = useState(null);\r\n  const [iframeI, setIframeI] = useState(0);\r\n\r\n  const [fullScreen, setFullScreen] = useState(false);\r\n\r\n  const [overlayState, setOverlayState] = useState(false);\r\n\r\n  const refClickOut = useClickOutside(() => setOverlayState(false));\r\n\r\n  const [balances, setBalances] = useState([]);\r\n  const [balanceTransferred, setBalanceTransferred] = useState(false);\r\n  const [balanceUpdateI, setBalanceUpdateI] = useState(0);\r\n  const [balanceLoad, setBalanceLoad] = useState(false);\r\n  const [balancesMap, setBalancesMap] = useState({});\r\n  const [balanceOver, setBalanceOver] = useState(null);\r\n  const [balanceForm, setBalanceForm] = useState({\r\n    from: \"中央钱包\",\r\n    to: name,\r\n    amount: \"\",\r\n  });\r\n\r\n  const [sliderPercent, setSliderPercent] = useState(0);\r\n\r\n  const [balanceCurrent, setBalanceCurrent] = useState({\r\n    name: \"\",\r\n    balance: 0,\r\n  });\r\n\r\n  const goBack = () => history.push(\"/\");\r\n\r\n  const refresh = () => setIframeI(iframeI + 1);\r\n\r\n  const [focHeight, setFocHeight] = useState([]);\r\n\r\n  useEffect(() => {\r\n    const { innerHeight: height } = window;\r\n    setFocHeight(height);\r\n    window.scrollTo(0, 0);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (isExternal) {\r\n      return () => {};\r\n    }\r\n\r\n    setBalances([]);\r\n    setBalancesMap({});\r\n\r\n    setBalanceCurrent((bc) => ({\r\n      name,\r\n      balance: 0,\r\n    }));\r\n\r\n    Service.balances({\r\n      ...User.read(),\r\n    }).then((_balances) => {\r\n      const __balances = _balances\r\n        .filter((b) => !b.error)\r\n        .map((b) => `${b.game.name}: ${b.balance} ¥`);\r\n      __balances.push(`中央钱包: ${userAuth.data.balance} ¥`);\r\n\r\n      setBalanceForm((balanceForm) => ({\r\n        ...balanceForm,\r\n        // from: __balances[0],\r\n        // to: __balances[1],\r\n      }));\r\n\r\n      setBalances(__balances);\r\n\r\n      const __balancesMap = {};\r\n\r\n      _balances\r\n        .filter((b) => !b.error)\r\n        .forEach((b) => {\r\n          __balancesMap[b.game.name] = b;\r\n        });\r\n\r\n      __balancesMap[\"中央钱包\"] = {\r\n        game: {\r\n          id: 0,\r\n          name: \"wallet\",\r\n        },\r\n        wallet: true,\r\n        balance: userAuth.data.balance,\r\n      };\r\n\r\n      setBalanceCurrent((bc) => ({\r\n        ...bc,\r\n        balance: __balancesMap[name].balance,\r\n      }));\r\n\r\n      setBalancesMap(__balancesMap);\r\n    });\r\n  }, [balanceUpdateI, userAuth.data.balance, isExternal, name]);\r\n\r\n  useEffect(() => {\r\n    setLoading(true);\r\n\r\n    const user = User.read();\r\n\r\n    const req = Service.activate({\r\n      num: 1,\r\n      type: \"active\",\r\n      gameid: id,\r\n      ...user,\r\n    });\r\n\r\n    function LogIn() {\r\n      Service.login({\r\n        num: 1,\r\n        gameid: id,\r\n        ...user,\r\n      }).promise.then(\r\n        (r) => {\r\n          if (!isExternal) {\r\n            setLoading(false);\r\n\r\n            setIframe(r.info);\r\n          } else {\r\n            if (fromHome) {\r\n              window.location.href = r.info;\r\n            } else {\r\n              history.push(\"/\");\r\n            }\r\n          }\r\n        },\r\n        (e) => {\r\n          console.error(\"Unable to login to the game\", e);\r\n        }\r\n      );\r\n    }\r\n\r\n    req.promise.then(\r\n      (r) => {\r\n        console.log(r);\r\n\r\n        LogIn();\r\n      },\r\n      (e) => {\r\n        if (!e.is_aborted) {\r\n          console.error(\"Unable to activate the game:\", e);\r\n\r\n          LogIn();\r\n        }\r\n      }\r\n    );\r\n\r\n    return () => req.cancel();\r\n  }, [id, history, fromHome, isExternal]);\r\n\r\n  useEffect(() => {\r\n    document.body.style.overflow = balanceOver ? \"hidden\" : \"auto\";\r\n\r\n    return () => {\r\n      document.body.style.overflow = \"auto\";\r\n    };\r\n  }, [balanceOver]);\r\n\r\n  const PickerWrap = ({ dist }) => (\r\n    <div className=\"picker-wrap\">\r\n      {balances.length ? (\r\n        <Picker\r\n          height={120}\r\n          valueGroups={{ [dist]: balanceForm[dist] }}\r\n          optionGroups={{ [dist]: balances }}\r\n          onChange={(key, value) =>\r\n            setBalanceForm({ ...balanceForm, [key]: value })\r\n          }\r\n        />\r\n      ) : null}\r\n    </div>\r\n  );\r\n\r\n  const setAmount = (e) => {\r\n    // console.log(e.target.validity.valid);\r\n\r\n    const amount = e.target ? e.target.value : e;\r\n    const percent = +BigNumber((amount / userAuth.data.balance) * 100).toFixed(\r\n      0\r\n    );\r\n\r\n    setBalanceForm((form) => ({ ...form, amount }));\r\n    setSliderPercent(percent);\r\n  };\r\n\r\n  const transfer = (e) => {\r\n    if (!balanceForm.amount || isNaN(+balanceForm.amount)) {\r\n      return void console.warn(\"[transfer] No amount\");\r\n    }\r\n\r\n    const _getMap = (n) => balancesMap[n.split(\": \")[0]] || null;\r\n\r\n    const _from = _getMap(balanceForm.from);\r\n    const _to = _getMap(balanceForm.to);\r\n\r\n    if (_from.game.id === _to.game.id) {\r\n      return void console.warn(\"[transfer] Same game\");\r\n    }\r\n\r\n    if (_from.balance === 0) {\r\n      return void console.warn(\"[transfer] Zero balance\");\r\n    }\r\n\r\n    if (_from.balance < +balanceForm.amount) {\r\n      return void console.warn(\"[transfer] Not enough game balance\");\r\n    }\r\n\r\n    console.info(\r\n      `You're transfering ${balanceForm.amount} ¥ from ${_from.game.name} to ${_to.game.name}`\r\n    );\r\n\r\n    balanceForm.amount = BigNumber(balanceForm.amount).toFixed(0);\r\n\r\n    setBalanceLoad(true);\r\n\r\n    Service.transfer({\r\n      ...User.read(),\r\n      amount: +balanceForm.amount,\r\n      from: _from.game.id,\r\n      to: _to.game.id,\r\n    }).then(\r\n      (r) => {\r\n        console.info(\r\n          `You have successfully transferred ${balanceForm.amount} ¥ from ${_from.game.name} to ${_to.game.name}: ${r.info}`\r\n        );\r\n\r\n        setMessage({\r\n          title: '转账成功',\r\n          valid: true,\r\n        })\r\n        setBalanceLoad(false);\r\n\r\n        setBalanceTransferred(true);\r\n      },\r\n      (e) => {\r\n        console.error(e);\r\n        setMessage({\r\n          title : '系统提示',\r\n          message: e,\r\n        })\r\n        setBalanceLoad(false);\r\n        setBalanceTransferred(true);\r\n      }\r\n    );\r\n  };\r\n\r\n  const finishTransfer = () => {\r\n    setOverlayState(false);\r\n\r\n    setBalanceTransferred(false);\r\n\r\n    setBalanceForm((bf) => ({\r\n      ...bf,\r\n      amount: \"\",\r\n    }));\r\n\r\n    setSliderPercent(0);\r\n\r\n    setBalanceUpdateI((i) => i + 1);\r\n\r\n    User.session({\r\n      ...User.read(),\r\n    }).promise.then((r) => setUserAuthFN(1, r.info));\r\n  };\r\n\r\n\r\n  const onlyNumbers = (e) => {\r\n    const { value } = e.currentTarget\r\n    let regexp  = /^[0-9\\b]+$/\r\n    if (!value || regexp.test(value)) {\r\n      setAmount(value);\r\n    }\r\n\r\n  };\r\n\r\n\r\n  return (\r\n    <div\r\n      className={cx(\"game-sa\", \"with-loader\", {\r\n        loading: loading,\r\n        \"full-screen\": fullScreen,\r\n      })}\r\n    >\r\n      <button className=\"full-screen-exit\" onClick={() => setFullScreen(false)}>\r\n        {/* <Icon name=\"close-circle-sharp\" /> */}\r\n        <i />\r\n      </button>\r\n      <div className=\"load-spin\"></div>\r\n      <div\r\n        className={cx(\"game-sa-head\", { hidden: fullScreen })}\r\n        style={isExternal ? { display: \"none\" } : {}}\r\n      >\r\n        <div className=\"sa-head-left\">\r\n          <button onClick={goBack}>{/* <Icon name=\"arrow-left\" /> */}</button>\r\n        </div>\r\n        <div className=\"sa-head-middle\">\r\n          <h1>{name}</h1>\r\n        </div>\r\n        <div className=\"sa-head-right\">\r\n          <button\r\n            className=\"balance\"\r\n            onClick={(e) => setOverlayState(true)}\r\n            disabled={!balances.length}\r\n          >\r\n            {/* <Icon name=\"balance\" /> */}\r\n            <i />\r\n          </button>\r\n          <button className=\"refresh\" onClick={refresh}>\r\n            {/* <Icon name=\"refresh\" /> */}\r\n            <i />\r\n          </button>\r\n          <button className=\"full-screen\" onClick={() => setFullScreen(true)}>\r\n            {/* <Icon name=\"full-screen\" /> */}\r\n            <i />\r\n          </button>\r\n        </div>\r\n      </div>\r\n      {/* =================================== IFRAME =================================== */}\r\n      <div className=\"game-sa-content\">\r\n        {iframe ? (\r\n          <iframe\r\n            key={iframeI}\r\n            title={`IFRAME-N${id}`}\r\n            src={iframe}\r\n            style={{ height: fullScreen ? focHeight : focHeight - 60 }}\r\n          ></iframe>\r\n        ) : null}\r\n      </div>\r\n      {/* =================================== IFRAME =================================== */}\r\n\r\n      <div className={`game-sa-overlay${overlayState ? \" shown\" : \"\"}`}>\r\n        <div className=\"overlay-sublayer\" ref={refClickOut}>\r\n          <div className={`overlay-layer with-loader${balanceLoad ? \" loading\" : \"\"}`}>\r\n            <div className=\"load-spin\"></div>\r\n            {balanceTransferred ? (\r\n              <div className=\"form response\">\r\n                <div className=\"form-head not-message\">\r\n                  <h2 className={!message.valid ? 'hide' : ''}>{message.title}</h2>\r\n                  <button className=\"close\" onClick={finishTransfer}>\r\n                    <Icon name=\"close-circle-sharp\" />\r\n                  </button>\r\n                </div>\r\n                <div className=\"form-body not-message\">\r\n                  {message.message && <p className=\"game-transfer-p\">{message.message}</p>}\r\n                  <div className=\"form-submit\">\r\n                    <button onClick={finishTransfer}>确认</button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              <div className=\"form\">\r\n                <div className=\"form-head\">\r\n                  <h2>转账</h2>\r\n                  <button\r\n                    className=\"close\"\r\n                    onClick={(e) => setOverlayState(false)}\r\n                  >\r\n                    <Icon name=\"close-circle-sharp\" />\r\n                  </button>\r\n                </div>\r\n                <div className=\"form-body\">\r\n                  <div className=\"form-body-wrap\">\r\n                    <div className=\"form-field transfer-wrap\">\r\n                      <div className=\"transfer--item\">\r\n                        <p className=\"title\">转出钱包</p>\r\n                        <p className=\"game\">中央钱包</p>\r\n                        <p className=\"balance\">\r\n                          {BigNumber(userAuth.data.balance).toFormat(2)}\r\n                        </p>\r\n                      </div>\r\n                      <div className=\"transfer--item icon\">\r\n                        <Icon name=\"arrow-left\" />\r\n                      </div>\r\n                      <div className=\"transfer--item\">\r\n                        <p className=\"title\">转入钱包</p>\r\n                        <p className=\"game\">{balanceCurrent.name}</p>\r\n                        <p className=\"balance\">\r\n                          {BigNumber(balanceCurrent.balance).toFormat(2)}\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"form-field\">\r\n                      <div className=\"slider-wrap\">\r\n                        <p>0</p>\r\n                        <div className=\"slider-subwrap\">\r\n                          <ReactSlider\r\n                            className=\"slider-picker\"\r\n                            thumbClassName=\"thumb\"\r\n                            trackClassName=\"track\"\r\n                            value={sliderPercent}\r\n                            onChange={(percent) => {\r\n                              const amount = BigNumber(\r\n                                (percent * userAuth.data.balance) / 100\r\n                              ).toFixed(0);\r\n                              setSliderPercent(percent);\r\n                              setBalanceForm((bf) => ({\r\n                                ...bf,\r\n                                amount,\r\n                              }));\r\n                            }}\r\n                          />\r\n                        </div>\r\n                        <p\r\n                          onClick={() => {\r\n                            const amount = BigNumber(\r\n                              userAuth.data.balance\r\n                            ).toFixed(0);\r\n\r\n                            setSliderPercent(100);\r\n                            setBalanceForm((bf) => ({\r\n                              ...bf,\r\n                              amount,\r\n                            }));\r\n                          }}\r\n                        >\r\n                          MAX\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"form-field\">\r\n                      <label htmlFor=\"amount\">金额/转入金额</label>\r\n                      <div className=\"input--wrap\">\r\n                        <input\r\n                          id=\"amount\"\r\n                          type=\"text\"\r\n                          placeholder=\"0.00\"\r\n                          pattern=\"[0-9]*\"\r\n                          value={balanceForm.amount}\r\n                          onChange={(e) => onlyNumbers(e)}\r\n                        />\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"form-submit\">\r\n                    <button onClick={transfer}>立即转账</button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div className={`game-sa-overlay picker-over${balanceOver ? \" shown\" : \"\"}`}>\r\n        <div className=\"picker-container\">\r\n          <div className=\"picker-head\">\r\n            <button onClick={(e) => setBalanceOver(null)}>取消</button>\r\n            <p>{balanceOver === \"from\" ? \"推出\" : \"进入\"}</p>\r\n            <button onClick={(e) => setBalanceOver(null)}>确定</button>\r\n          </div>\r\n          {balanceOver ? <PickerWrap dist={balanceOver} /> : null}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default withAuth(Game, 1);\r\n"]},"metadata":{},"sourceType":"module"}