{"ast":null,"code":"var _jsxFileName = \"/Users/cramj/Documents/New PWA/ubet-project (1)/src/pwa/util/withAuth.js\";\nimport React, { useState, useEffect, useContext } from 'react';\nimport { Redirect, useLocation } from 'react-router-dom';\nimport { User } from '../../service/';\n\nfunction withAuth(Component, session) {\n  return function (props) {\n    const {\n      pathname\n    } = useLocation();\n    const [status, setStatus] = useState(0);\n    const {\n      setUserAuthFN\n    } = useContext(User.Context);\n    const [user, setUser] = useState({});\n    useEffect(() => {\n      try {\n        const creds = User.read();\n\n        if (!creds) {\n          setUserAuthFN(-1, null);\n          setStatus(-1);\n          return () => {};\n        }\n\n        const req = User.session(creds);\n        req.promise.then(r => {\n          setUser(r.info);\n          setUserAuthFN(1, r.info);\n          setStatus(1);\n        }, e => {\n          setUserAuthFN(-1, {});\n          setStatus(-1);\n        });\n        return () => req.cancel();\n      } catch (e) {\n        localStorage.removeItem('user');\n        setUserAuthFN(-1, {});\n        setStatus(-1);\n      } // eslint-disable-next-line\n\n    }, []);\n\n    if (status === 0 && session === 1) {\n      return null;\n    }\n\n    if (status === -1 && session === 1) {\n      return /*#__PURE__*/React.createElement(Redirect, {\n        to: {\n          pathname: '/login',\n          state: {\n            referrer: pathname\n          }\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 71,\n          columnNumber: 11\n        }\n      });\n    }\n\n    return /*#__PURE__*/React.createElement(Component, Object.assign({\n      user: user\n    }, props, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 79,\n        columnNumber: 10\n      }\n    }));\n  };\n}\n\nexport default withAuth;","map":{"version":3,"sources":["/Users/cramj/Documents/New PWA/ubet-project (1)/src/pwa/util/withAuth.js"],"names":["React","useState","useEffect","useContext","Redirect","useLocation","User","withAuth","Component","session","props","pathname","status","setStatus","setUserAuthFN","Context","user","setUser","creds","read","req","promise","then","r","info","e","cancel","localStorage","removeItem","state","referrer"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,SAA1B,EAAqCC,UAArC,QAAuD,OAAvD;AACA,SAASC,QAAT,EAAmBC,WAAnB,QAAsC,kBAAtC;AAEA,SAASC,IAAT,QAAqB,gBAArB;;AAEA,SAASC,QAAT,CAAmBC,SAAnB,EAA8BC,OAA9B,EAAuC;AAEtC,SAAO,UAAUC,KAAV,EAAiB;AAEvB,UAAM;AAAEC,MAAAA;AAAF,QAAeN,WAAW,EAAhC;AAEA,UAAM,CAAEO,MAAF,EAAUC,SAAV,IAAwBZ,QAAQ,CAAC,CAAD,CAAtC;AAEA,UAAM;AAAEa,MAAAA;AAAF,QAAoBX,UAAU,CAACG,IAAI,CAACS,OAAN,CAApC;AACA,UAAM,CAAEC,IAAF,EAAQC,OAAR,IAAoBhB,QAAQ,CAAC,EAAD,CAAlC;AAEAC,IAAAA,SAAS,CAAC,MAAM;AAEf,UAAI;AAEH,cAAMgB,KAAK,GAAGZ,IAAI,CAACa,IAAL,EAAd;;AAEA,YAAI,CAACD,KAAL,EAAY;AAEXJ,UAAAA,aAAa,CAAC,CAAC,CAAF,EAAK,IAAL,CAAb;AAEAD,UAAAA,SAAS,CAAC,CAAC,CAAF,CAAT;AAEA,iBAAO,MAAM,CAAE,CAAf;AAEA;;AAED,cAAMO,GAAG,GAAGd,IAAI,CAACG,OAAL,CAAaS,KAAb,CAAZ;AAEAE,QAAAA,GAAG,CAACC,OAAJ,CAAYC,IAAZ,CAAiBC,CAAC,IAAI;AAErBN,UAAAA,OAAO,CAACM,CAAC,CAACC,IAAH,CAAP;AAEAV,UAAAA,aAAa,CAAC,CAAD,EAAIS,CAAC,CAACC,IAAN,CAAb;AAEAX,UAAAA,SAAS,CAAC,CAAD,CAAT;AAEA,SARD,EAQGY,CAAC,IAAI;AAEPX,UAAAA,aAAa,CAAC,CAAC,CAAF,EAAK,EAAL,CAAb;AAEAD,UAAAA,SAAS,CAAC,CAAC,CAAF,CAAT;AAEA,SAdD;AAgBA,eAAO,MAAMO,GAAG,CAACM,MAAJ,EAAb;AAEA,OAlCD,CAkCE,OAAOD,CAAP,EAAU;AAEXE,QAAAA,YAAY,CAACC,UAAb,CAAwB,MAAxB;AAEAd,QAAAA,aAAa,CAAC,CAAC,CAAF,EAAK,EAAL,CAAb;AAEAD,QAAAA,SAAS,CAAC,CAAC,CAAF,CAAT;AAEA,OA5Cc,CA8ChB;;AACC,KA/CQ,EA+CN,EA/CM,CAAT;;AAiDA,QAAID,MAAM,KAAK,CAAX,IAAgBH,OAAO,KAAK,CAAhC,EAAmC;AAClC,aAAO,IAAP;AACA;;AAED,QAAIG,MAAM,KAAK,CAAC,CAAZ,IAAiBH,OAAO,KAAK,CAAjC,EAAoC;AACnC,0BAAO,oBAAC,QAAD;AAAU,QAAA,EAAE,EAAE;AACpBE,UAAAA,QAAQ,EAAE,QADU;AAEpBkB,UAAAA,KAAK,EAAE;AACNC,YAAAA,QAAQ,EAAEnB;AADJ;AAFa,SAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAAP;AAMA;;AAED,wBAAO,oBAAC,SAAD;AAAW,MAAA,IAAI,EAAEK;AAAjB,OAA2BN,KAA3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAP;AAEA,GAzED;AA2EA;;AAED,eAAeH,QAAf","sourcesContent":["import React, { useState, useEffect, useContext } from 'react';\r\nimport { Redirect, useLocation } from 'react-router-dom';\r\n\r\nimport { User } from '../../service/';\r\n\r\nfunction withAuth (Component, session) {\r\n\r\n\treturn function (props) {\r\n\r\n\t\tconst { pathname } = useLocation();\r\n\r\n\t\tconst [ status, setStatus ] = useState(0);\r\n\r\n\t\tconst { setUserAuthFN } = useContext(User.Context);\r\n\t\tconst [ user, setUser ] = useState({});\r\n\r\n\t\tuseEffect(() => {\r\n\r\n\t\t\ttry {\r\n\r\n\t\t\t\tconst creds = User.read();\r\n\r\n\t\t\t\tif (!creds) {\r\n\r\n\t\t\t\t\tsetUserAuthFN(-1, null);\r\n\r\n\t\t\t\t\tsetStatus(-1);\r\n\r\n\t\t\t\t\treturn () => {}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst req = User.session(creds);\r\n\r\n\t\t\t\treq.promise.then(r => {\r\n\r\n\t\t\t\t\tsetUser(r.info);\r\n\r\n\t\t\t\t\tsetUserAuthFN(1, r.info);\r\n\r\n\t\t\t\t\tsetStatus(1);\r\n\r\n\t\t\t\t}, e => {\r\n\r\n\t\t\t\t\tsetUserAuthFN(-1, {});\r\n\r\n\t\t\t\t\tsetStatus(-1);\r\n\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn () => req.cancel();\r\n\t\t\t\r\n\t\t\t} catch (e) {\r\n\r\n\t\t\t\tlocalStorage.removeItem('user');\r\n\r\n\t\t\t\tsetUserAuthFN(-1, {});\r\n\r\n\t\t\t\tsetStatus(-1);\r\n\r\n\t\t\t}\r\n\r\n\t\t// eslint-disable-next-line\r\n\t\t}, []);\r\n\r\n\t\tif (status === 0 && session === 1) {\r\n\t\t\treturn null\r\n\t\t}\r\n\r\n\t\tif (status === -1 && session === 1) {\r\n\t\t\treturn <Redirect to={{\r\n\t\t\t\tpathname: '/login',\r\n\t\t\t\tstate: {\r\n\t\t\t\t\treferrer: pathname\r\n\t\t\t\t}\r\n\t\t\t}} />\r\n\t\t}\r\n\r\n\t\treturn <Component user={user} {...props} />\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport default withAuth;\r\n"]},"metadata":{},"sourceType":"module"}