{"ast":null,"code":"var _jsxFileName = \"/Users/cramj/Downloads/usportproject 2/src/pwa/view/profile/Transfer.js\";\nimport React, { useEffect, useState, useContext } from \"react\";\nimport Picker from \"react-mobile-picker\";\nimport cx from \"classnames\";\nimport BigNumber from \"bignumber.js\";\nimport { Wrap } from \"./\";\nimport { Icon } from \"../../../component/\";\nimport { UIAlertSA } from \"../../component/\";\nimport { User, Game } from \"../../../service/\";\nimport { withAuth } from \"../../util\";\n\nconst Transfer = () => {\n  const {\n    userAuth,\n    setUserAuthFN\n  } = useContext(User.Context);\n  const [balances, setBalances] = useState({\n    from: [],\n    to: []\n  });\n  const [balancesFill, setBalancesFill] = useState({\n    wallet: [],\n    games: []\n  });\n  const [balancesRaw, setBalancesRaw] = useState([]);\n  const [balanceTransferred, setBalanceTransferred] = useState(false);\n  const [balanceLoad, setBalanceLoad] = useState(false);\n  const [balanceUpdateI, setBalanceUpdateI] = useState(0);\n  const [balancesMap, setBalancesMap] = useState({});\n  const [balanceOver, setBalanceOver] = useState(null);\n  const [balanceForm, setBalanceForm] = useState({\n    from: null,\n    to: null,\n    amount: \"\"\n  });\n  useEffect(() => {\n    setBalances({\n      from: [],\n      to: []\n    });\n    setBalancesMap({});\n    setBalancesFill({\n      wallet: [],\n      games: []\n    });\n    Game.balances({ ...User.read()\n    }).then(_balances => {\n      setBalancesRaw(_balances.filter(b => !b.error)); // const __balances = _balances.map(b => `${b.game.name}: ${b.balance} ¥`);\n      // \t\t\t__balances.unshift(`中央钱包: ${userAuth.data.balance} ¥`);\n\n      const __balances = _balances.filter(b => !b.error).map(b => `${b.game.name}`);\n\n      __balances.unshift(`中心钱包`);\n\n      const _bFillWallet = [`中心钱包`];\n\n      const _bFillGames = _balances.filter(b => !b.error).map(b => b.game.name);\n\n      setBalancesFill({\n        wallet: _bFillWallet,\n        games: _bFillGames\n      });\n      setBalanceForm(balanceForm => ({ ...balanceForm,\n        from: __balances[0],\n        to: __balances[1]\n      }));\n      setBalances({\n        from: __balances,\n        // to: __balances,\n        to: _bFillGames\n      });\n      const __balancesMap = {};\n\n      _balances.filter(b => !b.error).forEach(b => {\n        __balancesMap[b.game.name] = b;\n      });\n\n      __balancesMap[\"中心钱包\"] = {\n        game: {\n          id: 0,\n          name: \"wallet\"\n        },\n        wallet: true,\n        balance: +userAuth.data.balance\n      };\n      setBalancesMap(__balancesMap);\n    });\n  }, [balanceUpdateI, userAuth.data.balance]);\n  useEffect(() => {\n    User.session({ ...User.read()\n    }).promise.then(r => setUserAuthFN(1, r.info));\n    setBalanceForm(bf => ({ ...bf,\n      amount: \"\"\n    })); // eslint-disable-next-line\n  }, [balanceUpdateI]);\n  const AmountVariants = [100, 500, 1000, 2000, 5000];\n\n  const PickerWrap = ({\n    dist\n  }) => /*#__PURE__*/React.createElement(\"div\", {\n    className: \"picker-wrap\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 5\n    }\n  }, balances[dist].length ? /*#__PURE__*/React.createElement(Picker, {\n    height: 180,\n    valueGroups: {\n      [dist]: balanceForm[dist]\n    },\n    optionGroups: {\n      [dist]: balances[dist]\n    },\n    onChange: (key, value) => {\n      if (dist === \"from\") {\n        const _d = balancesMap[value].wallet ? \"games\" : \"wallet\";\n\n        setBalances(b => ({ ...b,\n          to: balancesFill[_d]\n        }));\n        setBalanceForm(bf => ({ ...bf,\n          to: balancesFill[_d][0]\n        }));\n      }\n\n      setBalanceForm(bf => ({ ...bf,\n        [key]: value\n      }));\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 9\n    }\n  }) : null);\n\n  const swap = () => {\n    const [to, from] = [balanceForm.from, balanceForm.to];\n\n    const _d1 = balancesMap[from].wallet ? \"games\" : \"wallet\";\n\n    const _d2 = balancesMap[to].wallet ? \"games\" : \"wallet\";\n\n    setBalances(b => ({ ...b,\n      to: balancesFill[_d1],\n      from: balancesFill[_d2]\n    }));\n    setBalanceForm(bf => ({ ...bf,\n      to,\n      from\n    }));\n  };\n\n  const setAmount = e => {\n    const amount = e.target ? e.target.value : e;\n    setBalanceForm(form => ({ ...form,\n      amount\n    }));\n  };\n\n  const setMax = () => {\n    const _game = balancesMap[balanceForm.from];\n    let _max = _game.balance;\n\n    if (_game.wallet) {\n      _max = userAuth.data.balance;\n    }\n\n    setAmount(_max);\n  };\n\n  const onlyNumbers = e => {\n    const exclude = [\"Tab\", \"ArrowLeft\", \"ArrowRight\", \"Meta\", \"Backspace\"];\n\n    if (!e.metaKey && !exclude.includes(e.key) && !/[\\d,.]$/.test(e.key)) {\n      e.preventDefault();\n    }\n  };\n\n  const transfer = e => {\n    if (!balanceForm.amount || isNaN(+balanceForm.amount)) {\n      return void console.warn(\"[transfer] No amount\");\n    }\n\n    const _getMap = n => balancesMap[n.split(\": \")[0]] || null;\n\n    const _from = _getMap(balanceForm.from);\n\n    const _to = _getMap(balanceForm.to);\n\n    if (_from.game.id === _to.game.id) {\n      return void console.warn(\"[transfer] Same game\");\n    }\n\n    if (_from.balance === 0) {\n      return void console.warn(\"[transfer] Zero balance\");\n    }\n\n    if (_from.balance < +balanceForm.amount) {\n      return void console.warn(\"[transfer] Not enough game balance\");\n    }\n\n    console.info(`You're transfering ${balanceForm.amount} ¥ from ${_from.game.name} to ${_to.game.name}`);\n    setBalanceLoad(true);\n    Game.transfer({ ...User.read(),\n      amount: +balanceForm.amount,\n      from: _from.game.id,\n      to: _to.game.id\n    }).then(r => {\n      console.info(`You have successfully transferred ${balanceForm.amount} ¥ from ${_from.game.name} to ${_to.game.name}: ${r.info}`);\n      setBalanceLoad(false);\n      setBalanceTransferred(true);\n    }, e => {\n      console.error(e);\n      setBalanceLoad(false);\n    });\n  };\n\n  const wallet = e => {\n    setBalanceLoad(true);\n    Game.transferToWallet().promise.then(r => {\n      setBalanceLoad(false);\n      setBalanceTransferred(true);\n    }, e => {\n      console.warn(e);\n      setBalanceLoad(false);\n    });\n  };\n\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Wrap, {\n    className: \"profile-transfer\",\n    name: \"\\u8F6C\\u8D26\",\n    isLoading: !balancesRaw.length || balanceLoad,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 268,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"fields\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 273,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form-field user-balance\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 274,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"user-balance-wrap wallet\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 275,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    className: \"user-balance-label\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 276,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"i\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 277,\n      columnNumber: 17\n    }\n  }), \" \\u4E2D\\u5FC3\\u94B1\\u5305\"), /*#__PURE__*/React.createElement(\"span\", {\n    className: \"user-balance-amount\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 279,\n      columnNumber: 15\n    }\n  }, BigNumber(userAuth.data.balance).toFormat(2))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"user-balance-wrap hr\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 283,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"user-balance-wrap refresh\",\n    onClick: wallet,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 284,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"i\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 285,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(\"span\", {\n    className: \"user-balance-label\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 286,\n      columnNumber: 15\n    }\n  }, \"\\u4E00\\u952E\\u56DE\\u6536\"))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form-field-section\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 301,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form-field balances-list\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 302,\n      columnNumber: 13\n    }\n  }, balancesRaw.map((balance, i) => /*#__PURE__*/React.createElement(\"div\", {\n    key: i,\n    className: \"balances-list--item\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 304,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"game-name\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 305,\n      columnNumber: 19\n    }\n  }, balance.game.name), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"game-balance\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 306,\n      columnNumber: 19\n    }\n  }, BigNumber(balance.balance).toFormat(2)))))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form-field-section\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 316,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form-field--doubler\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 317,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form-field\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 318,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 319,\n      columnNumber: 17\n    }\n  }, \"\\u63A8\\u51FA\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"input--wrap with-dot\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 320,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: cx(\"input-like\", {\n      \"has-value\": balanceForm.from\n    }),\n    onClick: e => setBalanceOver(\"from\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 321,\n      columnNumber: 19\n    }\n  }, balanceForm.from || \"推出\"))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form-field-swap\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 331,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    onClick: () => swap(),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 332,\n      columnNumber: 17\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form-field\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 336,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 337,\n      columnNumber: 17\n    }\n  }, \"\\u8FDB\\u5165\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"input--wrap with-dot\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 338,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: cx(\"input-like\", {\n      \"has-value\": balanceForm.to\n    }),\n    onClick: e => setBalanceOver(\"to\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 339,\n      columnNumber: 19\n    }\n  }, balanceForm.to || \"进入\")))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form-field amount-variants\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 350,\n      columnNumber: 13\n    }\n  }, AmountVariants.map((amount, i) => /*#__PURE__*/React.createElement(\"button\", {\n    key: i,\n    className: cx(\"amount-variant\", {\n      disabled: amount > userAuth.data.balance\n    }),\n    onClick: () => setAmount(amount),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 352,\n      columnNumber: 17\n    }\n  }, amount))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form-field with-max\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 363,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"amount-wrap\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 364,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"input--wrap\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 366,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 367,\n      columnNumber: 19\n    }\n  }, \"\\uFFE5\"), /*#__PURE__*/React.createElement(\"input\", {\n    id: \"amount\",\n    type: \"number\",\n    placeholder: \"\\u91D1\\u989D\",\n    pattern: \"[0-9,.]*\",\n    className: cx({\n      \"has-value\": balanceForm.amount\n    }),\n    value: balanceForm.amount,\n    onChange: e => setAmount(e),\n    onKeyDown: e => onlyNumbers(e),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 368,\n      columnNumber: 19\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"amount-max-wrap\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 380,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    className: cx({\n      disabled: !balancesMap[balanceForm.from] || !balancesMap[balanceForm.from].balance\n    }),\n    onClick: () => setMax(),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 381,\n      columnNumber: 17\n    }\n  }, \"\\u6700\\u5927\\u91D1\\u989D\"))))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"submit\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 396,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    className: \"button-stylized\",\n    onClick: transfer,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 397,\n      columnNumber: 11\n    }\n  }, \"\\u7ACB\\u5373\\u8F6C\\u8D26\")), /*#__PURE__*/React.createElement(UIAlertSA, {\n    onClose: () => null,\n    shown: balanceOver,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 402,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: `game-sa-overlay picker-over`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 403,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"picker-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 404,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"picker-head\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 405,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 406,\n      columnNumber: 17\n    }\n  }, balanceOver === \"from\" ? \"推出\" : \"进入\")), balanceOver ? /*#__PURE__*/React.createElement(PickerWrap, {\n    dist: balanceOver,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 408,\n      columnNumber: 30\n    }\n  }) : null), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"picker-footer\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 410,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    onClick: e => setBalanceOver(null),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 411,\n      columnNumber: 15\n    }\n  }, \"\\u53D6\\u6D88\"), /*#__PURE__*/React.createElement(\"button\", {\n    className: \"active\",\n    onClick: e => setBalanceOver(null),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 412,\n      columnNumber: 15\n    }\n  }, \"\\u786E\\u5B9A\")))), /*#__PURE__*/React.createElement(UIAlertSA, {\n    onClose: () => null,\n    shown: balanceTransferred,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 418,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: `game-sa-overlay`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 419,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"overlay-layer\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 420,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form response\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 421,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form-head\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 422,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"i\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 423,\n      columnNumber: 19\n    }\n  }), /*#__PURE__*/React.createElement(\"h2\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 424,\n      columnNumber: 19\n    }\n  }, \"\\u8F6C\\u8D26\\u6210\\u529F\")), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form-body\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 426,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    onClick: () => {\n      setBalanceTransferred(false);\n      setBalanceUpdateI(i => i + 1);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 427,\n      columnNumber: 19\n    }\n  }, \"\\u786E\\u8BA4\"))))))));\n};\n\nexport default withAuth(Transfer, 1);","map":{"version":3,"sources":["/Users/cramj/Downloads/usportproject 2/src/pwa/view/profile/Transfer.js"],"names":["React","useEffect","useState","useContext","Picker","cx","BigNumber","Wrap","Icon","UIAlertSA","User","Game","withAuth","Transfer","userAuth","setUserAuthFN","Context","balances","setBalances","from","to","balancesFill","setBalancesFill","wallet","games","balancesRaw","setBalancesRaw","balanceTransferred","setBalanceTransferred","balanceLoad","setBalanceLoad","balanceUpdateI","setBalanceUpdateI","balancesMap","setBalancesMap","balanceOver","setBalanceOver","balanceForm","setBalanceForm","amount","read","then","_balances","filter","b","error","__balances","map","game","name","unshift","_bFillWallet","_bFillGames","__balancesMap","forEach","id","balance","data","session","promise","r","info","bf","AmountVariants","PickerWrap","dist","length","key","value","_d","swap","_d1","_d2","setAmount","e","target","form","setMax","_game","_max","onlyNumbers","exclude","metaKey","includes","test","preventDefault","transfer","isNaN","console","warn","_getMap","n","split","_from","_to","transferToWallet","toFormat","i","disabled"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useContext } from \"react\";\r\nimport Picker from \"react-mobile-picker\";\r\nimport cx from \"classnames\";\r\nimport BigNumber from \"bignumber.js\";\r\n\r\nimport { Wrap } from \"./\";\r\nimport { Icon } from \"../../../component/\";\r\nimport { UIAlertSA } from \"../../component/\";\r\nimport { User, Game } from \"../../../service/\";\r\nimport { withAuth } from \"../../util\";\r\n\r\nconst Transfer = () => {\r\n  const { userAuth, setUserAuthFN } = useContext(User.Context);\r\n\r\n  const [balances, setBalances] = useState({\r\n    from: [],\r\n    to: [],\r\n  });\r\n\r\n  const [balancesFill, setBalancesFill] = useState({\r\n    wallet: [],\r\n    games: [],\r\n  });\r\n\r\n  const [balancesRaw, setBalancesRaw] = useState([]);\r\n\r\n  const [balanceTransferred, setBalanceTransferred] = useState(false);\r\n  const [balanceLoad, setBalanceLoad] = useState(false);\r\n  const [balanceUpdateI, setBalanceUpdateI] = useState(0);\r\n  const [balancesMap, setBalancesMap] = useState({});\r\n  const [balanceOver, setBalanceOver] = useState(null);\r\n  const [balanceForm, setBalanceForm] = useState({\r\n    from: null,\r\n    to: null,\r\n    amount: \"\",\r\n  });\r\n\r\n  useEffect(() => {\r\n    setBalances({\r\n      from: [],\r\n      to: [],\r\n    });\r\n\r\n    setBalancesMap({});\r\n\r\n    setBalancesFill({\r\n      wallet: [],\r\n      games: [],\r\n    });\r\n\r\n    Game.balances({\r\n      ...User.read(),\r\n    }).then((_balances) => {\r\n      setBalancesRaw(_balances.filter((b) => !b.error));\r\n\r\n      // const __balances = _balances.map(b => `${b.game.name}: ${b.balance} ¥`);\r\n      // \t\t\t__balances.unshift(`中央钱包: ${userAuth.data.balance} ¥`);\r\n      const __balances = _balances\r\n        .filter((b) => !b.error)\r\n        .map((b) => `${b.game.name}`);\r\n      __balances.unshift(`中心钱包`);\r\n\r\n      const _bFillWallet = [`中心钱包`];\r\n      const _bFillGames = _balances\r\n        .filter((b) => !b.error)\r\n        .map((b) => b.game.name);\r\n\r\n      setBalancesFill({\r\n        wallet: _bFillWallet,\r\n        games: _bFillGames,\r\n      });\r\n\r\n      setBalanceForm((balanceForm) => ({\r\n        ...balanceForm,\r\n        from: __balances[0],\r\n        to: __balances[1],\r\n      }));\r\n\r\n      setBalances({\r\n        from: __balances,\r\n        // to: __balances,\r\n        to: _bFillGames,\r\n      });\r\n\r\n      const __balancesMap = {};\r\n\r\n      _balances\r\n        .filter((b) => !b.error)\r\n        .forEach((b) => {\r\n          __balancesMap[b.game.name] = b;\r\n        });\r\n\r\n      __balancesMap[\"中心钱包\"] = {\r\n        game: {\r\n          id: 0,\r\n          name: \"wallet\",\r\n        },\r\n        wallet: true,\r\n        balance: +userAuth.data.balance,\r\n      };\r\n\r\n      setBalancesMap(__balancesMap);\r\n    });\r\n  }, [balanceUpdateI, userAuth.data.balance]);\r\n\r\n  useEffect(() => {\r\n    User.session({\r\n      ...User.read(),\r\n    }).promise.then((r) => setUserAuthFN(1, r.info));\r\n\r\n    setBalanceForm((bf) => ({\r\n      ...bf,\r\n      amount: \"\",\r\n    }));\r\n\r\n    // eslint-disable-next-line\r\n  }, [balanceUpdateI]);\r\n\r\n  const AmountVariants = [100, 500, 1000, 2000, 5000];\r\n\r\n  const PickerWrap = ({ dist }) => (\r\n    <div className=\"picker-wrap\">\r\n      {balances[dist].length ? (\r\n        <Picker\r\n          height={180}\r\n          valueGroups={{ [dist]: balanceForm[dist] }}\r\n          optionGroups={{ [dist]: balances[dist] }}\r\n          onChange={(key, value) => {\r\n            if (dist === \"from\") {\r\n              const _d = balancesMap[value].wallet ? \"games\" : \"wallet\";\r\n\r\n              setBalances((b) => ({\r\n                ...b,\r\n                to: balancesFill[_d],\r\n              }));\r\n\r\n              setBalanceForm((bf) => ({\r\n                ...bf,\r\n                to: balancesFill[_d][0],\r\n              }));\r\n            }\r\n\r\n            setBalanceForm((bf) => ({\r\n              ...bf,\r\n              [key]: value,\r\n            }));\r\n          }}\r\n        />\r\n      ) : null}\r\n    </div>\r\n  );\r\n\r\n  const swap = () => {\r\n    const [to, from] = [balanceForm.from, balanceForm.to];\r\n\r\n    const _d1 = balancesMap[from].wallet ? \"games\" : \"wallet\";\r\n    const _d2 = balancesMap[to].wallet ? \"games\" : \"wallet\";\r\n\r\n    setBalances((b) => ({\r\n      ...b,\r\n      to: balancesFill[_d1],\r\n      from: balancesFill[_d2],\r\n    }));\r\n\r\n    setBalanceForm((bf) => ({\r\n      ...bf,\r\n      to,\r\n      from,\r\n    }));\r\n  };\r\n\r\n  const setAmount = (e) => {\r\n    const amount = e.target ? e.target.value : e;\r\n\r\n    setBalanceForm((form) => ({ ...form, amount }));\r\n  };\r\n\r\n  const setMax = () => {\r\n    const _game = balancesMap[balanceForm.from];\r\n\r\n    let _max = _game.balance;\r\n\r\n    if (_game.wallet) {\r\n      _max = userAuth.data.balance;\r\n    }\r\n\r\n    setAmount(_max);\r\n  };\r\n\r\n  const onlyNumbers = (e) => {\r\n    const exclude = [\"Tab\", \"ArrowLeft\", \"ArrowRight\", \"Meta\", \"Backspace\"];\r\n\r\n    if (!e.metaKey && !exclude.includes(e.key) && !/[\\d,.]$/.test(e.key)) {\r\n      e.preventDefault();\r\n    }\r\n  };\r\n\r\n  const transfer = (e) => {\r\n    if (!balanceForm.amount || isNaN(+balanceForm.amount)) {\r\n      return void console.warn(\"[transfer] No amount\");\r\n    }\r\n\r\n    const _getMap = (n) => balancesMap[n.split(\": \")[0]] || null;\r\n\r\n    const _from = _getMap(balanceForm.from);\r\n    const _to = _getMap(balanceForm.to);\r\n\r\n    if (_from.game.id === _to.game.id) {\r\n      return void console.warn(\"[transfer] Same game\");\r\n    }\r\n\r\n    if (_from.balance === 0) {\r\n      return void console.warn(\"[transfer] Zero balance\");\r\n    }\r\n\r\n    if (_from.balance < +balanceForm.amount) {\r\n      return void console.warn(\"[transfer] Not enough game balance\");\r\n    }\r\n\r\n    console.info(\r\n      `You're transfering ${balanceForm.amount} ¥ from ${_from.game.name} to ${_to.game.name}`\r\n    );\r\n\r\n    setBalanceLoad(true);\r\n\r\n    Game.transfer({\r\n      ...User.read(),\r\n      amount: +balanceForm.amount,\r\n      from: _from.game.id,\r\n      to: _to.game.id,\r\n    }).then(\r\n      (r) => {\r\n        console.info(\r\n          `You have successfully transferred ${balanceForm.amount} ¥ from ${_from.game.name} to ${_to.game.name}: ${r.info}`\r\n        );\r\n\r\n        setBalanceLoad(false);\r\n\r\n        setBalanceTransferred(true);\r\n      },\r\n      (e) => {\r\n        console.error(e);\r\n\r\n        setBalanceLoad(false);\r\n      }\r\n    );\r\n  };\r\n\r\n  const wallet = (e) => {\r\n    setBalanceLoad(true);\r\n\r\n    Game.transferToWallet().promise.then(\r\n      (r) => {\r\n        setBalanceLoad(false);\r\n\r\n        setBalanceTransferred(true);\r\n      },\r\n      (e) => {\r\n        console.warn(e);\r\n\r\n        setBalanceLoad(false);\r\n      }\r\n    );\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Wrap\r\n        className=\"profile-transfer\"\r\n        name=\"转账\"\r\n        isLoading={!balancesRaw.length || balanceLoad}\r\n      >\r\n        <div className=\"fields\">\r\n          <div className=\"form-field user-balance\">\r\n            <div className=\"user-balance-wrap wallet\">\r\n              <span className=\"user-balance-label\">\r\n                <i /> 中心钱包\r\n              </span>\r\n              <span className=\"user-balance-amount\">\r\n                {BigNumber(userAuth.data.balance).toFormat(2)}\r\n              </span>\r\n            </div>\r\n            <div className=\"user-balance-wrap hr\" />\r\n            <div className=\"user-balance-wrap refresh\" onClick={wallet}>\r\n              <i />\r\n              <span className=\"user-balance-label\">一键回收</span>\r\n            </div>\r\n\r\n            {/* <i></i>\r\n\t\t\t\t\t<div className=\"wrap\">\r\n\t\t\t\t\t\t<p className=\"label\">中心钱包</p>\r\n\t\t\t\t\t\t<p className=\"amount\">¥ {BigNumber(userAuth.data.balance).toFormat(2)}</p>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<button className=\"to-wallet\" onClick={wallet}>\r\n\t\t\t\t\t\t<Icon name=\"refresh\" />\r\n\t\t\t\t\t\t<span>一键回收</span>\r\n\t\t\t\t\t</button> */}\r\n          </div>\r\n\r\n          {/* ============================ SECTION ============================  */}\r\n          <div className=\"form-field-section\">\r\n            <div className=\"form-field balances-list\">\r\n              {balancesRaw.map((balance, i) => (\r\n                <div key={i} className=\"balances-list--item\">\r\n                  <div className=\"game-name\">{balance.game.name}</div>\r\n                  <div className=\"game-balance\">\r\n                    {BigNumber(balance.balance).toFormat(2)}\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n          {/* ============================ SECTION ============================  */}\r\n\r\n          {/* ============================ SECTION ============================  */}\r\n          <div className=\"form-field-section\">\r\n            <div className=\"form-field--doubler\">\r\n              <div className=\"form-field\">\r\n                <label>推出</label>\r\n                <div className=\"input--wrap with-dot\">\r\n                  <div\r\n                    className={cx(\"input-like\", {\r\n                      \"has-value\": balanceForm.from,\r\n                    })}\r\n                    onClick={(e) => setBalanceOver(\"from\")}\r\n                  >\r\n                    {balanceForm.from || \"推出\"}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div className=\"form-field-swap\">\r\n                <button onClick={() => swap()}>\r\n                  {/* <Icon name=\"switch\" /> */}\r\n                </button>\r\n              </div>\r\n              <div className=\"form-field\">\r\n                <label>进入</label>\r\n                <div className=\"input--wrap with-dot\">\r\n                  <div\r\n                    className={cx(\"input-like\", {\r\n                      \"has-value\": balanceForm.to,\r\n                    })}\r\n                    onClick={(e) => setBalanceOver(\"to\")}\r\n                  >\r\n                    {balanceForm.to || \"进入\"}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div className=\"form-field amount-variants\">\r\n              {AmountVariants.map((amount, i) => (\r\n                <button\r\n                  key={i}\r\n                  className={cx(\"amount-variant\", {\r\n                    disabled: amount > userAuth.data.balance,\r\n                  })}\r\n                  onClick={() => setAmount(amount)}\r\n                >\r\n                  {amount}\r\n                </button>\r\n              ))}\r\n            </div>\r\n            <div className=\"form-field with-max\">\r\n              <div className=\"amount-wrap\">\r\n                {/* <label htmlFor=\"amount\">金额</label> */}\r\n                <div className=\"input--wrap\">\r\n                  <span>￥</span>\r\n                  <input\r\n                    id=\"amount\"\r\n                    type=\"number\"\r\n                    placeholder=\"金额\"\r\n                    pattern=\"[0-9,.]*\"\r\n                    className={cx({ \"has-value\": balanceForm.amount })}\r\n                    value={balanceForm.amount}\r\n                    onChange={(e) => setAmount(e)}\r\n                    onKeyDown={(e) => onlyNumbers(e)}\r\n                  />\r\n                </div>\r\n              </div>\r\n              <div className=\"amount-max-wrap\">\r\n                <button\r\n                  className={cx({\r\n                    disabled:\r\n                      !balancesMap[balanceForm.from] ||\r\n                      !balancesMap[balanceForm.from].balance,\r\n                  })}\r\n                  onClick={() => setMax()}\r\n                >\r\n                  最大金额\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          {/* ============================ SECTION ============================  */}\r\n        </div>\r\n        <div className=\"submit\">\r\n          <button className=\"button-stylized\" onClick={transfer}>\r\n            立即转账\r\n          </button>\r\n        </div>\r\n\r\n        <UIAlertSA onClose={() => null} shown={balanceOver}>\r\n          <div className={`game-sa-overlay picker-over`}>\r\n            <div className=\"picker-container\">\r\n              <div className=\"picker-head\">\r\n                <p>{balanceOver === \"from\" ? \"推出\" : \"进入\"}</p>\r\n              </div>\r\n              {balanceOver ? <PickerWrap dist={balanceOver} /> : null}\r\n            </div>\r\n            <div className=\"picker-footer\">\r\n              <button onClick={(e) => setBalanceOver(null)}>取消</button>\r\n              <button className=\"active\" onClick={(e) => setBalanceOver(null)}>\r\n                确定\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </UIAlertSA>\r\n        <UIAlertSA onClose={() => null} shown={balanceTransferred}>\r\n          <div className={`game-sa-overlay`}>\r\n            <div className=\"overlay-layer\">\r\n              <div className=\"form response\">\r\n                <div className=\"form-head\">\r\n                  <i />\r\n                  <h2>转账成功</h2>\r\n                </div>\r\n                <div className=\"form-body\">\r\n                  <button\r\n                    onClick={() => {\r\n                      setBalanceTransferred(false);\r\n                      setBalanceUpdateI((i) => i + 1);\r\n                    }}\r\n                  >\r\n                    确认\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </UIAlertSA>\r\n      </Wrap>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default withAuth(Transfer, 1);\r\n\r\n"]},"metadata":{},"sourceType":"module"}