{"ast":null,"code":"import _defineProperty from\"/Users/cramj/Documents/New PWA/GIT/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/Users/cramj/Documents/New PWA/GIT/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/cramj/Documents/New PWA/GIT/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import{NavLink,Link,useParams}from'react-router-dom';import DatePicker from'react-mobile-datepicker';import cx from'classnames';import*as moment from'moment';import{toDate}from'../../../util/';import{User,Transaction as Service}from'../../../service/';import{Icon,UITabs}from'../../../component/';var Transactions=function Transactions(){useEffect(function(){window.scrollTo(0,0);},[]);var _useParams=useParams(),type=_useParams.type;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var _useState3=useState('today'),_useState4=_slicedToArray(_useState3,2),range=_useState4[0],setRange=_useState4[1];var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),customI=_useState6[0],setCustomI=_useState6[1];var _useState7=useState({from:moment().subtract(30,'days').toDate(),to:moment().toDate()}),_useState8=_slicedToArray(_useState7,2),customRange=_useState8[0],setCustomRange=_useState8[1];var _useState9=useState({from:false,to:false}),_useState10=_slicedToArray(_useState9,2),customRangeOpened=_useState10[0],openCustomRange=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),overlayShown=_useState12[0],setOverlay=_useState12[1];var _useState13=useState([]),_useState14=_slicedToArray(_useState13,2),transactions=_useState14[0],setTransactions=_useState14[1];var _useState15=useState([]),_useState16=_slicedToArray(_useState15,2),transactionsFiltered=_useState16[0],setTransactionsFiltered=_useState16[1];useEffect(function(){var req=Service.read(_objectSpread({record_type:type},User.read()));setLoading(true);setTransactions([]);req.promise.then(function(r){var _transactions=r.info.map(function(t){t.timestamp=toDate(t.requestTime,true);if(t.endTime){t.timestamp=toDate(t.endTime,true);}if(t.add_date){t.timestamp=toDate(t.add_date,true);}return t;});setLoading(false);setTransactions(_transactions);},function(e){if(!e.is_aborted){console.error('Unable to get transactions:',e);}});return function(){return req.cancel();};},[type]);useEffect(function(){var _rangeMap={today:function today(){var today=moment();return[today.startOf('day').unix(),today.endOf('day').unix()];},yesterday:function yesterday(){var yesterday=moment().subtract(1,'days');return[yesterday.startOf('day').unix(),yesterday.endOf('day').unix()];},week:function week(){return[moment().subtract(1,'weeks').startOf('day').unix(),moment().endOf('day').unix()];},month:function month(){return[moment().subtract(30,'days').startOf('day').unix(),moment().endOf('day').unix()];},custom:function custom(){var from=customRange.from,to=customRange.to;return[moment(from).startOf('day').unix(),moment(to).endOf('day').unix()];}};var _rangeMap$range=_rangeMap[range](),_rangeMap$range2=_slicedToArray(_rangeMap$range,2),from=_rangeMap$range2[0],to=_rangeMap$range2[1];var _transactions=transactions.filter(function(t){return t.timestamp>=from&&t.timestamp<to;});setTransactionsFiltered(_transactions);// eslint-disable-next-line\n},[range,customI,transactions]);useEffect(function(){document.body.style.overflow=overlayShown?'hidden':'auto';return function(){document.body.style.overflow='auto';};},[overlayShown]);var setRangeHandle=function setRangeHandle(range){if(range==='custom'){return void setOverlay(true);}setRange(range);};var applyCustomRange=function applyCustomRange(){setOverlay(false);setCustomI(customI+1);setRange('custom');};var Transaction=function Transaction(_ref){var type=_ref.type,transaction=_ref.transaction;return/*#__PURE__*/React.createElement(\"div\",{className:\"transaction\"},type==='debit'?/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"content\"},/*#__PURE__*/React.createElement(\"p\",{className:\"date\"},transaction.requestTime),/*#__PURE__*/React.createElement(\"p\",{className:\"dist\"},transaction.bankInfo),/*#__PURE__*/React.createElement(\"p\",{className:\"amount\"},transaction.amount,\"\\u5143\")),/*#__PURE__*/React.createElement(\"div\",{className:\"status stat-\".concat(transaction.status)},/*#__PURE__*/React.createElement(\"span\",null,transaction.status))):null,type==='deposit'?/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"content\"},/*#__PURE__*/React.createElement(\"p\",{className:\"date\"},transaction.endTime),/*#__PURE__*/React.createElement(\"p\",{className:\"dist\"},transaction.payType),/*#__PURE__*/React.createElement(\"p\",{className:\"amount\"},transaction.amount,\"\\u5143\")),/*#__PURE__*/React.createElement(\"div\",{className:\"status stat-\".concat(transaction.status)},/*#__PURE__*/React.createElement(\"span\",null,transaction.status))):null,type==='transfer'?/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"content\"},/*#__PURE__*/React.createElement(\"p\",{className:\"date\"},transaction.requestTime),/*#__PURE__*/React.createElement(\"p\",{className:\"dist\"},(transaction.platName||'').split('-->').join('\\n-->')),/*#__PURE__*/React.createElement(\"p\",{className:\"amount\"},transaction.amount,\"\\u5143\")),/*#__PURE__*/React.createElement(\"div\",{className:\"status stat-\".concat(transaction.tranStatus)},/*#__PURE__*/React.createElement(\"span\",null,transaction.tranStatus))):null,type==='washcode'?/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"content washcode\"},/*#__PURE__*/React.createElement(\"p\",{className:\"date\"},transaction.add_date),/*#__PURE__*/React.createElement(\"p\",{className:\"dist\"},transaction.game_id),/*#__PURE__*/React.createElement(\"p\",{className:\"amount\"},transaction.money,\"\\u5143\")),/*#__PURE__*/React.createElement(\"div\",{className:\"status stat-ratio\"},/*#__PURE__*/React.createElement(\"span\",null,transaction.ratio))):null);};var monthMap={'1':'一月','2':'二月','3':'三月','4':'四月','5':'五月','6':'六月','7':'七月','8':'八月','9':'九月','10':'十月','11':'十一月','12':'十二月'};var DatePickerWrap=function DatePickerWrap(_ref2){var type=_ref2.type,header=_ref2.header,min=_ref2.min;return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"p\",{onClick:function onClick(e){return openCustomRange(_objectSpread(_objectSpread({},customRangeOpened),{},_defineProperty({},type,true)));}},moment(customRange[type]).format('YYYY-MM-DD')),/*#__PURE__*/React.createElement(DatePicker,{theme:\"ios\",confirmText:\"\\u597D\\u5427\",headerFormat:header,value:customRange[type],isOpen:customRangeOpened[type],min:min,dateConfig:{year:{format:'YYYY'},month:{format:function format(v){return monthMap[v.getMonth()+1];}},date:{format:'D'}},onSelect:function onSelect(date){openCustomRange(_objectSpread(_objectSpread({},customRangeOpened),{},_defineProperty({},type,false)));setCustomRange(_objectSpread(_objectSpread({},customRange),{},_defineProperty({},type,date)));},onCancel:function onCancel(e){return openCustomRange(_objectSpread(_objectSpread({},customRangeOpened),{},_defineProperty({},type,false)));}}));};return/*#__PURE__*/React.createElement(\"div\",{className:cx('transactions-sa','with-loader',{loading:loading})},/*#__PURE__*/React.createElement(\"div\",{className:\"load-spin\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"transactions-head\"},/*#__PURE__*/React.createElement(\"div\",{className:\"transactions-back-wrap\"},/*#__PURE__*/React.createElement(Link,{to:\"/profile\"},/*#__PURE__*/React.createElement(Icon,{name:\"arrow-left\"}),/*#__PURE__*/React.createElement(\"p\",null,\"\\u4EA4\\u6613\\u8BB0\\u5F55\")),/*#__PURE__*/React.createElement(\"button\",{className:\"faq\"},/*#__PURE__*/React.createElement(Icon,{name:\"faq\"}))),/*#__PURE__*/React.createElement(\"div\",{className:\"transactions-menu\"},/*#__PURE__*/React.createElement(NavLink,{to:\"/profile/transactions/deposit\"},\"\\u5B58\\u6B3E\\u8BB0\\u5F55\"),/*#__PURE__*/React.createElement(NavLink,{to:\"/profile/transactions/transfer\"},\"\\u8F6C\\u8D26\\u8BB0\\u5F55\"),/*#__PURE__*/React.createElement(NavLink,{to:\"/profile/transactions/washcode\"},\"\\u53CD\\u6C34\\u8BB0\\u5F55\"))),/*#__PURE__*/React.createElement(\"div\",{className:\"transactions-content\"},/*#__PURE__*/React.createElement(\"div\",{className:\"transactions-range\"},/*#__PURE__*/React.createElement(UITabs,{tabs:[{index:'today',name:'今天'},{index:'yesterday',name:'昨天'},{index:'week',name:'本周'},{index:'month',name:'本月'},{index:'custom',name:'自选'}],tab:range,onSet:setRangeHandle})),/*#__PURE__*/React.createElement(\"div\",{className:\"transactions-list\"},transactionsFiltered.map(function(transaction,i){return/*#__PURE__*/React.createElement(Transaction,{type:type,key:i,transaction:transaction});}))),/*#__PURE__*/React.createElement(\"div\",{className:cx('transactions-overlay',{shown:overlayShown})},/*#__PURE__*/React.createElement(\"div\",{className:\"transactions-overlay--inner\"},/*#__PURE__*/React.createElement(\"div\",{className:\"transactions-overlay--wrap\"},/*#__PURE__*/React.createElement(\"div\",{className:\"custom-range-form\"},/*#__PURE__*/React.createElement(\"h2\",null,\"\\u9009\\u62E9\\u65F6\\u95F4\"),/*#__PURE__*/React.createElement(\"div\",{className:\"form-wrap\"},/*#__PURE__*/React.createElement(\"div\",{className:\"field\"},/*#__PURE__*/React.createElement(\"label\",null,\"\\u5F00\\u59CB\\u65E5\\u671F\"),/*#__PURE__*/React.createElement(DatePickerWrap,{type:\"from\",header:\"\\u9009\\u62E9\\u65F6\\u95F4\"})),/*#__PURE__*/React.createElement(\"div\",{className:\"field\"},/*#__PURE__*/React.createElement(\"label\",null,\"\\u7ED3\\u675F\\u65E5\\u671F\"),/*#__PURE__*/React.createElement(DatePickerWrap,{type:\"to\",min:customRange.from,header:\"\\u9009\\u62E9\\u7ED3\\u675F\\u65F6\\u95F4\"}))),/*#__PURE__*/React.createElement(\"div\",{className:\"form-buttons\"},/*#__PURE__*/React.createElement(\"button\",{className:\"cancel\",onClick:function onClick(e){return setOverlay(false);}},\"\\u53D6\\u6D88\"),/*#__PURE__*/React.createElement(\"button\",{className:\"update\",onClick:function onClick(e){return applyCustomRange();}},\"\\u786E\\u8BA4\")))))));};export default Transactions;","map":{"version":3,"sources":["/Users/cramj/Documents/New PWA/GIT/src/pwa/view/profile/Transactions.jsx"],"names":["React","useEffect","useState","NavLink","Link","useParams","DatePicker","cx","moment","toDate","User","Transaction","Service","Icon","UITabs","Transactions","window","scrollTo","type","loading","setLoading","range","setRange","customI","setCustomI","from","subtract","to","customRange","setCustomRange","customRangeOpened","openCustomRange","overlayShown","setOverlay","transactions","setTransactions","transactionsFiltered","setTransactionsFiltered","req","read","record_type","promise","then","r","_transactions","info","map","t","timestamp","requestTime","endTime","add_date","e","is_aborted","console","error","cancel","_rangeMap","today","startOf","unix","endOf","yesterday","week","month","custom","filter","document","body","style","overflow","setRangeHandle","applyCustomRange","transaction","bankInfo","amount","status","payType","platName","split","join","tranStatus","game_id","money","ratio","monthMap","DatePickerWrap","header","min","format","year","v","getMonth","date","index","name","i","shown"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { NavLink, Link, useParams } from 'react-router-dom';\r\nimport DatePicker from 'react-mobile-datepicker';\r\nimport cx from 'classnames';\r\nimport * as moment from 'moment';\r\n\r\nimport { toDate } from '../../../util/';\r\nimport { User, Transaction as Service } from '../../../service/';\r\nimport { Icon, UITabs } from '../../../component/';\r\n\r\nconst Transactions = () => {\r\n\r\n\tuseEffect(() => {\r\n\r\n\t\twindow.scrollTo(0, 0);\r\n\r\n\t}, []);\r\n\r\n\tconst { type } = useParams();\r\n\r\n\tconst [ loading, setLoading ] = useState(false);\r\n\tconst [ range, setRange ] = useState('today');\r\n\r\n\tconst [ customI, setCustomI ] = useState(0);\r\n\tconst [ customRange, setCustomRange ] = useState({\r\n\t\tfrom: moment().subtract(30, 'days').toDate(),\r\n\t\tto: moment().toDate()\r\n\t});\r\n\r\n\tconst [ customRangeOpened, openCustomRange ] = useState({\r\n\t\tfrom: false,\r\n\t\tto: false,\r\n\t});\r\n\r\n\tconst [ overlayShown, setOverlay ] = useState(false);\r\n\r\n\tconst [ transactions, setTransactions ] = useState([]);\r\n\tconst [ transactionsFiltered, setTransactionsFiltered ] = useState([]);\r\n\r\n\tuseEffect(() => {\r\n\r\n\t\tvar req = Service.read({\r\n\t\t\trecord_type: type,\r\n\t\t\t...User.read(),\r\n\t\t});\r\n\r\n\t\tsetLoading(true);\r\n\t\tsetTransactions([]);\r\n\r\n\t\treq.promise.then(r => {\r\n\r\n\t\t\tconst _transactions = r.info.map(t => {\r\n\r\n\t\t\t\tt.timestamp = toDate(t.requestTime, true);\r\n\r\n\t\t\t\tif (t.endTime) {\r\n\t\t\t\t\tt.timestamp = toDate(t.endTime, true);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (t.add_date) {\r\n\t\t\t\t\tt.timestamp = toDate(t.add_date, true);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn t;\r\n\r\n\t\t\t});\r\n\r\n\t\t\tsetLoading(false);\r\n\t\t\tsetTransactions(_transactions);\r\n\r\n\t\t}, e => {\r\n\r\n\t\t\tif (!e.is_aborted) {\r\n\t\t\t\tconsole.error('Unable to get transactions:', e);\r\n\t\t\t}\r\n\r\n\t\t});\r\n\r\n\t\treturn () => req.cancel();\r\n\r\n\t}, [ type ]);\r\n\r\n\tuseEffect(() => {\r\n\r\n\t\tconst _rangeMap = {\r\n\t\t\ttoday: () => {\r\n\t\t\t\tconst today = moment();\r\n\t\t\t\treturn [\r\n\t\t\t\t\ttoday.startOf('day').unix(),\r\n\t\t\t\t\ttoday.endOf('day').unix()\r\n\t\t\t\t];\r\n\t\t\t},\r\n\t\t\tyesterday: () => {\r\n\t\t\t\tconst yesterday = moment().subtract(1, 'days');\r\n\t\t\t\treturn [\r\n\t\t\t\t\tyesterday.startOf('day').unix(),\r\n\t\t\t\t\tyesterday.endOf('day').unix()\r\n\t\t\t\t];\r\n\t\t\t},\r\n\t\t\tweek: () => {\r\n\t\t\t\treturn [\r\n\t\t\t\t\tmoment().subtract(1, 'weeks').startOf('day').unix(),\r\n\t\t\t\t\tmoment().endOf('day').unix()\r\n\t\t\t\t];\r\n\t\t\t},\r\n\t\t\tmonth: () => {\r\n\t\t\t\treturn [\r\n\t\t\t\t\tmoment().subtract(30, 'days').startOf('day').unix(),\r\n\t\t\t\t\tmoment().endOf('day').unix()\r\n\t\t\t\t];\r\n\t\t\t},\r\n\t\t\tcustom: () => {\r\n\t\t\t\tlet { from, to } = customRange;\r\n\t\t\t\treturn [\r\n\t\t\t\t\tmoment(from).startOf('day').unix(),\r\n\t\t\t\t\tmoment(to).endOf('day').unix()\r\n\t\t\t\t];\r\n\t\t\t},\r\n\t\t};\r\n\r\n\t\tconst [ from, to ] = _rangeMap[range]();\r\n\r\n\t\tconst _transactions = transactions.filter(t => {\r\n\t\t\treturn t.timestamp >= from && t.timestamp < to;\r\n\t\t});\r\n\r\n\t\tsetTransactionsFiltered(_transactions);\r\n\r\n\t// eslint-disable-next-line\r\n\t}, [ range, customI, transactions ]);\r\n\r\n\tuseEffect(() => {\r\n\r\n\t\tdocument.body.style.overflow = overlayShown ? 'hidden' : 'auto';\r\n\r\n\t\treturn () => {\r\n\t\t\tdocument.body.style.overflow = 'auto';\r\n\t\t};\r\n\r\n\t}, [ overlayShown ]);\r\n\r\n\tconst setRangeHandle = range => {\r\n\r\n\t\tif (range === 'custom') {\r\n\t\t\treturn void setOverlay(true);\r\n\t\t}\r\n\r\n\t\tsetRange(range);\r\n\r\n\t}\r\n\r\n\tconst applyCustomRange = () => {\r\n\r\n\t\tsetOverlay(false);\r\n\r\n\t\tsetCustomI(customI + 1);\r\n\r\n\t\tsetRange('custom');\r\n\r\n\t}\r\n\r\n\tconst Transaction = ({ type, transaction }) => (\r\n\t\t<div className=\"transaction\">\r\n\t\t\t{type === 'debit' ? (\r\n\t\t\t<>\r\n\t\t\t\t<div className=\"content\">\r\n\t\t\t\t\t<p className=\"date\">{transaction.requestTime}</p>\r\n\t\t\t\t\t<p className=\"dist\">{transaction.bankInfo}</p>\r\n\t\t\t\t\t<p className=\"amount\">{transaction.amount}元</p>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className={`status stat-${transaction.status}`}>\r\n\t\t\t\t\t<span>{transaction.status}</span>\r\n\t\t\t\t</div>\r\n\t\t\t</>\r\n\t\t\t) : null}\r\n\t\t\t{type === 'deposit' ? (\r\n\t\t\t<>\r\n\t\t\t\t<div className=\"content\">\r\n\t\t\t\t\t<p className=\"date\">{transaction.endTime}</p>\r\n\t\t\t\t\t<p className=\"dist\">{transaction.payType}</p>\r\n\t\t\t\t\t<p className=\"amount\">{transaction.amount}元</p>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className={`status stat-${transaction.status}`}>\r\n\t\t\t\t\t<span>{transaction.status}</span>\r\n\t\t\t\t</div>\r\n\t\t\t</>\r\n\t\t\t) : null}\r\n\t\t\t{type === 'transfer' ? (\r\n\t\t\t<>\r\n\t\t\t\t<div className=\"content\">\r\n\t\t\t\t\t<p className=\"date\">{transaction.requestTime}</p>\r\n\t\t\t\t\t<p className=\"dist\">{(transaction.platName||'').split('-->').join('\\n-->')}</p>\r\n\t\t\t\t\t<p className=\"amount\">{transaction.amount}元</p>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className={`status stat-${transaction.tranStatus}`}>\r\n\t\t\t\t\t<span>{transaction.tranStatus}</span>\r\n\t\t\t\t</div>\r\n\t\t\t</>\r\n\t\t\t) : null}\r\n\t\t\t{type === 'washcode' ? (\r\n\t\t\t<>\r\n\t\t\t\t<div className=\"content washcode\">\r\n\t\t\t\t\t<p className=\"date\">{transaction.add_date}</p>\r\n\t\t\t\t\t<p className=\"dist\">{transaction.game_id}</p>\r\n\t\t\t\t\t<p className=\"amount\">{transaction.money}元</p>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className={`status stat-ratio`}>\r\n\t\t\t\t\t<span>{transaction.ratio}</span>\r\n\t\t\t\t</div>\r\n\t\t\t</>\r\n\t\t\t) : null}\r\n\t\t</div>\r\n\t)\r\n\r\n\tconst monthMap = {\r\n\t\t'1': '一月',\r\n\t\t'2': '二月',\r\n\t\t'3': '三月',\r\n\t\t'4': '四月',\r\n\t\t'5': '五月',\r\n\t\t'6': '六月',\r\n\t\t'7': '七月',\r\n\t\t'8': '八月',\r\n\t\t'9': '九月',\r\n\t\t'10': '十月',\r\n\t\t'11': '十一月',\r\n\t\t'12': '十二月',\r\n\t};\r\n\r\n\tconst DatePickerWrap = ({ type, header, min }) => (\r\n\t\t<>\r\n\t\t\t<p onClick={e => openCustomRange({\r\n\t\t\t\t...customRangeOpened,\r\n\t\t\t\t[type]: true,\r\n\t\t\t})}>{moment(customRange[type]).format('YYYY-MM-DD')}</p>\r\n\t\t\t<DatePicker\r\n\t\t\t\ttheme=\"ios\"\r\n\t\t\t\tconfirmText=\"好吧\"\r\n\t\t\t\theaderFormat={header}\r\n\t\t\t\tvalue={customRange[type]}\r\n\t\t\t\tisOpen={customRangeOpened[type]}\r\n\t\t\t\tmin={min}\r\n\t\t\t\tdateConfig={{\r\n\t\t\t\t\tyear: {\r\n\t\t\t\t\t\tformat: 'YYYY',\r\n\t\t\t\t\t},\r\n\t\t\t\t\tmonth: {\r\n\t\t\t\t\t\tformat: v => monthMap[v.getMonth() + 1],\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdate: {\r\n\t\t\t\t\t\tformat: 'D',\r\n\t\t\t\t\t},\r\n\t\t\t\t}}\r\n\t\t\t\tonSelect={date => {\r\n\t\t\t\t\topenCustomRange({\r\n\t\t\t\t\t\t...customRangeOpened,\r\n\t\t\t\t\t\t[type]: false,\r\n\t\t\t\t\t});\r\n\t\t\t\t\tsetCustomRange({\r\n\t\t\t\t\t\t...customRange,\r\n\t\t\t\t\t\t[type]: date,\r\n\t\t\t\t\t});\r\n\t\t\t\t}}\r\n\t\t\t\tonCancel={e => openCustomRange({\r\n\t\t\t\t\t...customRangeOpened,\r\n\t\t\t\t\t[type]: false,\r\n\t\t\t\t})} />\r\n\t\t</>\r\n\t)\r\n\r\n\treturn (\r\n\t\t<div className={cx('transactions-sa', 'with-loader', { loading })}>\r\n\t\t\t<div className=\"load-spin\"></div>\r\n\t\t\t<div className=\"transactions-head\">\r\n\t\t\t\t<div className=\"transactions-back-wrap\">\r\n\t\t\t\t\t<Link to=\"/profile\">\r\n\t\t\t\t\t\t<Icon name=\"arrow-left\" />\r\n\t\t\t\t\t\t<p>交易记录</p>\r\n\t\t\t\t\t</Link>\r\n\t\t\t\t\t<button className=\"faq\">\r\n\t\t\t\t\t\t<Icon name=\"faq\" />\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"transactions-menu\">\r\n\t\t\t\t\t<NavLink to=\"/profile/transactions/deposit\">存款记录</NavLink>\r\n\t\t\t\t\t{/* <NavLink to=\"/profile/transactions/debit\">提款记录</NavLink> */}\r\n\t\t\t\t\t<NavLink to=\"/profile/transactions/transfer\">转账记录</NavLink>\r\n\t\t\t\t\t<NavLink to=\"/profile/transactions/washcode\">反水记录</NavLink>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div className=\"transactions-content\">\r\n\t\t\t\t<div className=\"transactions-range\">\r\n\t\t\t\t\t<UITabs tabs={[\r\n\t\t\t\t\t\t{ index: 'today', name: '今天' },\r\n\t\t\t\t\t\t{ index: 'yesterday', name: '昨天' },\r\n\t\t\t\t\t\t{ index: 'week', name: '本周' },\r\n\t\t\t\t\t\t{ index: 'month', name: '本月' },\r\n\t\t\t\t\t\t{ index: 'custom', name: '自选' },\r\n\t\t\t\t\t]} tab={range} onSet={setRangeHandle} />\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"transactions-list\">\r\n\t\t\t\t{transactionsFiltered.map((transaction, i) => \r\n\t\t\t\t\t<Transaction type={type} key={i} transaction={transaction} />\r\n\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div className={cx('transactions-overlay', { shown: overlayShown })}>\r\n\t\t\t\t<div className=\"transactions-overlay--inner\">\r\n\t\t\t\t\t<div className=\"transactions-overlay--wrap\">\r\n\t\t\t\t\t\t<div className=\"custom-range-form\">\r\n\t\t\t\t\t\t\t<h2>选择时间</h2>\r\n\t\t\t\t\t\t\t<div className=\"form-wrap\">\r\n\t\t\t\t\t\t\t\t<div className=\"field\">\r\n\t\t\t\t\t\t\t\t\t<label>开始日期</label>\r\n\t\t\t\t\t\t\t\t\t<DatePickerWrap type=\"from\" header=\"选择时间\" />\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div className=\"field\">\r\n\t\t\t\t\t\t\t\t\t<label>结束日期</label>\r\n\t\t\t\t\t\t\t\t\t<DatePickerWrap type=\"to\" min={customRange.from} header=\"选择结束时间\" />\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div className=\"form-buttons\">\r\n\t\t\t\t\t\t\t\t<button className=\"cancel\" onClick={e => setOverlay(false)}>取消</button>\r\n\t\t\t\t\t\t\t\t<button className=\"update\" onClick={e => applyCustomRange()}>确认</button>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n\r\n}\r\n\r\nexport default Transactions;\r\n"]},"metadata":{},"sourceType":"module"}