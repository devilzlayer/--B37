{"ast":null,"code":"import _slicedToArray from\"/Users/cramj/Documents/New PWA/ubet-project (1)/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,useContext}from\"react\";import ReactCrop from\"react-image-crop\";import{map}from'lodash';import{avatarClass}from'./options';import Upload from'./upload';import{User,Transaction}from\"../../service\";import{getAuthKey}from'../../util';// CSS NAV\nvar Avatar=function Avatar(props){var show=props.show,onHide=props.onHide,Refresh=props.Refresh;var _useContext=useContext(User.Context),setUserAuthFN=_useContext.setUserAuthFN,userAuth=_useContext.userAuth;var userData=User.read();var _useState=useState(null),_useState2=_slicedToArray(_useState,2),activeImg=_useState2[0],setActiveImg=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),imageSource=_useState4[0],setImageSource=_useState4[1];useEffect(function(){window.addEventListener(\"keydown\",function(event){if(event.keyCode===27){setImageSource(null);onHide();}});},[]);var onUpload=function onUpload(obj,custom){var data=new FormData();data.append(\"file\",obj,\"sam.jpg\");data.append(\"username\",userData.username);data.append(\"account\",userData.account);data.append(\"password\",userData.password);data.append(\"auth\",getAuthKey());data.append(\"type\",\"upload_pictures\");var res=Transaction.read({body:data,type:\"upload_pictures\"});res.promise.then(function(r){console.log(\"Upload sucessful\",r);Refresh();if(custom){setImageSource(null);}},function(e){console.log(\"Upload failed\",e);});};var toDataURL=function toDataURL(url,callback){var xhr=new XMLHttpRequest();xhr.onload=function(){callback(xhr.response);};xhr.open(\"GET\",url);xhr.responseType=\"blob\";xhr.send();};var onSetAvatar=function onSetAvatar(obj,i){setActiveImg(i);toDataURL(obj,function(newUrl){onUpload(newUrl);});};var onSetCustomAvtr=function onSetCustomAvtr(obj){onUpload(obj,true);};var onSelectFile=function onSelectFile(e){if(e.target.files&&e.target.files.length>0){if(e.target.files[0]>200000){console.warn(\"File is too big!\");}else{var fileReader=new FileReader();fileReader.onloadend=function(){setImageSource(fileReader.result);};fileReader.readAsDataURL(e.target.files[0]);}}};if(show){return/*#__PURE__*/React.createElement(\"div\",{className:\"nav-avatar-wrap-desktop\"},/*#__PURE__*/React.createElement(\"div\",{className:\"nav-avatar-content\"},/*#__PURE__*/React.createElement(\"div\",{className:\"nav-avatar-item-wrap\"},avatarClass&&map(avatarClass,function(obj,i){return/*#__PURE__*/React.createElement(\"div\",{key:i,className:\"nav-avatar-items\",style:{backgroundImage:\"url(\".concat(obj.url,\")\")},onClick:function onClick(){return onSetAvatar(obj.url,i);}},/*#__PURE__*/React.createElement(\"i\",{className:\"\".concat(activeImg===i?'show':'')}));}),/*#__PURE__*/React.createElement(\"label\",{className:\"nav-avatar-items upload\"},/*#__PURE__*/React.createElement(\"input\",{type:\"file\",onChange:onSelectFile})))),/*#__PURE__*/React.createElement(\"div\",{className:\"nav-avatar-overlay\",onClick:onHide}),/*#__PURE__*/React.createElement(Upload,{src:imageSource,onHide:function onHide(){return setImageSource(null);},onSendBack:onSetCustomAvtr}));}return null;};export default Avatar;","map":{"version":3,"sources":["/Users/cramj/Documents/New PWA/ubet-project (1)/src/component/Avatar/index.js"],"names":["React","useState","useEffect","useContext","ReactCrop","map","avatarClass","Upload","User","Transaction","getAuthKey","Avatar","props","show","onHide","Refresh","Context","setUserAuthFN","userAuth","userData","read","activeImg","setActiveImg","imageSource","setImageSource","window","addEventListener","event","keyCode","onUpload","obj","custom","data","FormData","append","username","account","password","res","body","type","promise","then","r","console","log","e","toDataURL","url","callback","xhr","XMLHttpRequest","onload","response","open","responseType","send","onSetAvatar","i","newUrl","onSetCustomAvtr","onSelectFile","target","files","length","warn","fileReader","FileReader","onloadend","result","readAsDataURL","backgroundImage"],"mappings":"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","sourcesContent":["import React , { useState , useEffect , useContext}  from \"react\";\r\nimport ReactCrop from \"react-image-crop\";\r\nimport { map} from 'lodash'\r\nimport { avatarClass } from './options'\r\nimport Upload from './upload'\r\nimport { User , Transaction} from \"../../service\";\r\nimport { getAuthKey } from '../../util';\r\n\r\n// CSS NAV\r\nconst Avatar = (props) =>{   \r\n    const { show , onHide , Refresh } = props\r\n    const { setUserAuthFN ,userAuth } = useContext(User.Context);\r\n\r\n    const userData = User.read();\r\n\r\n    const [ activeImg , setActiveImg ] = useState(null)\r\n    const [ imageSource, setImageSource] = useState(null);\r\n\r\n    useEffect(()=>{\r\n        window.addEventListener(\"keydown\", (event) =>{\r\n            if(event.keyCode === 27) {\r\n                setImageSource(null)\r\n                onHide()\r\n            }\r\n        });\r\n    },[])\r\n\r\n    const onUpload = (obj , custom) => {\r\n\r\n        const data = new FormData();\r\n        data.append(\"file\", obj, \"sam.jpg\");\r\n        data.append(\"username\", userData.username);\r\n        data.append(\"account\", userData.account);\r\n        data.append(\"password\", userData.password);\r\n        data.append(\"auth\", getAuthKey());\r\n        data.append(\"type\", \"upload_pictures\");\r\n        const res = Transaction.read({\r\n            body: data,\r\n            type: \"upload_pictures\",\r\n        });\r\n\r\n        res.promise.then((r) => {\r\n            console.log(\"Upload sucessful\", r);\r\n            Refresh()\r\n            if(custom){\r\n                setImageSource(null)\r\n            }\r\n            \r\n        },(e) => {\r\n            console.log(\"Upload failed\", e);\r\n        });\r\n    }\r\n\r\n    const toDataURL = (url, callback) => {\r\n        const xhr   = new XMLHttpRequest();\r\n        xhr.onload  = function () {\r\n            callback(xhr.response);\r\n        };\r\n        xhr.open(\"GET\", url);\r\n        xhr.responseType = \"blob\";\r\n        xhr.send();\r\n    }\r\n\r\n    const onSetAvatar = (obj , i) =>{\r\n        setActiveImg(i)\r\n        toDataURL(obj , newUrl =>{\r\n            onUpload(newUrl)\r\n        })\r\n    }\r\n\r\n\r\n    const onSetCustomAvtr = (obj) =>{\r\n        onUpload(obj , true)\r\n    }\r\n\r\n    const onSelectFile = e => {\r\n        if (e.target.files && e.target.files.length > 0) {\r\n            if (e.target.files[0] > 200000) {\r\n                console.warn(\"File is too big!\");\r\n            } else {\r\n                const fileReader = new FileReader();\r\n                fileReader.onloadend = () => {\r\n                  setImageSource(fileReader.result);\r\n                };\r\n                fileReader.readAsDataURL(e.target.files[0]);\r\n            }\r\n        }\r\n    };\r\n\r\n    if(show){\r\n        return  <div className=\"nav-avatar-wrap-desktop\" >\r\n                    <div className=\"nav-avatar-content\">\r\n                    <div className=\"nav-avatar-item-wrap\">\r\n                        {\r\n                            avatarClass && map(avatarClass , (obj,i) =>{\r\n                                return  <div key={i} className=\"nav-avatar-items\" style={{ backgroundImage: `url(${obj.url})`}} onClick={() => onSetAvatar(obj.url , i)}>\r\n                                            <i className={`${activeImg === i ? 'show' : ''}`}/>\r\n                                        </div>\r\n                            })\r\n                        }\r\n                        <label  className=\"nav-avatar-items upload\">\r\n                            <input type=\"file\"  onChange={onSelectFile}/>\r\n                        </label>\r\n                    </div>\r\n                    </div>\r\n                    <div className=\"nav-avatar-overlay\" onClick={onHide} />\r\n                    <Upload src={imageSource}  onHide={() => setImageSource(null)} onSendBack={onSetCustomAvtr}/>\r\n\r\n                </div>\r\n    }\r\n    return null\r\n    \r\n\r\n}\r\n\r\nexport default Avatar"]},"metadata":{},"sourceType":"module"}