{"ast":null,"code":"import _objectSpread from\"/Users/cramj/Documents/New PWA/GIT/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/cramj/Documents/New PWA/GIT/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,useContext}from\"react\";import{mobileModel}from\"react-device-detect\";import{useHistory}from\"react-router-dom\";import{Wrap,Service}from\"../\";import{FormField}from\"../../../../component\";var Email=function Email(){var history=useHistory();var _useContext=useContext(Service.User.Context),data=_useContext.userAuth.data,setUserAuthFN=_useContext.setUserAuthFN;var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),formemail=_useState2[0],setFormEmail=_useState2[1];var form={realname:data.realName,birthday:data.birthday,phone:data.telephone,qq:data.qq,wechat:data.wechat||\"\",device:mobileModel,//\"Huawei Mate 20 Pro\",\nupdates:[{text:\"4.14.116\"},{text:\"Thu Apr 30 18:27:58 CSTt 2020\"}]};var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),active=_useState4[0],setActive=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),disabled=_useState6[0],setDisabled=_useState6[1];useEffect(function(){function validateEmail(email){var re=/^(([^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;return re.test(email);}if(formemail!==\"\"&&validateEmail(formemail))setActive(true);else setActive(false);},[formemail]);var onChange=function onChange(e){var emailinput=e.target.value;setFormEmail(emailinput);};var update=function update(){console.info(\"You're updating account email:\",formemail);Service.User.update(_objectSpread(_objectSpread(_objectSpread({},form),Service.User.read()),{},{email:formemail})).promise.then(function(r){console.info(\"✅ You have successfully updated account email:\",r.info);setActive(false);setDisabled(true);Service.User.session(_objectSpread({},Service.User.read())).promise.then(function(r){return setUserAuthFN(1,r.info);});},function(e){console.warn(\"Unable to update account email:\",e);});};return/*#__PURE__*/React.createElement(Wrap,{className:\"profile-general profile-email\",name:\"\\u90AE\\u7BB1\\u5730\\u5740\",sublevel:[true,function(){return history.goBack();}]},disabled&&/*#__PURE__*/React.createElement(\"span\",{className:\"profile-valid\"}),/*#__PURE__*/React.createElement(FormField,{field:{label:\"邮箱地址\"},input:{id:\"email\",name:\"email\",type:\"text\",placeholder:\"请输入绑定的邮箱地址\",onChange:onChange}}),/*#__PURE__*/React.createElement(\"div\",{className:\"submit\"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-button \".concat(active&&!disabled&&\"form-button-active\"),onClick:active&&!disabled?update:null},/*#__PURE__*/React.createElement(\"span\",null,\"\\u63D0\\u4EA4\"))));};export default Email;","map":{"version":3,"sources":["/Users/cramj/Documents/New PWA/GIT/src/pwa/view/profile/personal/Email.js"],"names":["React","useState","useEffect","useContext","mobileModel","useHistory","Wrap","Service","FormField","Email","history","User","Context","data","userAuth","setUserAuthFN","formemail","setFormEmail","form","realname","realName","birthday","phone","telephone","qq","wechat","device","updates","text","active","setActive","disabled","setDisabled","validateEmail","email","re","test","onChange","e","emailinput","target","value","update","console","info","read","promise","then","r","session","warn","goBack","label","id","name","type","placeholder"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useContext } from \"react\";\r\nimport { mobileModel } from \"react-device-detect\";\r\nimport { useHistory } from \"react-router-dom\";\r\n\r\nimport { Wrap, Service } from \"../\";\r\nimport { FormField } from \"../../../../component\";\r\n\r\nconst Email = () => {\r\n  const history = useHistory();\r\n\r\n  const {\r\n    userAuth: { data },\r\n    setUserAuthFN,\r\n  } = useContext(Service.User.Context);\r\n\r\n  const [formemail, setFormEmail] = useState(\"\");\r\n  const form = {\r\n    realname: data.realName,\r\n    birthday: data.birthday,\r\n    phone: data.telephone,\r\n    qq: data.qq,\r\n    wechat: data.wechat || \"\",\r\n    device: mobileModel, //\"Huawei Mate 20 Pro\",\r\n    updates: [{ text: \"4.14.116\" }, { text: \"Thu Apr 30 18:27:58 CSTt 2020\" }],\r\n  };\r\n\r\n  const [active, setActive] = useState(false);\r\n  const [disabled, setDisabled] = useState(false);\r\n\r\n  useEffect(() => {\r\n    function validateEmail(email) {\r\n      const re = /^(([^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n      return re.test(email);\r\n    }\r\n\r\n    if (formemail !== \"\" && validateEmail(formemail)) setActive(true);\r\n    else setActive(false);\r\n  }, [formemail]);\r\n\r\n  const onChange = (e) => {\r\n    const emailinput = e.target.value;\r\n\r\n    setFormEmail(emailinput);\r\n  };\r\n\r\n  const update = () => {\r\n    console.info(\"You're updating account email:\", formemail);\r\n\r\n    Service.User.update({\r\n      ...form,\r\n      ...Service.User.read(),\r\n      email: formemail,\r\n    }).promise.then(\r\n      (r) => {\r\n        console.info(\"✅ You have successfully updated account email:\", r.info);\r\n        setActive(false);\r\n        setDisabled(true);\r\n\r\n        Service.User.session({\r\n          ...Service.User.read(),\r\n        }).promise.then((r) => setUserAuthFN(1, r.info));\r\n      },\r\n      (e) => {\r\n        console.warn(\"Unable to update account email:\", e);\r\n      }\r\n    );\r\n  };\r\n\r\n  return (\r\n    <Wrap\r\n      className=\"profile-general profile-email\"\r\n      name=\"邮箱地址\"\r\n      sublevel={[true, () => history.goBack()]}\r\n    >\r\n      {disabled && <span className=\"profile-valid\" />}\r\n      <FormField\r\n        field={{ label: \"邮箱地址\" }}\r\n        input={{\r\n          id: \"email\",\r\n          name: \"email\",\r\n          type: \"text\",\r\n          placeholder: \"请输入绑定的邮箱地址\",\r\n          onChange,\r\n        }}\r\n      />\r\n      <div className=\"submit\">\r\n        <div\r\n          className={`form-button ${\r\n            active && !disabled && \"form-button-active\"\r\n          }`}\r\n          onClick={active && !disabled ? update : null}\r\n        >\r\n          <span>提交</span>\r\n        </div>\r\n      </div>\r\n    </Wrap>\r\n  );\r\n};\r\n\r\nexport default Email;\r\n"]},"metadata":{},"sourceType":"module"}