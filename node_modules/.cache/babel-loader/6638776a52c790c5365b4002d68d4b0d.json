{"ast":null,"code":"var _jsxFileName = \"/Users/cramj/Documents/New PWA/ubet-project (1)/src/view/profile/Withdrawal.js\";\nimport React, { useEffect, useState, useMemo, useContext } from \"react\";\nimport { map, filter, head, find, reverse, isNumber, toInteger } from \"lodash\";\nimport * as moment from \"moment\";\nimport BigNumber from \"bignumber.js\";\nimport { Service } from \"./\";\nimport { toDate } from \"../../util\";\nimport \"../../assets/scss/profile/Withdrawal.scss\";\nimport CardWrap from \"./withdrawal/card\";\nimport HistoryItem from \"./withdrawal/historyItem\";\nimport Wrap from \"./Wrap\";\n\nconst Withdrawal = () => {\n  const {\n    setUserAuthFN,\n    userAuth\n  } = useContext(Service.User.Context);\n  const [loadmore, setLoadMore] = useState(null);\n  const [key, setKey] = useState(null);\n  const [userData, setUserData] = useState({});\n  const [cards, setCards] = useState(null);\n  const [range, setRange] = useState(\"today\");\n  const [balancesRaw, setBalancesRaw] = useState([]);\n  const [items, setItems] = useState({\n    status: 0,\n    list: []\n  });\n  const [customRange, setCustomRange] = useState({\n    from: moment().subtract(30, \"days\").toDate(),\n    to: moment().toDate()\n  });\n  const [form, setForm] = useState({\n    debit_bank: \"\",\n    amount: \"\"\n  });\n  const [refresh, setFresh] = useState(false);\n  const [cardPicker, toggleCardPicker] = useState(false);\n  const [load, setLoad] = useState(false);\n  const [showBank, setShowBank] = useState(null);\n  useEffect(() => {\n    Service.Game.balances({ ...Service.User.read()\n    }).then(balances => {\n      // console.log(balances)\n      setBalancesRaw(balances.filter(b => !b.error));\n    });\n    const req = Service.Card.read({ ...Service.User.read()\n    });\n    req.promise.then(r => {\n      const newItems = reverse(r.info);\n      const debBnk = head(newItems);\n\n      if (debBnk) {\n        setForm(f => ({ ...f,\n          debit_bank: debBnk.debit_bank\n        }));\n        setCards(newItems);\n        setFresh(false);\n      }\n    }, e => {});\n  }, [refresh]);\n  useEffect(() => {\n    if (userAuth.data) {\n      setUserData(userAuth.data);\n    }\n\n    const fetch = () => {\n      const response = Service.Transaction.read({ ...Service.User.read(),\n        record_type: \"debit\"\n      });\n      response.promise.then(result => {\n        // console.log(result);\n        if (result.status === 1) {\n          // setItems(result.info);\n          setItems({\n            status: 1,\n            list: result.info.map(t => ({ ...t,\n              ts: toDate(t.requestTime, true)\n            }))\n          });\n          setLoad(false);\n        }\n      }, e => {\n        console.log(\"Unable to response:\", e);\n      });\n    };\n\n    fetch();\n  }, [load]);\n\n  const __withdraws = useMemo(() => {\n    const _rangeMap = {\n      today: () => {\n        const today = moment();\n        return [today.startOf(\"day\").unix(), today.endOf(\"day\").unix()];\n      },\n      yesterday: () => {\n        const yesterday = moment().subtract(1, \"days\");\n        return [yesterday.startOf(\"day\").unix(), yesterday.endOf(\"day\").unix()];\n      },\n      week: () => {\n        return [moment().subtract(1, \"weeks\").startOf(\"day\").unix(), moment().endOf(\"day\").unix()];\n      },\n      month: () => {\n        return [moment().subtract(30, \"days\").startOf(\"day\").unix(), moment().endOf(\"day\").unix()];\n      },\n      custom: () => {\n        let {\n          from,\n          to\n        } = customRange;\n        return [moment(from).startOf(\"day\").unix(), moment(to).endOf(\"day\").unix()];\n      }\n    };\n\n    const [from, to] = _rangeMap[range](); // return withdraws.list.filter((t) => t.ts >= from && t.ts < to);\n\n\n    return filter(items.list, t => t.ts >= from && t.ts < to);\n  }, [items.list, customRange, range]);\n\n  const onCancel = async w => {\n    // console.log(w);\n    // const r = await Service.User.withdrawCancel({ id: w.id }).promise;\n    const response = await Service.User.withdrawCancel({\n      id: w.id\n    }).promise; // console.log(response);\n\n    if (response.status === 1) {\n      setUserAuthFN(userAuth.status, userAuth.data, {\n        text: \"系统提示\",\n        message: response.info\n      });\n      setLoad(true);\n    }\n  };\n\n  const onSetKey = value => {\n    setKey(null);\n    if (key !== value) setKey(value);\n  };\n\n  const onMax = () => {\n    setForm({ ...form,\n      amount: Math.floor(userAuth.data.balance)\n    });\n  };\n\n  const onHideBank = () => {\n    setShowBank(null);\n    setFresh(true);\n  };\n\n  const onTransfer = () => {\n    const {\n      debit_bank,\n      amount\n    } = form;\n\n    if (!debit_bank) {\n      setUserAuthFN(userAuth.status, userAuth.data, {\n        text: \"系统提示\",\n        message: \"必须选择一张银行卡\"\n      });\n      return false;\n    }\n\n    if (!amount) {\n      setUserAuthFN(userAuth.status, userAuth.data, {\n        text: \"系统提示\",\n        message: \"取款金额不能为空\"\n      });\n      return false;\n    }\n\n    if (amount < 100) {\n      setUserAuthFN(userAuth.status, userAuth.data, {\n        text: \"系统提示\",\n        message: \"取款金额最低100元\"\n      });\n      return false;\n    }\n\n    const selectedBnk = find(cards, obj => obj.debit_bank == debit_bank);\n    const _form = { ...form,\n      debit_bank: selectedBnk.id\n    };\n    Service.User.withdraw({ ...Service.User.read(),\n      ..._form\n    }).promise.then(r => {\n      console.log(`You've successfully withdrawn:`, r);\n      setUserAuthFN(userAuth.status, userAuth.data, {\n        text: \"系统提示\",\n        message: r.info\n      });\n      setLoad(true);\n    }, e => {\n      console.warn(\"Unable to withdraw:\", e);\n      setUserAuthFN(userAuth.status, userAuth.data, {\n        text: \"系统提示\",\n        message: e\n      });\n    });\n  };\n\n  const wallet = async e => {\n    Service.Game.transferToWallet().promise.then(r => {\n      Service.User.session({ ...Service.User.read()\n      }).promise.then(r => {\n        setUserAuthFN(1, r.info, {\n          text: \"转账成功\",\n          success: true\n        });\n        setLoad(true);\n        setFresh(true);\n      });\n    }, e => {\n      console.warn(e);\n      setUserAuthFN(userAuth.status, userAuth.data, {\n        text: \"系统提示\",\n        message: e\n      });\n    });\n  };\n\n  const onlyNumbers = e => {\n    const {\n      name,\n      value\n    } = e.currentTarget;\n    let regexp = /^[0-9\\b]+$/;\n\n    if (!value || regexp.test(value)) {\n      setForm(f => ({ ...f,\n        [name]: value\n      }));\n    }\n  };\n\n  const onTransferPerGame = obj => {\n    const _from = {\n      id: 0,\n      name: 'wallet'\n    };\n    const _to = obj; // console.log(_from , _to) \n    // return false\n\n    console.info(`You are transferring ${Math.floor(userData.balance)} ¥ from ${_from.name} to ${_to.game.name}`);\n    Service.Game.transfer({ ...Service.User.read(),\n      amount: Math.floor(userData.balance),\n      from: _from.id,\n      to: _to.game.id\n    }).then(r => {\n      console.info(`You have successfully transferred ${Math.floor(userData.balance)} ¥ from ${_from.name} to ${_to.game.name}: ${r.info}`);\n      Service.User.session({ ...Service.User.read()\n      }).promise.then(r => {\n        setUserAuthFN(1, r.info, {\n          text: \"转账成功\",\n          success: true\n        });\n        setLoad(true);\n        setFresh(true);\n      });\n    }, e => {\n      // console.log(e);\n      setUserAuthFN(userAuth.status, userAuth.data, {\n        text: \"系统提示\",\n        message: e\n      });\n    });\n  }; // console.log(items.list)\n\n\n  return /*#__PURE__*/React.createElement(Wrap, {\n    className: \"profile-withdrawal-desktop\",\n    title: \"提款\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 322,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"profile-section section-box\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 323,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"profile-section-title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 324,\n      columnNumber: 9\n    }\n  }, \"\\u4E2D\\u5FC3\\u94B1\\u5305 :\", /*#__PURE__*/React.createElement(\"span\", {\n    className: \"value\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 325,\n      columnNumber: 17\n    }\n  }, \" \\xA5\", userData.balance), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"one-transfer\",\n    onClick: wallet,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 326,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 327,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"i\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 328,\n      columnNumber: 15\n    }\n  }), \"\\u4E00\\u952E\\u56DE\\u6536\"))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"withdral-boxes\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 334,\n      columnNumber: 9\n    }\n  }, balancesRaw && map(balancesRaw, (obj, i) => {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      key: i,\n      className: \"withdral-boxes-item\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 338,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"withdral-boxes-title\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 339,\n        columnNumber: 19\n      }\n    }, obj.game.name), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"withdral-boxes-value\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 340,\n        columnNumber: 19\n      }\n    }, BigNumber(obj.balance).toFormat(2)), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"withdral-boxes-button\",\n      onClick: () => onTransferPerGame(obj),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 343,\n        columnNumber: 19\n      }\n    }, \"\\u4E00\\u952E\\u8F6C\\u5165\"));\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"withdrawal-boxes-loadmore\",\n    onClick: () => setLoadMore(!loadmore),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 348,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    className: loadmore ? 'show' : '',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 349,\n      columnNumber: 11\n    }\n  }, \"\\u663E\\u793A\\u6240\\u6709\\u573A\\u9986 \"))), /*#__PURE__*/React.createElement(\"div\", {\n    className: `profile-section section-box relative ${showBank ? \"h727\" : \"\"}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 355,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"profile-section-relative\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 360,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"profile-section-subtitle\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 361,\n      columnNumber: 11\n    }\n  }, \"\\u9009\\u62E9\\u94F6\\u884C\\u5361\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"withdrawal-form-section\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 363,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"withdrawal-form-group transfer\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 364,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"input\",\n    onClick: () => toggleCardPicker(!cardPicker),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 365,\n      columnNumber: 15\n    }\n  }, form.debit_bank, /*#__PURE__*/React.createElement(\"i\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 370,\n      columnNumber: 17\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: `card-toggle ${cardPicker ? \"active\" : \"\"}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 372,\n      columnNumber: 15\n    }\n  }, cards && map(cards, (obj, i) => {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      key: i,\n      className: `card-toggle-item  ${form.debit_bank === obj.debit_bank ? \"active\" : \"\"} `,\n      onClick: () => [setForm({ ...form,\n        debit_bank: obj.debit_bank\n      }), toggleCardPicker(false)],\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 376,\n        columnNumber: 23\n      }\n    }, obj.debit_bank);\n  })), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: onTransfer,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 392,\n      columnNumber: 15\n    }\n  }, \"\\u7ACB\\u5373\\u63D0\\u6B3E\")), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"withdrawal-form-group max\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 394,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 395,\n      columnNumber: 15\n    }\n  }, \"\\uFFE5\"), /*#__PURE__*/React.createElement(\"input\", {\n    value: form.amount,\n    placeholder: \"\\u91D1\\u989D\",\n    name: \"amount\",\n    pattern: \"^-?[0-9]\\\\d*\\\\.?\\\\d*$\",\n    onChange: e => onlyNumbers(e) // onKeyDown={(e) => onlyNumbers(e)}\n    ,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 396,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: () => onMax(),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 404,\n      columnNumber: 15\n    }\n  }, \"\\u6700\\u5927\\u91D1\\u989D\"))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"withdrawal-form-section-button\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 408,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    className: \"new-button-card\",\n    onClick: () => setShowBank(\"new\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 409,\n      columnNumber: 13\n    }\n  }, \"\\u65B0\\u589E\\u94F6\\u884C\\u5361\"), /*#__PURE__*/React.createElement(\"button\", {\n    className: \"untie-button-card\",\n    onClick: () => setShowBank(\"del\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 415,\n      columnNumber: 13\n    }\n  }, \"\\u89E3\\u7ED1\\u94F6\\u884C\\u5361\"))), /*#__PURE__*/React.createElement(CardWrap, {\n    show: showBank,\n    onHide: onHideBank,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 424,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"withdrawal-history-card-head\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 429,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"withdrawal-history-card-title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 430,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 431,\n      columnNumber: 11\n    }\n  }, \"\\u63D0\\u6B3E\\u8BB0\\u5F55\"), /*#__PURE__*/React.createElement(\"i\", {\n    className: load ? \"reload\" : \"\",\n    onClick: () => setLoad(true),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 432,\n      columnNumber: 11\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"withdrawal-history-card-body\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 434,\n      columnNumber: 9\n    }\n  }, items.list ? map(items.list, (obj, i) => {\n    return /*#__PURE__*/React.createElement(HistoryItem, {\n      obj: obj,\n      key: i,\n      index: i,\n      label: obj.cardNumber,\n      time: obj.requestTime,\n      value: obj.amount,\n      status: obj.status,\n      onCancel: val => onCancel(val),\n      onSetKey: val => onSetKey(val),\n      setKey: key,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 438,\n        columnNumber: 17\n      }\n    });\n  }) : /*#__PURE__*/React.createElement(\"div\", {\n    className: \"no-transactions\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 453,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"image-box\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 454,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 455,\n      columnNumber: 15\n    }\n  }, \"\\u6682\\u65E0\\u8BB0\\u5F55\")))));\n};\n\nexport default Withdrawal;","map":{"version":3,"sources":["/Users/cramj/Documents/New PWA/ubet-project (1)/src/view/profile/Withdrawal.js"],"names":["React","useEffect","useState","useMemo","useContext","map","filter","head","find","reverse","isNumber","toInteger","moment","BigNumber","Service","toDate","CardWrap","HistoryItem","Wrap","Withdrawal","setUserAuthFN","userAuth","User","Context","loadmore","setLoadMore","key","setKey","userData","setUserData","cards","setCards","range","setRange","balancesRaw","setBalancesRaw","items","setItems","status","list","customRange","setCustomRange","from","subtract","to","form","setForm","debit_bank","amount","refresh","setFresh","cardPicker","toggleCardPicker","load","setLoad","showBank","setShowBank","Game","balances","read","then","b","error","req","Card","promise","r","newItems","info","debBnk","f","e","data","fetch","response","Transaction","record_type","result","t","ts","requestTime","console","log","__withdraws","_rangeMap","today","startOf","unix","endOf","yesterday","week","month","custom","onCancel","w","withdrawCancel","id","text","message","onSetKey","value","onMax","Math","floor","balance","onHideBank","onTransfer","selectedBnk","obj","_form","withdraw","warn","wallet","transferToWallet","session","success","onlyNumbers","name","currentTarget","regexp","test","onTransferPerGame","_from","_to","game","transfer","i","toFormat","cardNumber","val"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useMemo, useContext } from \"react\";\r\nimport { map, filter, head, find, reverse  , isNumber , toInteger} from \"lodash\";\r\nimport * as moment from \"moment\";\r\nimport BigNumber from \"bignumber.js\";\r\n\r\nimport { Service } from \"./\";\r\nimport { toDate } from \"../../util\";\r\n\r\nimport \"../../assets/scss/profile/Withdrawal.scss\";\r\n\r\nimport CardWrap from \"./withdrawal/card\";\r\nimport HistoryItem from \"./withdrawal/historyItem\";\r\n\r\nimport Wrap from \"./Wrap\";\r\n\r\nconst Withdrawal = () => {\r\n  const { setUserAuthFN, userAuth } = useContext(Service.User.Context);\r\n\r\n  const [loadmore, setLoadMore] = useState(null);\r\n  const [key, setKey] = useState(null);\r\n  const [userData, setUserData] = useState({});\r\n  const [cards, setCards] = useState(null);\r\n  const [range, setRange] = useState(\"today\");\r\n\r\n  const [balancesRaw, setBalancesRaw] = useState([]);\r\n  const [items, setItems] = useState({\r\n    status: 0,\r\n    list: [],\r\n  });\r\n  const [customRange, setCustomRange] = useState({\r\n    from: moment().subtract(30, \"days\").toDate(),\r\n    to: moment().toDate(),\r\n  });\r\n  const [form, setForm] = useState({\r\n    debit_bank: \"\",\r\n    amount: \"\",\r\n  });\r\n\r\n  const [refresh, setFresh] = useState(false);\r\n  const [cardPicker, toggleCardPicker] = useState(false);\r\n  const [load, setLoad] = useState(false);\r\n  const [showBank, setShowBank] = useState(null);\r\n\r\n\r\n  useEffect(() => {\r\n    Service.Game.balances({\r\n      ...Service.User.read(),\r\n    }).then((balances) => {\r\n      // console.log(balances)\r\n      setBalancesRaw(balances.filter((b) => !b.error));\r\n    });\r\n\r\n    const req = Service.Card.read({\r\n      ...Service.User.read(),\r\n    });\r\n\r\n    req.promise.then((r) => {\r\n        const newItems = reverse(r.info);\r\n        const debBnk = head(newItems);\r\n        if (debBnk) {\r\n          setForm((f) => ({\r\n            ...f,\r\n            debit_bank: debBnk.debit_bank,\r\n          }));\r\n          setCards(newItems);\r\n          setFresh(false);\r\n        }\r\n    },(e) => {});\r\n\r\n \r\n\r\n  }, [refresh]);\r\n\r\n  useEffect(() => {\r\n    if (userAuth.data) {\r\n      setUserData(userAuth.data);\r\n    }\r\n\r\n    const fetch = () => {\r\n      const response = Service.Transaction.read({\r\n        ...Service.User.read(),\r\n        record_type: \"debit\",\r\n      });\r\n\r\n      response.promise.then((result) => {\r\n          // console.log(result);\r\n          if (result.status === 1) {\r\n            // setItems(result.info);\r\n            setItems({\r\n              status: 1,\r\n              list: result.info.map((t) => ({\r\n                ...t,\r\n                ts: toDate(t.requestTime, true),\r\n              })),\r\n            });\r\n            setLoad(false);\r\n          }\r\n        },\r\n        (e) => {\r\n          console.log(\"Unable to response:\", e);\r\n        }\r\n      );\r\n    };\r\n    fetch();\r\n  }, [load]);\r\n\r\n  const __withdraws = useMemo(() => {\r\n    const _rangeMap = {\r\n      today: () => {\r\n        const today = moment();\r\n        return [today.startOf(\"day\").unix(), today.endOf(\"day\").unix()];\r\n      },\r\n      yesterday: () => {\r\n        const yesterday = moment().subtract(1, \"days\");\r\n        return [yesterday.startOf(\"day\").unix(), yesterday.endOf(\"day\").unix()];\r\n      },\r\n      week: () => {\r\n        return [\r\n          moment().subtract(1, \"weeks\").startOf(\"day\").unix(),\r\n          moment().endOf(\"day\").unix(),\r\n        ];\r\n      },\r\n      month: () => {\r\n        return [\r\n          moment().subtract(30, \"days\").startOf(\"day\").unix(),\r\n          moment().endOf(\"day\").unix(),\r\n        ];\r\n      },\r\n      custom: () => {\r\n        let { from, to } = customRange;\r\n        return [\r\n          moment(from).startOf(\"day\").unix(),\r\n          moment(to).endOf(\"day\").unix(),\r\n        ];\r\n      },\r\n    };\r\n\r\n    const [from, to] = _rangeMap[range]();\r\n\r\n    // return withdraws.list.filter((t) => t.ts >= from && t.ts < to);\r\n    return filter(items.list, (t) => t.ts >= from && t.ts < to);\r\n  }, [items.list, customRange, range]);\r\n\r\n  const onCancel = async (w) => {\r\n    // console.log(w);\r\n    // const r = await Service.User.withdrawCancel({ id: w.id }).promise;\r\n    const response = await Service.User.withdrawCancel({ id: w.id }).promise;\r\n    // console.log(response);\r\n    if (response.status === 1) {\r\n      setUserAuthFN(userAuth.status, userAuth.data, {\r\n        text: \"系统提示\",\r\n        message: response.info,\r\n      });\r\n      setLoad(true);\r\n    }\r\n  };\r\n\r\n  const onSetKey = (value) => {\r\n    setKey(null);\r\n    if (key !== value) setKey(value);\r\n  };\r\n\r\n  const onMax = () => {\r\n    setForm({\r\n      ...form,\r\n      amount: Math.floor(userAuth.data.balance),\r\n    });\r\n  };\r\n\r\n  const onHideBank = () => {\r\n    setShowBank(null);\r\n    setFresh(true);\r\n  };\r\n\r\n  const onTransfer = () => {\r\n    const { debit_bank, amount } = form;\r\n\r\n    if (!debit_bank) {\r\n      setUserAuthFN(userAuth.status, userAuth.data, {\r\n        text: \"系统提示\",\r\n        message: \"必须选择一张银行卡\",\r\n      });\r\n      return false;\r\n    }\r\n\r\n    if (!amount) {\r\n      setUserAuthFN(userAuth.status, userAuth.data, {\r\n        text: \"系统提示\",\r\n        message: \"取款金额不能为空\",\r\n      });\r\n      return false;\r\n    }\r\n\r\n    if (amount < 100) {\r\n      setUserAuthFN(userAuth.status, userAuth.data, {\r\n        text: \"系统提示\",\r\n        message: \"取款金额最低100元\",\r\n      });\r\n      return false;\r\n    }\r\n\r\n    const selectedBnk = find(cards, (obj) => obj.debit_bank == debit_bank);\r\n\r\n    const _form = {\r\n      ...form,\r\n      debit_bank: selectedBnk.id,\r\n    };\r\n\r\n    Service.User.withdraw({\r\n      ...Service.User.read(),\r\n      ..._form,\r\n    }).promise.then(\r\n      (r) => {\r\n        console.log(`You've successfully withdrawn:`, r);\r\n\r\n        setUserAuthFN(userAuth.status, userAuth.data, {\r\n          text: \"系统提示\",\r\n          message: r.info,\r\n        });\r\n        setLoad(true);\r\n      },\r\n      (e) => {\r\n        console.warn(\"Unable to withdraw:\", e);\r\n        setUserAuthFN(userAuth.status, userAuth.data, {\r\n          text: \"系统提示\",\r\n          message: e,\r\n        });\r\n      }\r\n    );\r\n  };\r\n\r\n  const wallet = async (e) => {\r\n    Service.Game.transferToWallet().promise.then((r) => {\r\n      Service.User.session({\r\n        ...Service.User.read(),\r\n      }).promise.then((r) => {\r\n\r\n        setUserAuthFN(1, r.info, {\r\n          text: \"转账成功\",\r\n          success: true,\r\n        });\r\n        setLoad(true);\r\n        setFresh(true)\r\n\r\n      });\r\n\r\n      },\r\n      (e) => {\r\n        console.warn(e);\r\n        setUserAuthFN(userAuth.status, userAuth.data, {\r\n          text: \"系统提示\",\r\n          message: e,\r\n        });\r\n      }\r\n    );\r\n  };\r\n\r\n\r\n  const onlyNumbers = (e) => {\r\n    const { name , value } = e.currentTarget\r\n    let regexp  = /^[0-9\\b]+$/\r\n    if (!value || regexp.test(value)) {\r\n      setForm((f) => ({\r\n        ...f,\r\n        [name]: value,\r\n      }));\r\n    }\r\n\r\n  };\r\n\r\n\r\n  const onTransferPerGame = (obj) =>{\r\n    const _from = {\r\n      id: 0,\r\n      name: 'wallet'\r\n    }\r\n    const _to = obj\r\n    // console.log(_from , _to) \r\n    // return false\r\n    console.info(\r\n      `You are transferring ${Math.floor(userData.balance)} ¥ from ${_from.name} to ${_to.game.name}`\r\n    );\r\n    Service.Game.transfer({\r\n      ...Service.User.read(),\r\n      amount: Math.floor(userData.balance),\r\n      from: _from.id,\r\n      to: _to.game.id,\r\n    }).then(\r\n      (r) => {\r\n        console.info(\r\n          `You have successfully transferred ${Math.floor(userData.balance)} ¥ from ${_from.name} to ${_to.game.name}: ${r.info}`\r\n        );\r\n        Service.User.session({\r\n          ...Service.User.read(),\r\n        }).promise.then((r) => {\r\n\r\n          setUserAuthFN(1, r.info, {\r\n            text: \"转账成功\",\r\n            success: true,\r\n          });\r\n          setLoad(true);\r\n          setFresh(true)\r\n\r\n        });\r\n\r\n        \r\n      },\r\n      (e) => {\r\n        // console.log(e);\r\n        setUserAuthFN(userAuth.status, userAuth.data, {\r\n          text: \"系统提示\",\r\n          message: e,\r\n        });\r\n    });\r\n\r\n\r\n  }\r\n\r\n  // console.log(items.list)\r\n\r\n  return (\r\n    <Wrap className=\"profile-withdrawal-desktop\" title={\"提款\"}>\r\n      <div className=\"profile-section section-box\">\r\n        <div className=\"profile-section-title\">\r\n          中心钱包 :<span className=\"value\"> ¥{userData.balance}</span>\r\n          <div className=\"one-transfer\" onClick={wallet}>\r\n            <span>\r\n              <i />\r\n              一键回收\r\n            </span>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"withdral-boxes\">\r\n          {balancesRaw &&\r\n            map(balancesRaw, (obj, i) => {\r\n              return (\r\n                <div key={i} className=\"withdral-boxes-item\">\r\n                  <div className=\"withdral-boxes-title\">{obj.game.name}</div>\r\n                  <div className=\"withdral-boxes-value\">\r\n                    {BigNumber(obj.balance).toFormat(2)}\r\n                  </div>\r\n                  <div className=\"withdral-boxes-button\" onClick={()=> onTransferPerGame(obj)} >一键转入</div>\r\n                </div>\r\n              );\r\n            })}\r\n        </div>\r\n        <div className=\"withdrawal-boxes-loadmore\" onClick={() => setLoadMore(!loadmore)}>\r\n          <span className={loadmore ? 'show' : ''}>显示所有场馆 </span>\r\n        </div>\r\n      </div>\r\n\r\n      {/* SECTION */}\r\n\r\n      <div\r\n        className={`profile-section section-box relative ${\r\n          showBank ? \"h727\" : \"\"\r\n        }`}\r\n      >\r\n        <div className=\"profile-section-relative\">\r\n          <div className=\"profile-section-subtitle\">选择银行卡</div>\r\n\r\n          <div className=\"withdrawal-form-section\">\r\n            <div className=\"withdrawal-form-group transfer\">\r\n              <div\r\n                className=\"input\"\r\n                onClick={() => toggleCardPicker(!cardPicker)}\r\n              >\r\n                {form.debit_bank}\r\n                <i />\r\n              </div>\r\n              <div className={`card-toggle ${cardPicker ? \"active\" : \"\"}`}>\r\n                {cards &&\r\n                  map(cards, (obj, i) => {\r\n                    return (\r\n                      <div\r\n                        key={i}\r\n                        className={`card-toggle-item  ${\r\n                          form.debit_bank === obj.debit_bank ? \"active\" : \"\"\r\n                        } `}\r\n                        onClick={() => [\r\n                          setForm({ ...form, debit_bank: obj.debit_bank }),\r\n                          toggleCardPicker(false),\r\n                        ]}\r\n                      >\r\n                        {obj.debit_bank}\r\n                      </div>\r\n                    );\r\n                  })}\r\n              </div>\r\n\r\n              <button onClick={onTransfer}>立即提款</button>\r\n            </div>\r\n            <div className=\"withdrawal-form-group max\">\r\n              <span>￥</span>\r\n              <input\r\n                value={form.amount}\r\n                placeholder=\"金额\"\r\n                name=\"amount\"\r\n                pattern=\"^-?[0-9]\\d*\\.?\\d*$\"\r\n                onChange={(e) =>onlyNumbers(e)}\r\n                // onKeyDown={(e) => onlyNumbers(e)}\r\n              />\r\n              <button onClick={() => onMax()}>最大金额</button>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"withdrawal-form-section-button\">\r\n            <button\r\n              className=\"new-button-card\"\r\n              onClick={() => setShowBank(\"new\")}\r\n            >\r\n              新增银行卡\r\n            </button>\r\n            <button\r\n              className=\"untie-button-card\"\r\n              onClick={() => setShowBank(\"del\")}\r\n            >\r\n              解绑银行卡\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        <CardWrap show={showBank} onHide={onHideBank} />\r\n      </div>\r\n\r\n      {/* SECTION */}\r\n\r\n      <div className=\"withdrawal-history-card-head\">\r\n        <div className=\"withdrawal-history-card-title\">\r\n          <span>提款记录</span>\r\n          <i className={load ? \"reload\" : \"\"} onClick={() => setLoad(true)} />\r\n        </div>\r\n        <div className=\"withdrawal-history-card-body\">\r\n          {items.list  ? (\r\n            map(items.list, (obj, i) => {\r\n              return (\r\n                <HistoryItem\r\n                  obj={obj}\r\n                  key={i}\r\n                  index={i}\r\n                  label={obj.cardNumber}\r\n                  time={obj.requestTime}\r\n                  value={obj.amount}\r\n                  status={obj.status}\r\n                  onCancel={(val) => onCancel(val)}\r\n                  onSetKey={(val) => onSetKey(val)}\r\n                  setKey={key}\r\n                />\r\n              );\r\n            })\r\n          ) : (\r\n            <div className=\"no-transactions\">\r\n              <div className=\"image-box\" />\r\n              <span>暂无记录</span>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </Wrap>\r\n  );\r\n};\r\n\r\nexport default Withdrawal;\r\n"]},"metadata":{},"sourceType":"module"}