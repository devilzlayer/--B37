{"ast":null,"code":"import _slicedToArray from\"/Users/cramj/Documents/New PWA/ubet-project (1)/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,useContext}from'react';import{Redirect,useLocation}from'react-router-dom';import{User}from'../service/';function withAuth(Component,session){return function(props){var _useLocation=useLocation(),pathname=_useLocation.pathname;var _useState=useState(0),_useState2=_slicedToArray(_useState,2),status=_useState2[0],setStatus=_useState2[1];var _useContext=useContext(User.Context),setUserAuthFN=_useContext.setUserAuthFN;var _useState3=useState({}),_useState4=_slicedToArray(_useState3,2),user=_useState4[0],setUser=_useState4[1];useEffect(function(){try{var creds=User.read();if(!creds){setUserAuthFN(-1,null);setStatus(-1);return function(){};}var req=User.session(creds);req.promise.then(function(r){setUser(r.info);setUserAuthFN(1,r.info);setStatus(1);},function(e){setUserAuthFN(-1,{});setStatus(-1);});return function(){return req.cancel();};}catch(e){localStorage.removeItem('user');setUserAuthFN(-1,{});setStatus(-1);}// eslint-disable-next-line\n},[]);if(status===0&&session===1){return null;}if(status===-1&&session===1){return/*#__PURE__*/React.createElement(Redirect,{to:{pathname:'/login',state:{referrer:pathname}}});}return/*#__PURE__*/React.createElement(Component,Object.assign({user:user},props));};}export default withAuth;","map":{"version":3,"sources":["/Users/cramj/Documents/New PWA/ubet-project (1)/src/util/withAuth.js"],"names":["React","useState","useEffect","useContext","Redirect","useLocation","User","withAuth","Component","session","props","pathname","status","setStatus","Context","setUserAuthFN","user","setUser","creds","read","req","promise","then","r","info","e","cancel","localStorage","removeItem","state","referrer"],"mappings":"6JAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,SAA1B,CAAqCC,UAArC,KAAuD,OAAvD,CACA,OAASC,QAAT,CAAmBC,WAAnB,KAAsC,kBAAtC,CAEA,OAASC,IAAT,KAAqB,aAArB,CAEA,QAASC,CAAAA,QAAT,CAAmBC,SAAnB,CAA8BC,OAA9B,CAAuC,CAEtC,MAAO,UAAUC,KAAV,CAAiB,kBAEFL,WAAW,EAFT,CAEfM,QAFe,cAEfA,QAFe,eAIOV,QAAQ,CAAC,CAAD,CAJf,wCAIfW,MAJe,eAIPC,SAJO,+BAMGV,UAAU,CAACG,IAAI,CAACQ,OAAN,CANb,CAMfC,aANe,aAMfA,aANe,gBAOGd,QAAQ,CAAC,EAAD,CAPX,yCAOfe,IAPe,eAOTC,OAPS,eASvBf,SAAS,CAAC,UAAM,CAEf,GAAI,CAEH,GAAMgB,CAAAA,KAAK,CAAGZ,IAAI,CAACa,IAAL,EAAd,CAEA,GAAI,CAACD,KAAL,CAAY,CAEXH,aAAa,CAAC,CAAC,CAAF,CAAK,IAAL,CAAb,CAEAF,SAAS,CAAC,CAAC,CAAF,CAAT,CAEA,MAAO,WAAM,CAAE,CAAf,CAEA,CAED,GAAMO,CAAAA,GAAG,CAAGd,IAAI,CAACG,OAAL,CAAaS,KAAb,CAAZ,CAEAE,GAAG,CAACC,OAAJ,CAAYC,IAAZ,CAAiB,SAAAC,CAAC,CAAI,CAErBN,OAAO,CAACM,CAAC,CAACC,IAAH,CAAP,CAEAT,aAAa,CAAC,CAAD,CAAIQ,CAAC,CAACC,IAAN,CAAb,CAEAX,SAAS,CAAC,CAAD,CAAT,CAEA,CARD,CAQG,SAAAY,CAAC,CAAI,CAEPV,aAAa,CAAC,CAAC,CAAF,CAAK,EAAL,CAAb,CAEAF,SAAS,CAAC,CAAC,CAAF,CAAT,CAEA,CAdD,EAgBA,MAAO,kBAAMO,CAAAA,GAAG,CAACM,MAAJ,EAAN,EAAP,CAEA,CAAC,MAAOD,CAAP,CAAU,CAEXE,YAAY,CAACC,UAAb,CAAwB,MAAxB,EAEAb,aAAa,CAAC,CAAC,CAAF,CAAK,EAAL,CAAb,CAEAF,SAAS,CAAC,CAAC,CAAF,CAAT,CAEA,CAEF;AACC,CA/CQ,CA+CN,EA/CM,CAAT,CAiDA,GAAID,MAAM,GAAK,CAAX,EAAgBH,OAAO,GAAK,CAAhC,CAAmC,CAClC,MAAO,KAAP,CACA,CAED,GAAIG,MAAM,GAAK,CAAC,CAAZ,EAAiBH,OAAO,GAAK,CAAjC,CAAoC,CACnC,mBAAO,oBAAC,QAAD,EAAU,EAAE,CAAE,CACpBE,QAAQ,CAAE,QADU,CAEpBkB,KAAK,CAAE,CACNC,QAAQ,CAAEnB,QADJ,CAFa,CAAd,EAAP,CAMA,CAED,mBAAO,oBAAC,SAAD,gBAAW,IAAI,CAAEK,IAAjB,EAA2BN,KAA3B,EAAP,CAEA,CAzED,CA2EA,CAED,cAAeH,CAAAA,QAAf","sourcesContent":["import React, { useState, useEffect, useContext } from 'react';\r\nimport { Redirect, useLocation } from 'react-router-dom';\r\n\r\nimport { User } from '../service/';\r\n\r\nfunction withAuth (Component, session) {\r\n\r\n\treturn function (props) {\r\n\r\n\t\tconst { pathname } = useLocation();\r\n\r\n\t\tconst [ status, setStatus ] = useState(0);\r\n\r\n\t\tconst { setUserAuthFN } = useContext(User.Context);\r\n\t\tconst [ user, setUser ] = useState({});\r\n\r\n\t\tuseEffect(() => {\r\n\r\n\t\t\ttry {\r\n\r\n\t\t\t\tconst creds = User.read();\r\n\r\n\t\t\t\tif (!creds) {\r\n\r\n\t\t\t\t\tsetUserAuthFN(-1, null);\r\n\r\n\t\t\t\t\tsetStatus(-1);\r\n\r\n\t\t\t\t\treturn () => {}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst req = User.session(creds);\r\n\r\n\t\t\t\treq.promise.then(r => {\r\n\r\n\t\t\t\t\tsetUser(r.info);\r\n\r\n\t\t\t\t\tsetUserAuthFN(1, r.info);\r\n\r\n\t\t\t\t\tsetStatus(1);\r\n\r\n\t\t\t\t}, e => {\r\n\r\n\t\t\t\t\tsetUserAuthFN(-1, {});\r\n\r\n\t\t\t\t\tsetStatus(-1);\r\n\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn () => req.cancel();\r\n\t\t\t\r\n\t\t\t} catch (e) {\r\n\r\n\t\t\t\tlocalStorage.removeItem('user');\r\n\r\n\t\t\t\tsetUserAuthFN(-1, {});\r\n\r\n\t\t\t\tsetStatus(-1);\r\n\r\n\t\t\t}\r\n\r\n\t\t// eslint-disable-next-line\r\n\t\t}, []);\r\n\r\n\t\tif (status === 0 && session === 1) {\r\n\t\t\treturn null\r\n\t\t}\r\n\r\n\t\tif (status === -1 && session === 1) {\r\n\t\t\treturn <Redirect to={{\r\n\t\t\t\tpathname: '/login',\r\n\t\t\t\tstate: {\r\n\t\t\t\t\treferrer: pathname\r\n\t\t\t\t}\r\n\t\t\t}} />\r\n\t\t}\r\n\r\n\t\treturn <Component user={user} {...props} />\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport default withAuth;\r\n"]},"metadata":{},"sourceType":"module"}