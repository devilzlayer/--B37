{"ast":null,"code":"import _defineProperty from\"/Users/cramj/Documents/New PWA/GIT/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/Users/cramj/Documents/New PWA/GIT/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/cramj/Documents/New PWA/GIT/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState,useContext}from\"react\";import Picker from\"react-mobile-picker\";import cx from\"classnames\";import BigNumber from\"bignumber.js\";import{map,findIndex,isNumber,toSafeInteger}from'lodash';import WheelPicker from'react-simple-wheel-picker';import{Wrap}from\"./\";import{Icon}from\"../../../component/\";import{UIAlertSA}from\"../../component/\";import{User,Game}from\"../../../service/\";import{withAuth}from\"../../util\";import Wheel from'./transfer/wheel';var Transfer=function Transfer(){var _useContext=useContext(User.Context),userAuth=_useContext.userAuth,setUserAuthFN=_useContext.setUserAuthFN;var _useState=useState({from:[],to:[]}),_useState2=_slicedToArray(_useState,2),balances=_useState2[0],setBalances=_useState2[1];var _useState3=useState({wallet:[],games:[]}),_useState4=_slicedToArray(_useState3,2),balancesFill=_useState4[0],setBalancesFill=_useState4[1];var _useState5=useState({}),_useState6=_slicedToArray(_useState5,2),message=_useState6[0],setMessage=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),balancesRaw=_useState8[0],setBalancesRaw=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),balanceTransferred=_useState10[0],setBalanceTransferred=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),balanceLoad=_useState12[0],setBalanceLoad=_useState12[1];var _useState13=useState(0),_useState14=_slicedToArray(_useState13,2),balanceUpdateI=_useState14[0],setBalanceUpdateI=_useState14[1];var _useState15=useState({}),_useState16=_slicedToArray(_useState15,2),balancesMap=_useState16[0],setBalancesMap=_useState16[1];var _useState17=useState(null),_useState18=_slicedToArray(_useState17,2),balanceOver=_useState18[0],setBalanceOver=_useState18[1];var _useState19=useState({from:null,to:null,amount:\"\"}),_useState20=_slicedToArray(_useState19,2),balanceForm=_useState20[0],setBalanceForm=_useState20[1];var _useState21=useState(false),_useState22=_slicedToArray(_useState21,2),balanceTime=_useState22[0],setBalanceTime=_useState22[1];useEffect(function(){setBalances({from:[],to:[]});setBalancesMap({});setBalancesFill({wallet:[],games:[]});Game.balances(_objectSpread({},User.read())).then(function(_balances){setBalancesRaw(_balances.filter(function(b){return!b.error;}));// const __balances = _balances.map(b => `${b.game.name}: ${b.balance} ¥`);\n// \t\t\t__balances.unshift(`中央钱包: ${userAuth.data.balance} ¥`);\nvar __balances=_balances.filter(function(b){return!b.error;}).map(function(b){return\"\".concat(b.game.name);});__balances.unshift(\"\\u4E2D\\u5FC3\\u94B1\\u5305\");var _bFillWallet=[\"\\u4E2D\\u5FC3\\u94B1\\u5305\"];var _bFillGames=_balances.filter(function(b){return!b.error;}).map(function(b){return b.game.name;});setBalancesFill({wallet:_bFillWallet,games:_bFillGames});setBalanceForm(function(balanceForm){return _objectSpread(_objectSpread({},balanceForm),{},{from:__balances[0],to:__balances[1]});});setBalances({from:__balances,// to: __balances,\nto:_bFillGames});// console.log(_balances )\n// console.log(__balances )\n// console.log(_bFillGames )\nvar __balancesMap={};_balances.filter(function(b){return!b.error;}).forEach(function(b){__balancesMap[b.game.name]=b;});__balancesMap[\"中心钱包\"]={game:{id:0,name:\"wallet\"},wallet:true,balance:+userAuth.data.balance};setBalancesMap(__balancesMap);});},[balanceUpdateI,userAuth.data.balance]);useEffect(function(){User.session(_objectSpread({},User.read())).promise.then(function(r){return setUserAuthFN(1,r.info);});setBalanceForm(function(bf){return _objectSpread(_objectSpread({},bf),{},{amount:\"\"});});// eslint-disable-next-line\n},[balanceUpdateI]);var AmountVariants=[100,500,1000,2000,5000];// useEffect(() => { \n//     // console.log(balances)\n//     Game.activateListV1({\n//       ...User.read(),\n//     }).promise.then((r) =>{\n//       // console.log(r)\n//     })\n// },[balances])\nvar onSetWheelValSelect=function onSetWheelValSelect(dist){var thisWrap=document.querySelector(\".wheelwrap ul\");// console.log(thisWrap.childNodes)\nvar value;map(thisWrap.childNodes,function(obj){if(obj.ariaSelected==\"true\"){value=obj.ariaLabel;}// console.log( obj.ariaLabel , obj.ariaSelected)\n});// console.log(value)\n// return false;\nif(dist===\"from\"){var _d=balancesMap[value].wallet?\"games\":\"wallet\";setBalances(function(b){return _objectSpread(_objectSpread({},b),{},{to:balancesFill[_d]});});setBalanceForm(function(bf){return _objectSpread(_objectSpread({},bf),{},{to:balancesFill[_d][0]});});}setBalanceForm(function(bf){return _objectSpread(_objectSpread({},bf),{},_defineProperty({},dist,value));});setBalanceOver(null);};var PickerWrap=function PickerWrap(_ref){var dist=_ref.dist;var selectedBal=findIndex(balances[dist],function(obj){return obj===balanceForm[dist];});return/*#__PURE__*/React.createElement(\"div\",{className:\"picker-wrap\"},balances[dist].length&&/*#__PURE__*/React.createElement(Wheel,{options:balances[dist],selected:selectedBal,onChange:function onChange(value){// console.log(value)\nif(dist===\"from\"){var _d=balancesMap[value].wallet?\"games\":\"wallet\";setBalances(function(b){return _objectSpread(_objectSpread({},b),{},{to:balancesFill[_d]});});setBalanceForm(function(bf){return _objectSpread(_objectSpread({},bf),{},{to:balancesFill[_d][0]});});}setBalanceForm(function(bf){return _objectSpread(_objectSpread({},bf),{},_defineProperty({},dist,value));});}}));};var swap=function swap(){var _ref2=[balanceForm.from,balanceForm.to],to=_ref2[0],from=_ref2[1];var _d1=balancesMap[from].wallet?\"games\":\"wallet\";var _d2=balancesMap[to].wallet?\"games\":\"wallet\";setBalances(function(b){return _objectSpread(_objectSpread({},b),{},{to:balancesFill[_d1],from:balancesFill[_d2]});});setBalanceForm(function(bf){return _objectSpread(_objectSpread({},bf),{},{to:to,from:from});});};var setAmount=function setAmount(e){var amount=e.target?e.target.value:e;setBalanceForm(function(form){return _objectSpread(_objectSpread({},form),{},{amount:amount});});};var setMax=function setMax(){var _game=balancesMap[balanceForm.from];var _max=_game.balance;if(_game.wallet){_max=userAuth.data.balance;}setAmount(Math.floor(_max));};var onlyNumbers=function onlyNumbers(e){var value=e.currentTarget.value;var regexp=/^[0-9\\b]+$/;if(!value||regexp.test(value)){setAmount(value);}};var transfer=function transfer(e){if(!balanceForm.amount||isNaN(+balanceForm.amount)){setMessage({title:'系统提示',message:'没有金额'});setBalanceTransferred(true);return void console.warn(\"[transfer] No amount\");}var _getMap=function _getMap(n){return balancesMap[n.split(\": \")[0]]||null;};var _from=_getMap(balanceForm.from);var _to=_getMap(balanceForm.to);if(_from.game.id===_to.game.id){setMessage({title:'系统提示',message:'同一个游戏'});setBalanceTransferred(true);return void console.warn(\"[transfer] Same game\");}if(_from.balance===0){setMessage({title:'系统提示',message:'零余额'});setBalanceTransferred(true);return void console.warn(\"[transfer] Zero balance\");}if(_from.balance<+balanceForm.amount){setMessage({title:'系统提示',message:'余额不足'});setBalanceTransferred(true);return void console.warn(\"[transfer] Not enough game balance\");}console.info(\"You're transfering \".concat(balanceForm.amount,\" \\xA5 from \").concat(_from.game.name,\" to \").concat(_to.game.name));setBalanceLoad(true);Game.transfer(_objectSpread(_objectSpread({},User.read()),{},{amount:+balanceForm.amount,from:_from.game.id,to:_to.game.id})).then(function(r){console.info(\"You have successfully transferred \".concat(balanceForm.amount,\" \\xA5 from \").concat(_from.game.name,\" to \").concat(_to.game.name,\": \").concat(r.info));setMessage({title:'转账成功',valid:true});setBalanceLoad(false);setBalanceTransferred(true);},function(e){console.error(e);setMessage({title:'系统提示',message:e});setBalanceTransferred(true);setBalanceLoad(false);});};var wallet=function wallet(_e){setBalanceTime(true);setBalanceLoad(true);Game.transferToWallet().promise.then(function(r){setBalanceLoad(false);setBalanceTransferred(true);},function(e){console.warn(e);setBalanceLoad(false);});setTimeout(function(){setBalanceTime(false);},10000);};return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Wrap,{className:\"profile-transfer\",name:\"\\u8F6C\\u8D26\",isLoading:!balancesRaw.length||balanceLoad},/*#__PURE__*/React.createElement(\"div\",{className:\"fields\"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-field user-balance\"},/*#__PURE__*/React.createElement(\"div\",{className:\"user-balance-wrap wallet\"},/*#__PURE__*/React.createElement(\"span\",{className:\"user-balance-label\"},/*#__PURE__*/React.createElement(\"i\",null),\" \\u4E2D\\u5FC3\\u94B1\\u5305\"),/*#__PURE__*/React.createElement(\"span\",{className:\"user-balance-amount\"},BigNumber(userAuth.data.balance).toFormat(2))),/*#__PURE__*/React.createElement(\"div\",{className:\"user-balance-wrap hr\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"user-balance-wrap refresh\",onClick:!balanceLoad&&!balanceTime?wallet:null},/*#__PURE__*/React.createElement(\"i\",null),/*#__PURE__*/React.createElement(\"span\",{className:\"user-balance-label\"},\"\\u4E00\\u952E\\u56DE\\u6536\"))),/*#__PURE__*/React.createElement(\"div\",{className:\"form-field-section\"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-field balances-list\"},balancesRaw.map(function(balance,i){return/*#__PURE__*/React.createElement(\"div\",{key:i,className:\"balances-list--item\"},/*#__PURE__*/React.createElement(\"div\",{className:\"game-name\"},balance.game.name),/*#__PURE__*/React.createElement(\"div\",{className:\"game-balance\"},BigNumber(balance.balance).toFormat(2)));}))),/*#__PURE__*/React.createElement(\"div\",{className:\"form-field-section\"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-field--doubler\"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-field\"},/*#__PURE__*/React.createElement(\"label\",null,\"\\u63A8\\u51FA\"),/*#__PURE__*/React.createElement(\"div\",{className:\"input--wrap with-dot\"},/*#__PURE__*/React.createElement(\"div\",{className:cx(\"input-like\",{\"has-value\":balanceForm.from}),onClick:function onClick(e){return setBalanceOver(\"from\");}},balanceForm.from||\"推出\"))),/*#__PURE__*/React.createElement(\"div\",{className:\"form-field-swap\"},/*#__PURE__*/React.createElement(\"button\",{onClick:function onClick(){return swap();}})),/*#__PURE__*/React.createElement(\"div\",{className:\"form-field\"},/*#__PURE__*/React.createElement(\"label\",null,\"\\u8FDB\\u5165\"),/*#__PURE__*/React.createElement(\"div\",{className:\"input--wrap with-dot\"},/*#__PURE__*/React.createElement(\"div\",{className:cx(\"input-like\",{\"has-value\":balanceForm.to}),onClick:function onClick(e){return setBalanceOver(\"to\");}},balanceForm.to||\"进入\")))),/*#__PURE__*/React.createElement(\"div\",{className:\"form-field amount-variants\"},AmountVariants.map(function(amount,i){return/*#__PURE__*/React.createElement(\"button\",{key:i,className:cx(\"amount-variant\",{disabled:amount>userAuth.data.balance}),onClick:function onClick(){return setAmount(amount);}},amount);})),/*#__PURE__*/React.createElement(\"div\",{className:\"form-field with-max\"},/*#__PURE__*/React.createElement(\"div\",{className:\"amount-wrap\"},/*#__PURE__*/React.createElement(\"div\",{className:\"input--wrap\"},/*#__PURE__*/React.createElement(\"span\",null,\"\\uFFE5\"),/*#__PURE__*/React.createElement(\"input\",{id:\"amount\",type:\"text\",placeholder:\"\\u91D1\\u989D\",className:cx({\"has-value\":balanceForm.amount}),value:balanceForm.amount,onChange:function onChange(e){return onlyNumbers(e);}// onKeyDown={(e) => onlyNumbers(e)}\n}))),/*#__PURE__*/React.createElement(\"div\",{className:\"amount-max-wrap\"},/*#__PURE__*/React.createElement(\"button\",{className:cx({disabled:!balancesMap[balanceForm.from]||!balancesMap[balanceForm.from].balance}),onClick:function onClick(){return setMax();}},\"\\u6700\\u5927\\u91D1\\u989D\"))))),/*#__PURE__*/React.createElement(\"div\",{className:\"submit\"},/*#__PURE__*/React.createElement(\"button\",{className:\"button-stylized\",onClick:transfer},\"\\u7ACB\\u5373\\u8F6C\\u8D26\")),/*#__PURE__*/React.createElement(UIAlertSA,{onClose:function onClose(){return null;},shown:balanceOver},/*#__PURE__*/React.createElement(\"div\",{className:\"game-sa-overlay picker-over\"},/*#__PURE__*/React.createElement(\"div\",{className:\"picker-container\"},/*#__PURE__*/React.createElement(\"div\",{className:\"picker-head\"},/*#__PURE__*/React.createElement(\"p\",null,balanceOver===\"from\"?\"推出\":\"进入\")),balanceOver?/*#__PURE__*/React.createElement(PickerWrap,{dist:balanceOver}):null),/*#__PURE__*/React.createElement(\"div\",{className:\"picker-footer\"},/*#__PURE__*/React.createElement(\"button\",{onClick:function onClick(e){return setBalanceOver(null);}},\"\\u53D6\\u6D88\"),/*#__PURE__*/React.createElement(\"button\",{className:\"active\",onClick:function onClick(e){return onSetWheelValSelect(balanceOver);}},\"\\u786E\\u5B9A\")))),/*#__PURE__*/React.createElement(UIAlertSA,{onClose:function onClose(){return null;},shown:balanceTransferred},/*#__PURE__*/React.createElement(\"div\",{className:\"game-sa-overlay\"},/*#__PURE__*/React.createElement(\"div\",{className:\"overlay-layer\"},/*#__PURE__*/React.createElement(\"div\",{className:\"form response\"},/*#__PURE__*/React.createElement(\"div\",{className:\"form-head\"},message.valid&&/*#__PURE__*/React.createElement(\"i\",null),/*#__PURE__*/React.createElement(\"h2\",null,message.title)),message.message&&/*#__PURE__*/React.createElement(\"p\",{className:\"game-transfer-p\"},message.message),/*#__PURE__*/React.createElement(\"div\",{className:\"form-body\"},/*#__PURE__*/React.createElement(\"button\",{onClick:function onClick(){setBalanceTransferred(false);setBalanceUpdateI(function(i){return i+1;});}},\"\\u786E\\u8BA4\"))))))));};export default withAuth(Transfer,1);","map":{"version":3,"sources":["/Users/cramj/Documents/New PWA/GIT/src/pwa/view/profile/Transfer.js"],"names":["React","useEffect","useState","useContext","Picker","cx","BigNumber","map","findIndex","isNumber","toSafeInteger","WheelPicker","Wrap","Icon","UIAlertSA","User","Game","withAuth","Wheel","Transfer","Context","userAuth","setUserAuthFN","from","to","balances","setBalances","wallet","games","balancesFill","setBalancesFill","message","setMessage","balancesRaw","setBalancesRaw","balanceTransferred","setBalanceTransferred","balanceLoad","setBalanceLoad","balanceUpdateI","setBalanceUpdateI","balancesMap","setBalancesMap","balanceOver","setBalanceOver","amount","balanceForm","setBalanceForm","balanceTime","setBalanceTime","read","then","_balances","filter","b","error","__balances","game","name","unshift","_bFillWallet","_bFillGames","__balancesMap","forEach","id","balance","data","session","promise","r","info","bf","AmountVariants","onSetWheelValSelect","dist","thisWrap","document","querySelector","value","childNodes","obj","ariaSelected","ariaLabel","_d","PickerWrap","selectedBal","length","swap","_d1","_d2","setAmount","e","target","form","setMax","_game","_max","Math","floor","onlyNumbers","currentTarget","regexp","test","transfer","isNaN","title","console","warn","_getMap","n","split","_from","_to","valid","_e","transferToWallet","setTimeout","toFormat","i","disabled"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useContext } from \"react\";\r\nimport Picker from \"react-mobile-picker\";\r\nimport cx from \"classnames\";\r\nimport BigNumber from \"bignumber.js\";\r\nimport{ map , findIndex , isNumber, toSafeInteger } from 'lodash'\r\nimport WheelPicker from 'react-simple-wheel-picker';\r\n\r\nimport { Wrap } from \"./\";\r\nimport { Icon } from \"../../../component/\";\r\nimport { UIAlertSA } from \"../../component/\";\r\nimport { User, Game } from \"../../../service/\";\r\nimport { withAuth } from \"../../util\";\r\n\r\nimport Wheel from './transfer/wheel'\r\n\r\nconst Transfer = () => {\r\n  const { userAuth, setUserAuthFN } = useContext(User.Context);\r\n\r\n  const [balances, setBalances] = useState({\r\n    from: [],\r\n    to: [],\r\n  });\r\n\r\n  const [balancesFill, setBalancesFill] = useState({\r\n    wallet: [],\r\n    games: [],\r\n  });\r\n\r\n  const [message , setMessage] = useState({});\r\n\r\n  const [balancesRaw, setBalancesRaw] = useState([]);\r\n\r\n  const [balanceTransferred, setBalanceTransferred] = useState(false);\r\n  const [balanceLoad, setBalanceLoad] = useState(false);\r\n  const [balanceUpdateI, setBalanceUpdateI] = useState(0);\r\n  const [balancesMap, setBalancesMap] = useState({});\r\n  const [balanceOver, setBalanceOver] = useState(null);\r\n  const [balanceForm, setBalanceForm] = useState({\r\n    from: null,\r\n    to: null,\r\n    amount: \"\",\r\n  });\r\n  const [balanceTime, setBalanceTime] = useState(false);\r\n\r\n  useEffect(() => {\r\n    setBalances({\r\n      from: [],\r\n      to: [],\r\n    });\r\n\r\n    setBalancesMap({});\r\n\r\n    setBalancesFill({\r\n      wallet: [],\r\n      games: [],\r\n    });\r\n\r\n    Game.balances({\r\n      ...User.read(),\r\n    }).then((_balances) => {\r\n      setBalancesRaw(_balances.filter((b) => !b.error));\r\n\r\n      // const __balances = _balances.map(b => `${b.game.name}: ${b.balance} ¥`);\r\n      // \t\t\t__balances.unshift(`中央钱包: ${userAuth.data.balance} ¥`);\r\n      const __balances = _balances\r\n        .filter((b) => !b.error)\r\n        .map((b) => `${b.game.name}`);\r\n      __balances.unshift(`中心钱包`);\r\n\r\n      const _bFillWallet = [`中心钱包`];\r\n      const _bFillGames = _balances\r\n        .filter((b) => !b.error)\r\n        .map((b) => b.game.name);\r\n\r\n      setBalancesFill({\r\n        wallet: _bFillWallet,\r\n        games: _bFillGames,\r\n      });\r\n\r\n      setBalanceForm((balanceForm) => ({\r\n        ...balanceForm,\r\n        from: __balances[0],\r\n        to: __balances[1],\r\n      }));\r\n\r\n      setBalances({\r\n        from: __balances,\r\n        // to: __balances,\r\n        to: _bFillGames,\r\n      });\r\n\r\n      // console.log(_balances )\r\n      // console.log(__balances )\r\n      // console.log(_bFillGames )\r\n\r\n      const __balancesMap = {};\r\n\r\n      _balances\r\n        .filter((b) => !b.error)\r\n        .forEach((b) => {\r\n          __balancesMap[b.game.name] = b;\r\n        });\r\n\r\n      __balancesMap[\"中心钱包\"] = {\r\n        game: {\r\n          id: 0,\r\n          name: \"wallet\",\r\n        },\r\n        wallet: true,\r\n        balance: +userAuth.data.balance,\r\n      };\r\n\r\n      setBalancesMap(__balancesMap);\r\n    });\r\n  }, [balanceUpdateI, userAuth.data.balance]);\r\n\r\n  useEffect(() => {\r\n    User.session({\r\n      ...User.read(),\r\n    }).promise.then((r) => setUserAuthFN(1, r.info));\r\n\r\n    setBalanceForm((bf) => ({\r\n      ...bf,\r\n      amount: \"\",\r\n    }));\r\n\r\n    // eslint-disable-next-line\r\n  }, [balanceUpdateI]);\r\n\r\n  const AmountVariants = [100, 500, 1000, 2000, 5000];\r\n\r\n\r\n  // useEffect(() => { \r\n  //     // console.log(balances)\r\n  //     Game.activateListV1({\r\n  //       ...User.read(),\r\n  //     }).promise.then((r) =>{\r\n  //       // console.log(r)\r\n  //     })\r\n  // },[balances])\r\n\r\n  const onSetWheelValSelect = (dist) =>{\r\n\r\n    const thisWrap = document.querySelector(\".wheelwrap ul\");\r\n    // console.log(thisWrap.childNodes)\r\n    let value \r\n    map( thisWrap.childNodes , obj =>{\r\n      if(obj.ariaSelected == \"true\"){\r\n        value = obj.ariaLabel\r\n      }\r\n      // console.log( obj.ariaLabel , obj.ariaSelected)\r\n    })\r\n\r\n    // console.log(value)\r\n    // return false;\r\n\r\n    if (dist === \"from\") {\r\n      const _d = balancesMap[value].wallet ? \"games\" : \"wallet\";\r\n\r\n      setBalances((b) => ({\r\n        ...b,\r\n        to: balancesFill[_d],\r\n      }));\r\n\r\n      setBalanceForm((bf) => ({\r\n        ...bf,\r\n        to: balancesFill[_d][0],\r\n      }));\r\n    }\r\n\r\n    setBalanceForm((bf) => ({\r\n      ...bf,\r\n      [dist]: value,\r\n    }));\r\n\r\n    setBalanceOver(null)\r\n  }\r\n\r\n\r\n  const PickerWrap = ({ dist }) => {\r\n    \r\n    const selectedBal = findIndex(balances[dist] , obj => obj === balanceForm[dist])\r\n\r\n    return  <div className=\"picker-wrap\">\r\n              {\r\n                balances[dist].length  &&\r\n                <Wheel \r\n                  options={balances[dist]}\r\n                  selected={selectedBal}\r\n                  onChange={(value) => {\r\n                    // console.log(value)\r\n                    if (dist === \"from\") {\r\n                      const _d = balancesMap[value].wallet ? \"games\" : \"wallet\";\r\n\r\n                      setBalances((b) => ({\r\n                        ...b,\r\n                        to: balancesFill[_d],\r\n                      }));\r\n\r\n                      setBalanceForm((bf) => ({\r\n                        ...bf,\r\n                        to: balancesFill[_d][0],\r\n                      }));\r\n                    }\r\n\r\n                    setBalanceForm((bf) => ({\r\n                      ...bf,\r\n                      [dist]: value,\r\n                    }));\r\n\r\n                  }}\r\n                />\r\n\r\n              }\r\n\r\n\r\n              {/* {balances[dist].length ? (\r\n                <Picker\r\n                  height={180}\r\n                  valueGroups={{ [dist]: balanceForm[dist] }}\r\n                  optionGroups={{ [dist]: balances[dist] }}\r\n                  onChange={(key, value) => {\r\n                    if (dist === \"from\") {\r\n                      const _d = balancesMap[value].wallet ? \"games\" : \"wallet\";\r\n\r\n                      setBalances((b) => ({\r\n                        ...b,\r\n                        to: balancesFill[_d],\r\n                      }));\r\n\r\n                      setBalanceForm((bf) => ({\r\n                        ...bf,\r\n                        to: balancesFill[_d][0],\r\n                      }));\r\n                    }\r\n\r\n                    setBalanceForm((bf) => ({\r\n                      ...bf,\r\n                      [key]: value,\r\n                    }));\r\n                  }}\r\n                />\r\n              ) : null} */}\r\n            </div>\r\n  }\r\n    \r\n  \r\n\r\n  const swap = () => {\r\n    const [to, from] = [balanceForm.from, balanceForm.to];\r\n\r\n    const _d1 = balancesMap[from].wallet ? \"games\" : \"wallet\";\r\n    const _d2 = balancesMap[to].wallet ? \"games\" : \"wallet\";\r\n\r\n    setBalances((b) => ({\r\n      ...b,\r\n      to: balancesFill[_d1],\r\n      from: balancesFill[_d2],\r\n    }));\r\n\r\n    setBalanceForm((bf) => ({\r\n      ...bf,\r\n      to,\r\n      from,\r\n    }));\r\n  };\r\n\r\n  const setAmount = (e) => {\r\n    const amount = e.target ? e.target.value : e;\r\n\r\n    setBalanceForm((form) => ({ ...form, amount }));\r\n  };\r\n\r\n  const setMax = () => {\r\n    const _game = balancesMap[balanceForm.from];\r\n\r\n    let _max = _game.balance;\r\n\r\n    if (_game.wallet) {\r\n      _max = userAuth.data.balance;\r\n    }\r\n\r\n    setAmount( Math.floor(_max) );\r\n  };\r\n\r\n  const onlyNumbers = (e) => {\r\n    const { value } = e.currentTarget\r\n    let regexp  = /^[0-9\\b]+$/\r\n    if (!value || regexp.test(value)) {\r\n      setAmount(value);\r\n    }\r\n\r\n  };\r\n\r\n  const transfer = (e) => {\r\n\r\n    if (!balanceForm.amount || isNaN(+balanceForm.amount)) {\r\n       setMessage({\r\n        title : '系统提示',\r\n        message: '没有金额',\r\n      })\r\n      setBalanceTransferred(true);\r\n      return void console.warn(\"[transfer] No amount\");\r\n    }\r\n\r\n    const _getMap = (n) => balancesMap[n.split(\": \")[0]] || null;\r\n\r\n    const _from = _getMap(balanceForm.from);\r\n    const _to = _getMap(balanceForm.to);\r\n\r\n    if (_from.game.id === _to.game.id) {\r\n      setMessage({\r\n        title : '系统提示',\r\n        message: '同一个游戏',\r\n      })\r\n      setBalanceTransferred(true);\r\n      return void console.warn(\"[transfer] Same game\");\r\n    }\r\n\r\n    if (_from.balance === 0) {\r\n      setMessage({\r\n        title : '系统提示',\r\n        message: '零余额',\r\n      })\r\n      setBalanceTransferred(true);\r\n      return void console.warn(\"[transfer] Zero balance\");\r\n    }\r\n\r\n    if (_from.balance < +balanceForm.amount) {\r\n      setMessage({\r\n        title : '系统提示',\r\n        message: '余额不足',\r\n      })\r\n      setBalanceTransferred(true);\r\n      return void console.warn(\"[transfer] Not enough game balance\");\r\n    }\r\n\r\n    console.info(\r\n      `You're transfering ${balanceForm.amount} ¥ from ${_from.game.name} to ${_to.game.name}`\r\n    );\r\n\r\n    setBalanceLoad(true);\r\n\r\n    Game.transfer({\r\n      ...User.read(),\r\n      amount: +balanceForm.amount,\r\n      from: _from.game.id,\r\n      to: _to.game.id,\r\n    }).then(\r\n      (r) => {\r\n        console.info(\r\n          `You have successfully transferred ${balanceForm.amount} ¥ from ${_from.game.name} to ${_to.game.name}: ${r.info}`\r\n        );\r\n\r\n        setMessage({\r\n          title: '转账成功',\r\n          valid: true,\r\n        })\r\n\r\n        setBalanceLoad(false);\r\n\r\n        setBalanceTransferred(true);\r\n      },\r\n      (e) => {\r\n        console.error(e);\r\n\r\n        setMessage({\r\n          title : '系统提示',\r\n          message: e,\r\n        })\r\n        setBalanceTransferred(true);\r\n\r\n        setBalanceLoad(false);\r\n      }\r\n    );\r\n  };\r\n\r\n  const wallet = (_e) => {\r\n    setBalanceTime(true);\r\n    setBalanceLoad(true);\r\n\r\n    Game.transferToWallet().promise.then(\r\n      (r) => {\r\n        setBalanceLoad(false);\r\n\r\n        setBalanceTransferred(true);\r\n      },\r\n      (e) => {\r\n        console.warn(e);\r\n\r\n        setBalanceLoad(false);\r\n      }\r\n    );\r\n    setTimeout(() => {\r\n      setBalanceTime(false);\r\n    }, 10000);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Wrap\r\n        className=\"profile-transfer\"\r\n        name=\"转账\"\r\n        isLoading={!balancesRaw.length || balanceLoad}\r\n      >\r\n        <div className=\"fields\">\r\n          <div className=\"form-field user-balance\">\r\n            <div className=\"user-balance-wrap wallet\">\r\n              <span className=\"user-balance-label\">\r\n                <i /> 中心钱包\r\n              </span>\r\n              <span className=\"user-balance-amount\">\r\n                {BigNumber(userAuth.data.balance).toFormat(2)}\r\n              </span>\r\n            </div>\r\n            <div className=\"user-balance-wrap hr\" />\r\n            <div\r\n              className=\"user-balance-wrap refresh\"\r\n              onClick={!balanceLoad && !balanceTime ? wallet : null}\r\n            >\r\n              <i />\r\n              <span className=\"user-balance-label\">一键回收</span>\r\n            </div>\r\n\r\n            {/* <i></i>\r\n\t\t\t\t\t<div className=\"wrap\">\r\n\t\t\t\t\t\t<p className=\"label\">中心钱包</p>\r\n\t\t\t\t\t\t<p className=\"amount\">¥ {BigNumber(userAuth.data.balance).toFormat(2)}</p>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<button className=\"to-wallet\" onClick={wallet}>\r\n\t\t\t\t\t\t<Icon name=\"refresh\" />\r\n\t\t\t\t\t\t<span>一键回收</span>\r\n\t\t\t\t\t</button> */}\r\n          </div>\r\n\r\n          {/* ============================ SECTION ============================  */}\r\n          <div className=\"form-field-section\">\r\n            <div className=\"form-field balances-list\">\r\n              {balancesRaw.map((balance, i) => (\r\n                <div key={i} className=\"balances-list--item\">\r\n                  <div className=\"game-name\">{balance.game.name}</div>\r\n                  <div className=\"game-balance\">\r\n                    {BigNumber(balance.balance).toFormat(2)}\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n          {/* ============================ SECTION ============================  */}\r\n\r\n          {/* ============================ SECTION ============================  */}\r\n          <div className=\"form-field-section\">\r\n            <div className=\"form-field--doubler\">\r\n              <div className=\"form-field\">\r\n                <label>推出</label>\r\n                <div className=\"input--wrap with-dot\">\r\n                  <div\r\n                    className={cx(\"input-like\", {\r\n                      \"has-value\": balanceForm.from,\r\n                    })}\r\n                    onClick={(e) => setBalanceOver(\"from\")}\r\n                  >\r\n                    {balanceForm.from || \"推出\"}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div className=\"form-field-swap\">\r\n                <button onClick={() => swap()}>\r\n                  {/* <Icon name=\"switch\" /> */}\r\n                </button>\r\n              </div>\r\n              <div className=\"form-field\">\r\n                <label>进入</label>\r\n                <div className=\"input--wrap with-dot\">\r\n                  <div\r\n                    className={cx(\"input-like\", {\r\n                      \"has-value\": balanceForm.to,\r\n                    })}\r\n                    onClick={(e) => setBalanceOver(\"to\")}\r\n                  >\r\n                    {balanceForm.to || \"进入\"}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div className=\"form-field amount-variants\">\r\n              {AmountVariants.map((amount, i) => (\r\n                <button\r\n                  key={i}\r\n                  className={cx(\"amount-variant\", {\r\n                    disabled: amount > userAuth.data.balance,\r\n                  })}\r\n                  onClick={() => setAmount(amount)}\r\n                >\r\n                  {amount}\r\n                </button>\r\n              ))}\r\n            </div>\r\n            <div className=\"form-field with-max\">\r\n              <div className=\"amount-wrap\">\r\n                {/* <label htmlFor=\"amount\">金额</label> */}\r\n                <div className=\"input--wrap\">\r\n                  <span>￥</span>\r\n                  <input\r\n                    id=\"amount\"\r\n                    type=\"text\"\r\n                    placeholder=\"金额\"\r\n                    className={cx({ \"has-value\": balanceForm.amount })}\r\n                    value={balanceForm.amount}\r\n                    onChange={(e) => onlyNumbers(e)}\r\n                    // onKeyDown={(e) => onlyNumbers(e)}\r\n                    \r\n                  />\r\n                </div>\r\n              </div>\r\n              <div className=\"amount-max-wrap\">\r\n                <button\r\n                  className={cx({\r\n                    disabled:\r\n                      !balancesMap[balanceForm.from] ||\r\n                      !balancesMap[balanceForm.from].balance,\r\n                  })}\r\n                  onClick={() => setMax()}\r\n                >\r\n                  最大金额\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          {/* ============================ SECTION ============================  */}\r\n        </div>\r\n        <div className=\"submit\">\r\n          <button className=\"button-stylized\" onClick={transfer}>\r\n            立即转账\r\n          </button>\r\n        </div>\r\n\r\n        <UIAlertSA onClose={() => null} shown={balanceOver}>\r\n          <div className={`game-sa-overlay picker-over`}>\r\n            <div className=\"picker-container\">\r\n              <div className=\"picker-head\">\r\n                <p>{balanceOver === \"from\" ? \"推出\" : \"进入\"}</p>\r\n              </div>\r\n              {balanceOver ? <PickerWrap dist={balanceOver} /> : null}\r\n            </div>\r\n            \r\n            <div className=\"picker-footer\">\r\n              <button onClick={(e) => setBalanceOver(null)}>取消</button>\r\n              <button className=\"active\" onClick={(e) => onSetWheelValSelect(balanceOver)}>\r\n                确定\r\n              </button>\r\n            </div>\r\n            \r\n          </div>\r\n        </UIAlertSA>\r\n        <UIAlertSA onClose={() => null} shown={balanceTransferred}>\r\n          <div className={`game-sa-overlay`}>\r\n            <div className=\"overlay-layer\">\r\n              <div className=\"form response\">\r\n                <div className=\"form-head\">\r\n                {message.valid && <i />}\r\n                <h2>{message.title}</h2>\r\n                </div>\r\n                {message.message && <p className=\"game-transfer-p\">{message.message}</p>}\r\n                <div className=\"form-body\">\r\n                  <button\r\n                    onClick={() => {\r\n                      setBalanceTransferred(false);\r\n                      setBalanceUpdateI((i) => i + 1);\r\n                    }}\r\n                  >\r\n                    确认\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </UIAlertSA>\r\n      </Wrap>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default withAuth(Transfer, 1);\r\n"]},"metadata":{},"sourceType":"module"}