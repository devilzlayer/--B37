{"ast":null,"code":"import _defineProperty from\"/Users/cramj/Documents/New PWA/ubet-project (1)/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _regeneratorRuntime from\"/Users/cramj/Documents/New PWA/ubet-project (1)/node_modules/react-scripts/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/cramj/Documents/New PWA/ubet-project (1)/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"/Users/cramj/Documents/New PWA/ubet-project (1)/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/cramj/Documents/New PWA/ubet-project (1)/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState,useMemo,useContext}from\"react\";import{map,filter,head,find,reverse,isNumber,toInteger}from\"lodash\";import*as moment from\"moment\";import BigNumber from\"bignumber.js\";import{Service}from\"./\";import{toDate}from\"../../util\";import\"../../assets/scss/profile/Withdrawal.scss\";import CardWrap from\"./withdrawal/card\";import HistoryItem from\"./withdrawal/historyItem\";import Wrap from\"./Wrap\";var Withdrawal=function Withdrawal(){var _useContext=useContext(Service.User.Context),setUserAuthFN=_useContext.setUserAuthFN,userAuth=_useContext.userAuth;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),loadmore=_useState2[0],setLoadMore=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),key=_useState4[0],setKey=_useState4[1];var _useState5=useState({}),_useState6=_slicedToArray(_useState5,2),userData=_useState6[0],setUserData=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),cards=_useState8[0],setCards=_useState8[1];var _useState9=useState(\"today\"),_useState10=_slicedToArray(_useState9,2),range=_useState10[0],setRange=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),balancesRaw=_useState12[0],setBalancesRaw=_useState12[1];var _useState13=useState({status:0,list:[]}),_useState14=_slicedToArray(_useState13,2),items=_useState14[0],setItems=_useState14[1];var _useState15=useState({from:moment().subtract(30,\"days\").toDate(),to:moment().toDate()}),_useState16=_slicedToArray(_useState15,2),customRange=_useState16[0],setCustomRange=_useState16[1];var _useState17=useState({debit_bank:\"\",amount:\"\"}),_useState18=_slicedToArray(_useState17,2),form=_useState18[0],setForm=_useState18[1];var _useState19=useState(false),_useState20=_slicedToArray(_useState19,2),refresh=_useState20[0],setFresh=_useState20[1];var _useState21=useState(false),_useState22=_slicedToArray(_useState21,2),cardPicker=_useState22[0],toggleCardPicker=_useState22[1];var _useState23=useState(false),_useState24=_slicedToArray(_useState23,2),load=_useState24[0],setLoad=_useState24[1];var _useState25=useState(null),_useState26=_slicedToArray(_useState25,2),showBank=_useState26[0],setShowBank=_useState26[1];useEffect(function(){Service.Game.balances(_objectSpread({},Service.User.read())).then(function(balances){// console.log(balances)\nsetBalancesRaw(balances.filter(function(b){return!b.error;}));});var req=Service.Card.read(_objectSpread({},Service.User.read()));req.promise.then(function(r){var newItems=reverse(r.info);var debBnk=head(newItems);if(debBnk){setForm(function(f){return _objectSpread(_objectSpread({},f),{},{debit_bank:debBnk.debit_bank});});setCards(newItems);setFresh(false);}},function(e){});},[refresh]);useEffect(function(){if(userAuth.data){setUserData(userAuth.data);}var fetch=function fetch(){var response=Service.Transaction.read(_objectSpread(_objectSpread({},Service.User.read()),{},{record_type:\"debit\"}));response.promise.then(function(result){// console.log(result);\nif(result.status===1){// setItems(result.info);\nsetItems({status:1,list:result.info.map(function(t){return _objectSpread(_objectSpread({},t),{},{ts:toDate(t.requestTime,true)});})});setLoad(false);}},function(e){console.log(\"Unable to response:\",e);});};fetch();},[load]);var __withdraws=useMemo(function(){var _rangeMap={today:function today(){var today=moment();return[today.startOf(\"day\").unix(),today.endOf(\"day\").unix()];},yesterday:function yesterday(){var yesterday=moment().subtract(1,\"days\");return[yesterday.startOf(\"day\").unix(),yesterday.endOf(\"day\").unix()];},week:function week(){return[moment().subtract(1,\"weeks\").startOf(\"day\").unix(),moment().endOf(\"day\").unix()];},month:function month(){return[moment().subtract(30,\"days\").startOf(\"day\").unix(),moment().endOf(\"day\").unix()];},custom:function custom(){var from=customRange.from,to=customRange.to;return[moment(from).startOf(\"day\").unix(),moment(to).endOf(\"day\").unix()];}};var _rangeMap$range=_rangeMap[range](),_rangeMap$range2=_slicedToArray(_rangeMap$range,2),from=_rangeMap$range2[0],to=_rangeMap$range2[1];// return withdraws.list.filter((t) => t.ts >= from && t.ts < to);\nreturn filter(items.list,function(t){return t.ts>=from&&t.ts<to;});},[items.list,customRange,range]);var _onCancel=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(w){var response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return Service.User.withdrawCancel({id:w.id}).promise;case 2:response=_context.sent;// console.log(response);\nif(response.status===1){setUserAuthFN(userAuth.status,userAuth.data,{text:\"系统提示\",message:response.info});setLoad(true);}case 4:case\"end\":return _context.stop();}}},_callee);}));return function onCancel(_x){return _ref.apply(this,arguments);};}();var _onSetKey=function onSetKey(value){setKey(null);if(key!==value)setKey(value);};var onMax=function onMax(){setForm(_objectSpread(_objectSpread({},form),{},{amount:Math.floor(userAuth.data.balance)}));};var onHideBank=function onHideBank(){setShowBank(null);setFresh(true);};var onTransfer=function onTransfer(){var debit_bank=form.debit_bank,amount=form.amount;if(!debit_bank){setUserAuthFN(userAuth.status,userAuth.data,{text:\"系统提示\",message:\"必须选择一张银行卡\"});return false;}if(!amount){setUserAuthFN(userAuth.status,userAuth.data,{text:\"系统提示\",message:\"取款金额不能为空\"});return false;}if(amount<100){setUserAuthFN(userAuth.status,userAuth.data,{text:\"系统提示\",message:\"取款金额最低100元\"});return false;}var selectedBnk=find(cards,function(obj){return obj.debit_bank==debit_bank;});var _form=_objectSpread(_objectSpread({},form),{},{debit_bank:selectedBnk.id});Service.User.withdraw(_objectSpread(_objectSpread({},Service.User.read()),_form)).promise.then(function(r){console.log(\"You've successfully withdrawn:\",r);setUserAuthFN(userAuth.status,userAuth.data,{text:\"系统提示\",message:r.info});setLoad(true);},function(e){console.warn(\"Unable to withdraw:\",e);setUserAuthFN(userAuth.status,userAuth.data,{text:\"系统提示\",message:e});});};var wallet=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:Service.Game.transferToWallet().promise.then(function(r){Service.User.session(_objectSpread({},Service.User.read())).promise.then(function(r){setUserAuthFN(1,r.info,{text:\"转账成功\",success:true});setLoad(true);setFresh(true);});},function(e){console.warn(e);setUserAuthFN(userAuth.status,userAuth.data,{text:\"系统提示\",message:e});});case 1:case\"end\":return _context2.stop();}}},_callee2);}));return function wallet(_x2){return _ref2.apply(this,arguments);};}();var onlyNumbers=function onlyNumbers(e){var _e$currentTarget=e.currentTarget,name=_e$currentTarget.name,value=_e$currentTarget.value;var regexp=/^[0-9\\b]+$/;if(!value||regexp.test(value)){setForm(function(f){return _objectSpread(_objectSpread({},f),{},_defineProperty({},name,value));});}};var onTransferPerGame=function onTransferPerGame(obj){var _from={id:0,name:'wallet'};var _to=obj;// console.log(_from , _to) \n// return false\nconsole.info(\"You are transferring \".concat(Math.floor(userData.balance),\" \\xA5 from \").concat(_from.name,\" to \").concat(_to.game.name));Service.Game.transfer(_objectSpread(_objectSpread({},Service.User.read()),{},{amount:Math.floor(userData.balance),from:_from.id,to:_to.game.id})).then(function(r){console.info(\"You have successfully transferred \".concat(Math.floor(userData.balance),\" \\xA5 from \").concat(_from.name,\" to \").concat(_to.game.name,\": \").concat(r.info));Service.User.session(_objectSpread({},Service.User.read())).promise.then(function(r){setUserAuthFN(1,r.info,{text:\"转账成功\",success:true});setLoad(true);setFresh(true);});},function(e){// console.log(e);\nsetUserAuthFN(userAuth.status,userAuth.data,{text:\"系统提示\",message:e});});};// console.log(items.list)\nreturn/*#__PURE__*/React.createElement(Wrap,{className:\"profile-withdrawal-desktop\",title:\"提款\"},/*#__PURE__*/React.createElement(\"div\",{className:\"profile-section section-box\"},/*#__PURE__*/React.createElement(\"div\",{className:\"profile-section-title\"},\"\\u4E2D\\u5FC3\\u94B1\\u5305 :\",/*#__PURE__*/React.createElement(\"span\",{className:\"value\"},\" \\xA5\",userData.balance),/*#__PURE__*/React.createElement(\"div\",{className:\"one-transfer\",onClick:wallet},/*#__PURE__*/React.createElement(\"span\",null,/*#__PURE__*/React.createElement(\"i\",null),\"\\u4E00\\u952E\\u56DE\\u6536\"))),/*#__PURE__*/React.createElement(\"div\",{className:\"withdral-boxes\"},balancesRaw&&map(balancesRaw,function(obj,i){return/*#__PURE__*/React.createElement(\"div\",{key:i,className:\"withdral-boxes-item\"},/*#__PURE__*/React.createElement(\"div\",{className:\"withdral-boxes-title\"},obj.game.name),/*#__PURE__*/React.createElement(\"div\",{className:\"withdral-boxes-value\"},BigNumber(obj.balance).toFormat(2)),/*#__PURE__*/React.createElement(\"div\",{className:\"withdral-boxes-button\",onClick:function onClick(){return onTransferPerGame(obj);}},\"\\u4E00\\u952E\\u8F6C\\u5165\"));})),/*#__PURE__*/React.createElement(\"div\",{className:\"withdrawal-boxes-loadmore\",onClick:function onClick(){return setLoadMore(!loadmore);}},/*#__PURE__*/React.createElement(\"span\",{className:loadmore?'show':''},\"\\u663E\\u793A\\u6240\\u6709\\u573A\\u9986 \"))),/*#__PURE__*/React.createElement(\"div\",{className:\"profile-section section-box relative \".concat(showBank?\"h727\":\"\")},/*#__PURE__*/React.createElement(\"div\",{className:\"profile-section-relative\"},/*#__PURE__*/React.createElement(\"div\",{className:\"profile-section-subtitle\"},\"\\u9009\\u62E9\\u94F6\\u884C\\u5361\"),/*#__PURE__*/React.createElement(\"div\",{className:\"withdrawal-form-section\"},/*#__PURE__*/React.createElement(\"div\",{className:\"withdrawal-form-group transfer\"},/*#__PURE__*/React.createElement(\"div\",{className:\"input\",onClick:function onClick(){return toggleCardPicker(!cardPicker);}},form.debit_bank,/*#__PURE__*/React.createElement(\"i\",null)),/*#__PURE__*/React.createElement(\"div\",{className:\"card-toggle \".concat(cardPicker?\"active\":\"\")},cards&&map(cards,function(obj,i){return/*#__PURE__*/React.createElement(\"div\",{key:i,className:\"card-toggle-item  \".concat(form.debit_bank===obj.debit_bank?\"active\":\"\",\" \"),onClick:function onClick(){return[setForm(_objectSpread(_objectSpread({},form),{},{debit_bank:obj.debit_bank})),toggleCardPicker(false)];}},obj.debit_bank);})),/*#__PURE__*/React.createElement(\"button\",{onClick:onTransfer},\"\\u7ACB\\u5373\\u63D0\\u6B3E\")),/*#__PURE__*/React.createElement(\"div\",{className:\"withdrawal-form-group max\"},/*#__PURE__*/React.createElement(\"span\",null,\"\\uFFE5\"),/*#__PURE__*/React.createElement(\"input\",{value:form.amount,placeholder:\"\\u91D1\\u989D\",name:\"amount\",pattern:\"^-?[0-9]\\\\d*\\\\.?\\\\d*$\",onChange:function onChange(e){return onlyNumbers(e);}// onKeyDown={(e) => onlyNumbers(e)}\n}),/*#__PURE__*/React.createElement(\"button\",{onClick:function onClick(){return onMax();}},\"\\u6700\\u5927\\u91D1\\u989D\"))),/*#__PURE__*/React.createElement(\"div\",{className:\"withdrawal-form-section-button\"},/*#__PURE__*/React.createElement(\"button\",{className:\"new-button-card\",onClick:function onClick(){return setShowBank(\"new\");}},\"\\u65B0\\u589E\\u94F6\\u884C\\u5361\"),/*#__PURE__*/React.createElement(\"button\",{className:\"untie-button-card\",onClick:function onClick(){return setShowBank(\"del\");}},\"\\u89E3\\u7ED1\\u94F6\\u884C\\u5361\"))),/*#__PURE__*/React.createElement(CardWrap,{show:showBank,onHide:onHideBank})),/*#__PURE__*/React.createElement(\"div\",{className:\"withdrawal-history-card-head\"},/*#__PURE__*/React.createElement(\"div\",{className:\"withdrawal-history-card-title\"},/*#__PURE__*/React.createElement(\"span\",null,\"\\u63D0\\u6B3E\\u8BB0\\u5F55\"),/*#__PURE__*/React.createElement(\"i\",{className:load?\"reload\":\"\",onClick:function onClick(){return setLoad(true);}})),/*#__PURE__*/React.createElement(\"div\",{className:\"withdrawal-history-card-body\"},items.list?map(items.list,function(obj,i){return/*#__PURE__*/React.createElement(HistoryItem,{obj:obj,key:i,index:i,label:obj.cardNumber,time:obj.requestTime,value:obj.amount,status:obj.status,onCancel:function onCancel(val){return _onCancel(val);},onSetKey:function onSetKey(val){return _onSetKey(val);},setKey:key});}):/*#__PURE__*/React.createElement(\"div\",{className:\"no-transactions\"},/*#__PURE__*/React.createElement(\"div\",{className:\"image-box\"}),/*#__PURE__*/React.createElement(\"span\",null,\"\\u6682\\u65E0\\u8BB0\\u5F55\")))));};export default Withdrawal;","map":{"version":3,"sources":["/Users/cramj/Documents/New PWA/ubet-project (1)/src/view/profile/Withdrawal.js"],"names":["React","useEffect","useState","useMemo","useContext","map","filter","head","find","reverse","isNumber","toInteger","moment","BigNumber","Service","toDate","CardWrap","HistoryItem","Wrap","Withdrawal","User","Context","setUserAuthFN","userAuth","loadmore","setLoadMore","key","setKey","userData","setUserData","cards","setCards","range","setRange","balancesRaw","setBalancesRaw","status","list","items","setItems","from","subtract","to","customRange","setCustomRange","debit_bank","amount","form","setForm","refresh","setFresh","cardPicker","toggleCardPicker","load","setLoad","showBank","setShowBank","Game","balances","read","then","b","error","req","Card","promise","r","newItems","info","debBnk","f","e","data","fetch","response","Transaction","record_type","result","t","ts","requestTime","console","log","__withdraws","_rangeMap","today","startOf","unix","endOf","yesterday","week","month","custom","onCancel","w","withdrawCancel","id","text","message","onSetKey","value","onMax","Math","floor","balance","onHideBank","onTransfer","selectedBnk","obj","_form","withdraw","warn","wallet","transferToWallet","session","success","onlyNumbers","currentTarget","name","regexp","test","onTransferPerGame","_from","_to","game","transfer","i","toFormat","cardNumber","val"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useMemo, useContext } from \"react\";\r\nimport { map, filter, head, find, reverse  , isNumber , toInteger} from \"lodash\";\r\nimport * as moment from \"moment\";\r\nimport BigNumber from \"bignumber.js\";\r\n\r\nimport { Service } from \"./\";\r\nimport { toDate } from \"../../util\";\r\n\r\nimport \"../../assets/scss/profile/Withdrawal.scss\";\r\n\r\nimport CardWrap from \"./withdrawal/card\";\r\nimport HistoryItem from \"./withdrawal/historyItem\";\r\n\r\nimport Wrap from \"./Wrap\";\r\n\r\nconst Withdrawal = () => {\r\n  const { setUserAuthFN, userAuth } = useContext(Service.User.Context);\r\n\r\n  const [loadmore, setLoadMore] = useState(null);\r\n  const [key, setKey] = useState(null);\r\n  const [userData, setUserData] = useState({});\r\n  const [cards, setCards] = useState(null);\r\n  const [range, setRange] = useState(\"today\");\r\n\r\n  const [balancesRaw, setBalancesRaw] = useState([]);\r\n  const [items, setItems] = useState({\r\n    status: 0,\r\n    list: [],\r\n  });\r\n  const [customRange, setCustomRange] = useState({\r\n    from: moment().subtract(30, \"days\").toDate(),\r\n    to: moment().toDate(),\r\n  });\r\n  const [form, setForm] = useState({\r\n    debit_bank: \"\",\r\n    amount: \"\",\r\n  });\r\n\r\n  const [refresh, setFresh] = useState(false);\r\n  const [cardPicker, toggleCardPicker] = useState(false);\r\n  const [load, setLoad] = useState(false);\r\n  const [showBank, setShowBank] = useState(null);\r\n\r\n\r\n  useEffect(() => {\r\n    Service.Game.balances({\r\n      ...Service.User.read(),\r\n    }).then((balances) => {\r\n      // console.log(balances)\r\n      setBalancesRaw(balances.filter((b) => !b.error));\r\n    });\r\n\r\n    const req = Service.Card.read({\r\n      ...Service.User.read(),\r\n    });\r\n\r\n    req.promise.then((r) => {\r\n        const newItems = reverse(r.info);\r\n        const debBnk = head(newItems);\r\n        if (debBnk) {\r\n          setForm((f) => ({\r\n            ...f,\r\n            debit_bank: debBnk.debit_bank,\r\n          }));\r\n          setCards(newItems);\r\n          setFresh(false);\r\n        }\r\n    },(e) => {});\r\n\r\n \r\n\r\n  }, [refresh]);\r\n\r\n  useEffect(() => {\r\n    if (userAuth.data) {\r\n      setUserData(userAuth.data);\r\n    }\r\n\r\n    const fetch = () => {\r\n      const response = Service.Transaction.read({\r\n        ...Service.User.read(),\r\n        record_type: \"debit\",\r\n      });\r\n\r\n      response.promise.then((result) => {\r\n          // console.log(result);\r\n          if (result.status === 1) {\r\n            // setItems(result.info);\r\n            setItems({\r\n              status: 1,\r\n              list: result.info.map((t) => ({\r\n                ...t,\r\n                ts: toDate(t.requestTime, true),\r\n              })),\r\n            });\r\n            setLoad(false);\r\n          }\r\n        },\r\n        (e) => {\r\n          console.log(\"Unable to response:\", e);\r\n        }\r\n      );\r\n    };\r\n    fetch();\r\n  }, [load]);\r\n\r\n  const __withdraws = useMemo(() => {\r\n    const _rangeMap = {\r\n      today: () => {\r\n        const today = moment();\r\n        return [today.startOf(\"day\").unix(), today.endOf(\"day\").unix()];\r\n      },\r\n      yesterday: () => {\r\n        const yesterday = moment().subtract(1, \"days\");\r\n        return [yesterday.startOf(\"day\").unix(), yesterday.endOf(\"day\").unix()];\r\n      },\r\n      week: () => {\r\n        return [\r\n          moment().subtract(1, \"weeks\").startOf(\"day\").unix(),\r\n          moment().endOf(\"day\").unix(),\r\n        ];\r\n      },\r\n      month: () => {\r\n        return [\r\n          moment().subtract(30, \"days\").startOf(\"day\").unix(),\r\n          moment().endOf(\"day\").unix(),\r\n        ];\r\n      },\r\n      custom: () => {\r\n        let { from, to } = customRange;\r\n        return [\r\n          moment(from).startOf(\"day\").unix(),\r\n          moment(to).endOf(\"day\").unix(),\r\n        ];\r\n      },\r\n    };\r\n\r\n    const [from, to] = _rangeMap[range]();\r\n\r\n    // return withdraws.list.filter((t) => t.ts >= from && t.ts < to);\r\n    return filter(items.list, (t) => t.ts >= from && t.ts < to);\r\n  }, [items.list, customRange, range]);\r\n\r\n  const onCancel = async (w) => {\r\n    // console.log(w);\r\n    // const r = await Service.User.withdrawCancel({ id: w.id }).promise;\r\n    const response = await Service.User.withdrawCancel({ id: w.id }).promise;\r\n    // console.log(response);\r\n    if (response.status === 1) {\r\n      setUserAuthFN(userAuth.status, userAuth.data, {\r\n        text: \"系统提示\",\r\n        message: response.info,\r\n      });\r\n      setLoad(true);\r\n    }\r\n  };\r\n\r\n  const onSetKey = (value) => {\r\n    setKey(null);\r\n    if (key !== value) setKey(value);\r\n  };\r\n\r\n  const onMax = () => {\r\n    setForm({\r\n      ...form,\r\n      amount: Math.floor(userAuth.data.balance),\r\n    });\r\n  };\r\n\r\n  const onHideBank = () => {\r\n    setShowBank(null);\r\n    setFresh(true);\r\n  };\r\n\r\n  const onTransfer = () => {\r\n    const { debit_bank, amount } = form;\r\n\r\n    if (!debit_bank) {\r\n      setUserAuthFN(userAuth.status, userAuth.data, {\r\n        text: \"系统提示\",\r\n        message: \"必须选择一张银行卡\",\r\n      });\r\n      return false;\r\n    }\r\n\r\n    if (!amount) {\r\n      setUserAuthFN(userAuth.status, userAuth.data, {\r\n        text: \"系统提示\",\r\n        message: \"取款金额不能为空\",\r\n      });\r\n      return false;\r\n    }\r\n\r\n    if (amount < 100) {\r\n      setUserAuthFN(userAuth.status, userAuth.data, {\r\n        text: \"系统提示\",\r\n        message: \"取款金额最低100元\",\r\n      });\r\n      return false;\r\n    }\r\n\r\n    const selectedBnk = find(cards, (obj) => obj.debit_bank == debit_bank);\r\n\r\n    const _form = {\r\n      ...form,\r\n      debit_bank: selectedBnk.id,\r\n    };\r\n\r\n    Service.User.withdraw({\r\n      ...Service.User.read(),\r\n      ..._form,\r\n    }).promise.then(\r\n      (r) => {\r\n        console.log(`You've successfully withdrawn:`, r);\r\n\r\n        setUserAuthFN(userAuth.status, userAuth.data, {\r\n          text: \"系统提示\",\r\n          message: r.info,\r\n        });\r\n        setLoad(true);\r\n      },\r\n      (e) => {\r\n        console.warn(\"Unable to withdraw:\", e);\r\n        setUserAuthFN(userAuth.status, userAuth.data, {\r\n          text: \"系统提示\",\r\n          message: e,\r\n        });\r\n      }\r\n    );\r\n  };\r\n\r\n  const wallet = async (e) => {\r\n    Service.Game.transferToWallet().promise.then((r) => {\r\n      Service.User.session({\r\n        ...Service.User.read(),\r\n      }).promise.then((r) => {\r\n\r\n        setUserAuthFN(1, r.info, {\r\n          text: \"转账成功\",\r\n          success: true,\r\n        });\r\n        setLoad(true);\r\n        setFresh(true)\r\n\r\n      });\r\n\r\n      },\r\n      (e) => {\r\n        console.warn(e);\r\n        setUserAuthFN(userAuth.status, userAuth.data, {\r\n          text: \"系统提示\",\r\n          message: e,\r\n        });\r\n      }\r\n    );\r\n  };\r\n\r\n\r\n  const onlyNumbers = (e) => {\r\n    const { name , value } = e.currentTarget\r\n    let regexp  = /^[0-9\\b]+$/\r\n    if (!value || regexp.test(value)) {\r\n      setForm((f) => ({\r\n        ...f,\r\n        [name]: value,\r\n      }));\r\n    }\r\n\r\n  };\r\n\r\n\r\n  const onTransferPerGame = (obj) =>{\r\n    const _from = {\r\n      id: 0,\r\n      name: 'wallet'\r\n    }\r\n    const _to = obj\r\n    // console.log(_from , _to) \r\n    // return false\r\n    console.info(\r\n      `You are transferring ${Math.floor(userData.balance)} ¥ from ${_from.name} to ${_to.game.name}`\r\n    );\r\n    Service.Game.transfer({\r\n      ...Service.User.read(),\r\n      amount: Math.floor(userData.balance),\r\n      from: _from.id,\r\n      to: _to.game.id,\r\n    }).then(\r\n      (r) => {\r\n        console.info(\r\n          `You have successfully transferred ${Math.floor(userData.balance)} ¥ from ${_from.name} to ${_to.game.name}: ${r.info}`\r\n        );\r\n        Service.User.session({\r\n          ...Service.User.read(),\r\n        }).promise.then((r) => {\r\n\r\n          setUserAuthFN(1, r.info, {\r\n            text: \"转账成功\",\r\n            success: true,\r\n          });\r\n          setLoad(true);\r\n          setFresh(true)\r\n\r\n        });\r\n\r\n        \r\n      },\r\n      (e) => {\r\n        // console.log(e);\r\n        setUserAuthFN(userAuth.status, userAuth.data, {\r\n          text: \"系统提示\",\r\n          message: e,\r\n        });\r\n    });\r\n\r\n\r\n  }\r\n\r\n  // console.log(items.list)\r\n\r\n  return (\r\n    <Wrap className=\"profile-withdrawal-desktop\" title={\"提款\"}>\r\n      <div className=\"profile-section section-box\">\r\n        <div className=\"profile-section-title\">\r\n          中心钱包 :<span className=\"value\"> ¥{userData.balance}</span>\r\n          <div className=\"one-transfer\" onClick={wallet}>\r\n            <span>\r\n              <i />\r\n              一键回收\r\n            </span>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"withdral-boxes\">\r\n          {balancesRaw &&\r\n            map(balancesRaw, (obj, i) => {\r\n              return (\r\n                <div key={i} className=\"withdral-boxes-item\">\r\n                  <div className=\"withdral-boxes-title\">{obj.game.name}</div>\r\n                  <div className=\"withdral-boxes-value\">\r\n                    {BigNumber(obj.balance).toFormat(2)}\r\n                  </div>\r\n                  <div className=\"withdral-boxes-button\" onClick={()=> onTransferPerGame(obj)} >一键转入</div>\r\n                </div>\r\n              );\r\n            })}\r\n        </div>\r\n        <div className=\"withdrawal-boxes-loadmore\" onClick={() => setLoadMore(!loadmore)}>\r\n          <span className={loadmore ? 'show' : ''}>显示所有场馆 </span>\r\n        </div>\r\n      </div>\r\n\r\n      {/* SECTION */}\r\n\r\n      <div\r\n        className={`profile-section section-box relative ${\r\n          showBank ? \"h727\" : \"\"\r\n        }`}\r\n      >\r\n        <div className=\"profile-section-relative\">\r\n          <div className=\"profile-section-subtitle\">选择银行卡</div>\r\n\r\n          <div className=\"withdrawal-form-section\">\r\n            <div className=\"withdrawal-form-group transfer\">\r\n              <div\r\n                className=\"input\"\r\n                onClick={() => toggleCardPicker(!cardPicker)}\r\n              >\r\n                {form.debit_bank}\r\n                <i />\r\n              </div>\r\n              <div className={`card-toggle ${cardPicker ? \"active\" : \"\"}`}>\r\n                {cards &&\r\n                  map(cards, (obj, i) => {\r\n                    return (\r\n                      <div\r\n                        key={i}\r\n                        className={`card-toggle-item  ${\r\n                          form.debit_bank === obj.debit_bank ? \"active\" : \"\"\r\n                        } `}\r\n                        onClick={() => [\r\n                          setForm({ ...form, debit_bank: obj.debit_bank }),\r\n                          toggleCardPicker(false),\r\n                        ]}\r\n                      >\r\n                        {obj.debit_bank}\r\n                      </div>\r\n                    );\r\n                  })}\r\n              </div>\r\n\r\n              <button onClick={onTransfer}>立即提款</button>\r\n            </div>\r\n            <div className=\"withdrawal-form-group max\">\r\n              <span>￥</span>\r\n              <input\r\n                value={form.amount}\r\n                placeholder=\"金额\"\r\n                name=\"amount\"\r\n                pattern=\"^-?[0-9]\\d*\\.?\\d*$\"\r\n                onChange={(e) =>onlyNumbers(e)}\r\n                // onKeyDown={(e) => onlyNumbers(e)}\r\n              />\r\n              <button onClick={() => onMax()}>最大金额</button>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"withdrawal-form-section-button\">\r\n            <button\r\n              className=\"new-button-card\"\r\n              onClick={() => setShowBank(\"new\")}\r\n            >\r\n              新增银行卡\r\n            </button>\r\n            <button\r\n              className=\"untie-button-card\"\r\n              onClick={() => setShowBank(\"del\")}\r\n            >\r\n              解绑银行卡\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        <CardWrap show={showBank} onHide={onHideBank} />\r\n      </div>\r\n\r\n      {/* SECTION */}\r\n\r\n      <div className=\"withdrawal-history-card-head\">\r\n        <div className=\"withdrawal-history-card-title\">\r\n          <span>提款记录</span>\r\n          <i className={load ? \"reload\" : \"\"} onClick={() => setLoad(true)} />\r\n        </div>\r\n        <div className=\"withdrawal-history-card-body\">\r\n          {items.list  ? (\r\n            map(items.list, (obj, i) => {\r\n              return (\r\n                <HistoryItem\r\n                  obj={obj}\r\n                  key={i}\r\n                  index={i}\r\n                  label={obj.cardNumber}\r\n                  time={obj.requestTime}\r\n                  value={obj.amount}\r\n                  status={obj.status}\r\n                  onCancel={(val) => onCancel(val)}\r\n                  onSetKey={(val) => onSetKey(val)}\r\n                  setKey={key}\r\n                />\r\n              );\r\n            })\r\n          ) : (\r\n            <div className=\"no-transactions\">\r\n              <div className=\"image-box\" />\r\n              <span>暂无记录</span>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </Wrap>\r\n  );\r\n};\r\n\r\nexport default Withdrawal;\r\n"]},"metadata":{},"sourceType":"module"}