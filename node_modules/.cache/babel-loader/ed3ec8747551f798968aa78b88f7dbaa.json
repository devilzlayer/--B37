{"ast":null,"code":"import _objectSpread from\"/Users/cramj/Documents/New PWA/ubet-project (1)/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/cramj/Documents/New PWA/ubet-project (1)/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import cx from'classnames';import{withAuth}from'../util/';import{Inbox as _Inbox}from'../service/';var status=['未读','已读'];var Inbox=function Inbox(){useEffect(function(){window.scrollTo(0,0);document.body.classList.add('inbox-page');return function(){return document.body.classList.remove('inbox-page');};},[]);var _useState=useState({status:0,list:[]}),_useState2=_slicedToArray(_useState,2),messages=_useState2[0],setMessages=_useState2[1];useEffect(function(){setMessages({status:0,list:[]});var req=_Inbox.read({record_type:'message'});req.promise.then(function(r){console.info(r);setMessages({status:1,list:r.info.map(function(m){return m;})});},function(e){if(!e.is_aborted){console.warn(e);}});return function(){return req.cancel();};},[]);var open=function open(_ref,i){var id=_ref.id;var _m=messages.list[i];if(!_m.content){setMessages(function(m){return _objectSpread(_objectSpread({},m),{},{status:0});});_Inbox.readCurrent({id:id}).promise.then(function(r){_m.opened=!_m.opened;_m.content=r.info.content;_m.message_status=1;setMessages(function(m){return _objectSpread(_objectSpread({},m),{},{list:m.list.filter(function(m,_i){return _i===i?_m:m;}),status:1});});},function(e){if(!e.is_aborted){console.warn(e);}});}else{_m.opened=!_m.opened;setMessages(function(m){return _objectSpread(_objectSpread({},m),{},{list:m.list.filter(function(m,_i){return _i===i?_m:m;})});});}};var _messagesList=messages.list.map(function(m,i){return/*#__PURE__*/React.createElement(\"div\",{className:cx('messages-list--item',{opened:m.opened}),key:i,onClick:function onClick(e){return open(m,i,e);}},/*#__PURE__*/React.createElement(\"div\",{className:\"messages-list--item-wrap\"},/*#__PURE__*/React.createElement(\"div\",{className:\"m-content\"},/*#__PURE__*/React.createElement(\"p\",{className:\"subject\"},m.subject),/*#__PURE__*/React.createElement(\"p\",{className:\"timestamp\"},m.send_time)),/*#__PURE__*/React.createElement(\"div\",{className:\"m-status\"},/*#__PURE__*/React.createElement(\"p\",{className:cx('status',{unread:m.message_status===0})},status[m.message_status]))),/*#__PURE__*/React.createElement(\"div\",{className:\"messages-list--item-content\"},/*#__PURE__*/React.createElement(\"p\",null,m.content)));});return/*#__PURE__*/React.createElement(\"div\",{className:\"messages-wrap desktop\"},/*#__PURE__*/React.createElement(\"div\",{className:cx('messages-list','with-loader',{loading:!messages.status})},/*#__PURE__*/React.createElement(\"div\",{className:\"load-spin\"}),_messagesList));};export default withAuth(Inbox);","map":{"version":3,"sources":["/Users/cramj/Documents/New PWA/ubet-project (1)/src/view/Inbox.js"],"names":["React","useEffect","useState","cx","withAuth","Inbox","_Inbox","status","window","scrollTo","document","body","classList","add","remove","list","messages","setMessages","req","read","record_type","promise","then","r","console","info","map","m","e","is_aborted","warn","cancel","open","i","id","_m","content","readCurrent","opened","message_status","filter","_i","_messagesList","subject","send_time","unread","loading"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport cx from 'classnames';\r\n\r\nimport { withAuth } from '../util/';\r\nimport { Inbox as _Inbox } from '../service/';\r\n\r\nconst status = [ '未读', '已读' ];\r\n\r\nconst Inbox = () => {\r\n\r\n\tuseEffect(() => {\r\n\r\n\t\twindow.scrollTo(0, 0);\r\n\r\n\t\tdocument.body.classList.add('inbox-page');\r\n\r\n\t\treturn () => document.body.classList.remove('inbox-page');\r\n\r\n\t}, []);\r\n\r\n\tconst [ messages, setMessages ] = useState({\r\n\t\tstatus: 0,\r\n\t\tlist: [],\r\n\t});\r\n\r\n\tuseEffect(() => {\r\n\r\n\t\tsetMessages({\r\n\t\t\tstatus: 0,\r\n\t\t\tlist: [],\r\n\t\t});\r\n\r\n\t\tconst req = _Inbox.read({\r\n\t\t\trecord_type: 'message',\r\n\t\t});\r\n\t\t\r\n\t\treq.promise.then(r => {\r\n\r\n\t\t\tconsole.info(r);\r\n\r\n\t\t\tsetMessages({\r\n\t\t\t\tstatus: 1,\r\n\t\t\t\tlist: r.info.map(m => m),\r\n\t\t\t});\r\n\r\n\t\t}, e => {\r\n\r\n\t\t\tif (!e.is_aborted) {\r\n\t\t\t\tconsole.warn(e);\r\n\t\t\t}\r\n\r\n\t\t});\r\n\r\n\t\treturn () => req.cancel();\r\n\r\n\t}, []);\r\n\r\n\tconst open = ({ id }, i) => {\r\n\r\n\t\tconst _m = messages.list[i];\r\n\r\n\t\tif (!_m.content) {\r\n\r\n\t\t\tsetMessages(m => ({\r\n\t\t\t\t...m,\r\n\t\t\t\tstatus: 0,\r\n\t\t\t}));\r\n\r\n\t\t\t_Inbox.readCurrent({ id }).promise.then(r => {\r\n\r\n\t\t\t\t_m.opened = !_m.opened;\r\n\t\t\t\t_m.content = r.info.content;\r\n\t\t\t\t_m.message_status = 1;\r\n\r\n\t\t\t\tsetMessages(m => ({\r\n\t\t\t\t\t...m,\r\n\t\t\t\t\tlist: m.list.filter((m, _i) => _i === i ? _m : m),\r\n\t\t\t\t\tstatus: 1,\r\n\t\t\t\t}));\r\n\r\n\t\t\t}, e => {\r\n\r\n\t\t\t\tif (!e.is_aborted) {\r\n\t\t\t\t\tconsole.warn(e);\r\n\t\t\t\t}\r\n\r\n\t\t\t});\r\n\r\n\t\t} else {\r\n\r\n\t\t\t_m.opened = !_m.opened;\r\n\r\n\t\t\tsetMessages(m => ({\r\n\t\t\t\t...m,\r\n\t\t\t\tlist: m.list.filter((m, _i) => _i === i ? _m : m),\r\n\t\t\t}));\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tconst _messagesList = messages.list.map((m, i) => (\r\n\t\t<div className={cx('messages-list--item', { opened: m.opened })} key={i} onClick={e => open(m, i, e)}>\r\n\t\t\t<div className=\"messages-list--item-wrap\">\r\n\t\t\t\t<div className=\"m-content\">\r\n\t\t\t\t\t<p className=\"subject\">{m.subject}</p>\r\n\t\t\t\t\t<p className=\"timestamp\">{m.send_time}</p>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"m-status\">\r\n\t\t\t\t\t<p className={cx('status', { unread: m.message_status === 0 })}>{status[m.message_status]}</p>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div className=\"messages-list--item-content\">\r\n\t\t\t\t<p>{m.content}</p>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t));\r\n\r\n\treturn (\r\n\t\t<div className=\"messages-wrap desktop\">\r\n\t\t\t<div className={cx('messages-list', 'with-loader', { loading: !messages.status })}>\r\n\t\t\t\t<div className=\"load-spin\"></div>\r\n\t\t\t\t{_messagesList}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n\r\n}\r\n\r\nexport default withAuth(Inbox);\r\n"]},"metadata":{},"sourceType":"module"}