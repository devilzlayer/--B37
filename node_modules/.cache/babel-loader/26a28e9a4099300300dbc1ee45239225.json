{"ast":null,"code":"var _jsxFileName = \"/Users/cramj/Documents/New PWA/ubet-project (1)/src/view/profile/withdrawal/card.js\";\nimport React, { useEffect, useState, useMemo, useContext } from \"react\";\nimport { map, filter, head, size } from \"lodash\";\nimport * as moment from \"moment\";\nimport Picker from \"react-mobile-picker\";\nimport { Service } from '../';\nimport PickerWrap from './picker';\nconst banks = [\"中国工商银行\", \"中国建设银行\", \"中国银行\", \"中国农业银行\", \"中国邮政储蓄银行\", \"招商银行\", \"交通银行\"];\n\nconst CardWrap = props => {\n  const {\n    show,\n    onHide\n  } = props;\n  const {\n    setUserAuthFN,\n    userAuth\n  } = useContext(Service.User.Context);\n  const [tempBank, setTempBank] = useState(head(banks));\n  const [cardList, setCardList] = useState(null);\n  const [delKey, setDelKey] = useState(null);\n  const [animate, setAnimate] = useState(false);\n  const [showCard, setShowCard] = useState(false);\n  const [form, setForm] = useState({\n    bank_type: \"中国工商银行\",\n    bank_province: \"贵州\",\n    bank_city: \"遵义市\",\n    realname: userAuth.data.realName || \"\",\n    bank_addr: \"\",\n    bank_no: \"\"\n  });\n  useEffect(() => {\n    if (show) {\n      setTimeout(() => {\n        setAnimate(true);\n      }, 500);\n    }\n\n    const res = Service.Card.read({ ...Service.User.read()\n    });\n    res.promise.then(r => {\n      // console.log(r)\n      setCardList(r.info);\n    }, e => {\n      console.warn(\"Unable to get cards:\", e);\n    });\n  }, [show]);\n\n  const onAddBnk = () => {\n    const {\n      bank_addr,\n      bank_no\n    } = form;\n\n    if (size(cardList) == 5) {\n      setUserAuthFN(userAuth.status, userAuth.data, {\n        text: '系统提示',\n        message: \"绑定的银行信息不能超过5条\"\n      });\n    }\n\n    if (!bank_addr || !bank_no) {\n      return false;\n    }\n\n    Service.Card.create({ ...Service.User.read(),\n      ...form\n    }).promise.then(r => {\n      setForm(f => ({ ...f,\n        bank_addr: \"\",\n        bank_no: \"\"\n      }));\n      Hide();\n    }, e => {\n      console.info(\"Unable to bind the card:\", e);\n    });\n  };\n\n  const Hide = () => {\n    setAnimate(false);\n    setTimeout(() => {\n      onHide();\n    }, 500);\n  };\n\n  const onDel = i => {\n    setDelKey(null);\n    if (delKey != i) setDelKey(i);\n  };\n\n  const onSelectBnk = event => {\n    setShowCard(false);\n    setForm(e => ({ ...e,\n      bank_type: event\n    }));\n  };\n\n  const onChange = e => {\n    const {\n      name,\n      value\n    } = e.target;\n    setForm(f => ({ ...f,\n      [name]: value\n    }));\n  };\n\n  let delCount = 0;\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: `withdrawal-card-wrap ${show ? 'show' : ''}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: `withdrawal-card-wrap-box new ${animate && show == 'new' ? 'animate' : ''}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    className: \"w-n-c-arrow\",\n    onClick: Hide,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 21\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"withdrawal-card-wrap-content\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"wcwc-title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127,\n      columnNumber: 25\n    }\n  }, \"\\u65B0\\u589E\\u94F6\\u884C\\u5361\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"wcwc-form\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"wcwc-form-field\",\n    onClick: () => setShowCard(true),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 29\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131,\n      columnNumber: 33\n    }\n  }, \"\\u5F00\\u6237\\u94F6\\u884C\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"wcwc-input\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 132,\n      columnNumber: 33\n    }\n  }, form.bank_type)), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"wcwc-form-field\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 29\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 33\n    }\n  }, \"\\u5F00\\u6237\\u652F\\u884C\"), /*#__PURE__*/React.createElement(\"input\", {\n    className: \"wcwc-input\",\n    name: \"bank_addr\",\n    onChange: onChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 136,\n      columnNumber: 33\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"wcwc-form-field\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 29\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 33\n    }\n  }, \"\\u5F00\\u6237\\u4EBA\\u59D3\\u540D\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"wcwc-input\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 33\n    }\n  }, form.realname)), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"wcwc-form-field\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 142,\n      columnNumber: 29\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 33\n    }\n  }, \"\\u94F6\\u884C\\u5361\\u53F7\"), /*#__PURE__*/React.createElement(\"input\", {\n    className: \"wcwc-input\",\n    name: \"bank_no\",\n    onChange: onChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 144,\n      columnNumber: 33\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"w-n-c-set-defaul-wrap\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 29\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    className: \"active\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 68\n    }\n  }, \"\\u9ED8\\u8BA4\\u94F6\\u884C\\u5361\")), /*#__PURE__*/React.createElement(\"button\", {\n    className: \"wcwc-add-button\",\n    onClick: onAddBnk,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 29\n    }\n  }, \"\\u65B0\\u589E\\u94F6\\u884C\\u5361\")))), /*#__PURE__*/React.createElement(\"div\", {\n    className: `withdrawal-card-wrap-box del ${animate && show == 'del' ? 'animate' : ''}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    className: \"w-n-c-arrow\",\n    onClick: Hide,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 21\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"withdrawal-card-wrap-content\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 156,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"wcwc-title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157,\n      columnNumber: 25\n    }\n  }, \"\\u5220\\u9664\\u5361\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"w-n-c-del-wrap\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 25\n    }\n  }, cardList && map(cardList, (obj, i) => {\n    delCount++;\n    if (delCount === 5) delCount = 1;\n    return /*#__PURE__*/React.createElement(\"div\", {\n      key: i,\n      className: `del-wrap-content del-bg${delCount}`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 165,\n        columnNumber: 33\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"de-wrap-body\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 166,\n        columnNumber: 37\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      className: `del-icon`,\n      onClick: () => onDel(i),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 37\n      }\n    }, /*#__PURE__*/React.createElement(\"i\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 168,\n        columnNumber: 41\n      }\n    }), delKey === i && /*#__PURE__*/React.createElement(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 169,\n        columnNumber: 58\n      }\n    }, \"\\u8BF7\\u8054\\u7CFB\\u5BA2\\u670D\")), /*#__PURE__*/React.createElement(\"span\", {\n      className: `del-bank-icon ${obj.bank_type}`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 37\n      }\n    }), /*#__PURE__*/React.createElement(\"h3\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 172,\n        columnNumber: 37\n      }\n    }, obj.bank_type), /*#__PURE__*/React.createElement(\"h4\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 173,\n        columnNumber: 37\n      }\n    }, \"\\u94F6\\u884C\\u5361\\u53F7\"), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"del-bank-number\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 174,\n        columnNumber: 37\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      className: \"del-sp\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 175,\n        columnNumber: 41\n      }\n    }, \"**** **** ****\"), /*#__PURE__*/React.createElement(\"span\", {\n      className: \"del-st\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 176,\n        columnNumber: 41\n      }\n    }, obj.bank_no.substr(obj.bank_no.length - 4)))));\n  })))), /*#__PURE__*/React.createElement(PickerWrap, {\n    options: banks,\n    show: showCard,\n    onHide: () => setShowCard(false),\n    selected: form.bank_type,\n    onSelect: onSelectBnk,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 17\n    }\n  }));\n};\n\nexport default CardWrap;","map":{"version":3,"sources":["/Users/cramj/Documents/New PWA/ubet-project (1)/src/view/profile/withdrawal/card.js"],"names":["React","useEffect","useState","useMemo","useContext","map","filter","head","size","moment","Picker","Service","PickerWrap","banks","CardWrap","props","show","onHide","setUserAuthFN","userAuth","User","Context","tempBank","setTempBank","cardList","setCardList","delKey","setDelKey","animate","setAnimate","showCard","setShowCard","form","setForm","bank_type","bank_province","bank_city","realname","data","realName","bank_addr","bank_no","setTimeout","res","Card","read","promise","then","r","info","e","console","warn","onAddBnk","status","text","message","create","f","Hide","onDel","i","onSelectBnk","event","onChange","name","value","target","delCount","obj","substr","length"],"mappings":"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","sourcesContent":["import React , {useEffect , useState , useMemo , useContext } from \"react\";\r\nimport { map, filter , head , size } from \"lodash\";\r\nimport * as moment from \"moment\";\r\nimport Picker from \"react-mobile-picker\";\r\n\r\nimport { Service } from '../'\r\n\r\nimport PickerWrap from './picker'\r\n\r\n\r\nconst banks = [\r\n    \"中国工商银行\",\r\n    \"中国建设银行\",\r\n    \"中国银行\",\r\n    \"中国农业银行\",\r\n    \"中国邮政储蓄银行\",\r\n    \"招商银行\",\r\n    \"交通银行\",\r\n];\r\n\r\nconst CardWrap = (props) =>{\r\n    const { show , onHide} = props\r\n\r\n    const { setUserAuthFN ,userAuth } = useContext(Service.User.Context);\r\n\r\n    const [tempBank, setTempBank] = useState(head(banks));\r\n\r\n\r\n    const [cardList, setCardList]   = useState(null);\r\n    const [delKey, setDelKey]       = useState(null);\r\n\r\n    const [ animate , setAnimate ]      = useState(false)\r\n    const [ showCard , setShowCard ]    = useState(false)\r\n\r\n    const [form, setForm] = useState({\r\n        bank_type       : \"中国工商银行\",\r\n        bank_province   : \"贵州\",\r\n        bank_city       : \"遵义市\",\r\n        realname        : userAuth.data.realName || \"\",\r\n        bank_addr       : \"\",\r\n        bank_no         : \"\",\r\n    });\r\n      \r\n    useEffect(() =>{\r\n        if(show){\r\n            setTimeout(() => {\r\n                setAnimate(true)\r\n            }, 500);\r\n        }\r\n\r\n        const res = Service.Card.read({\r\n            ...Service.User.read(),\r\n        });\r\n      \r\n        res.promise.then( (r) => {\r\n              // console.log(r)\r\n              setCardList(r.info);\r\n        },(e) => {\r\n              console.warn(\"Unable to get cards:\", e);\r\n         });\r\n    }, [show])\r\n\r\n\r\n    const onAddBnk = () =>{\r\n        const { bank_addr , bank_no  } = form\r\n        if(size(cardList) == 5){\r\n            setUserAuthFN( userAuth.status , userAuth.data , {\r\n                text    : '系统提示',\r\n                message : \"绑定的银行信息不能超过5条\",\r\n            })\r\n        }\r\n        if(!bank_addr || ! bank_no){\r\n            return false\r\n        }\r\n\r\n        Service.Card.create({\r\n            ...Service.User.read(),\r\n            ...form,\r\n        }).promise.then((r) => {\r\n              setForm((f) => ({\r\n                ...f,\r\n                bank_addr: \"\",\r\n                bank_no: \"\",\r\n              }));\r\n              Hide()\r\n        },(e) => {\r\n            console.info(\"Unable to bind the card:\", e);\r\n         });\r\n    }\r\n\r\n    const Hide = () => {\r\n        setAnimate(false)\r\n        setTimeout(() => {\r\n            onHide()\r\n        }, 500);\r\n    }\r\n\r\n\r\n    const onDel = (i) => {\r\n        setDelKey(null);\r\n        if (delKey != i) setDelKey(i);\r\n    };\r\n    \r\n    const onSelectBnk = (event) =>{\r\n        setShowCard(false)\r\n        setForm( e =>({\r\n            ...e,\r\n            bank_type: event\r\n        }))\r\n    }\r\n\r\n    const onChange =(e) =>{\r\n        const { name, value } = e.target;\r\n        setForm( f => ({\r\n            ...f,\r\n            [name]: value,\r\n        }));\r\n    }\r\n    \r\n    \r\n    let delCount = 0;\r\n    return  <div className={`withdrawal-card-wrap ${show ? 'show' : ''}`}>\r\n\r\n                <div className={`withdrawal-card-wrap-box new ${animate && show == 'new' ? 'animate' : ''}`}>\r\n                    <span className=\"w-n-c-arrow\" onClick={Hide} />\r\n                    <div className=\"withdrawal-card-wrap-content\">\r\n                        <div className=\"wcwc-title\">新增银行卡</div>\r\n\r\n                        <div className=\"wcwc-form\">\r\n                            <div className=\"wcwc-form-field\" onClick={() => setShowCard(true)}>\r\n                                <label>开户银行</label>\r\n                                <div className=\"wcwc-input\">{form.bank_type}</div>\r\n                            </div>\r\n                            <div className=\"wcwc-form-field\">\r\n                                <label>开户支行</label>\r\n                                <input className=\"wcwc-input\" name=\"bank_addr\" onChange={onChange}/>\r\n                            </div>\r\n                            <div className=\"wcwc-form-field\">\r\n                                <label>开户人姓名</label>\r\n                                <div className=\"wcwc-input\">{form.realname}</div>\r\n                            </div>\r\n                            <div className=\"wcwc-form-field\">\r\n                                <label>银行卡号</label>\r\n                                <input className=\"wcwc-input\" name=\"bank_no\" onChange={onChange} />\r\n                            </div>\r\n\r\n                            <div className=\"w-n-c-set-defaul-wrap\"><span className=\"active\">默认银行卡</span></div>\r\n                            <button className=\"wcwc-add-button\" onClick={onAddBnk}>新增银行卡</button>\r\n                        </div>\r\n                    </div>\r\n\r\n                </div>\r\n                \r\n                <div className={`withdrawal-card-wrap-box del ${animate && show == 'del' ? 'animate' : ''}`}>\r\n                    <span className=\"w-n-c-arrow\" onClick={Hide} />\r\n                    <div className=\"withdrawal-card-wrap-content\">\r\n                        <div className=\"wcwc-title\">删除卡</div>\r\n\r\n                        <div className=\"w-n-c-del-wrap\">\r\n                            {cardList && map(cardList, (obj, i) => {\r\n                                delCount++;\r\n                                if (delCount === 5) delCount = 1;\r\n\r\n                                return (\r\n                                <div key={i} className={`del-wrap-content del-bg${delCount}`}>\r\n                                    <div className=\"de-wrap-body\">\r\n                                    <span className={`del-icon`} onClick={() => onDel(i)}>\r\n                                        <i />\r\n                                        {delKey === i && <span>请联系客服</span>}\r\n                                    </span>\r\n                                    <span className={`del-bank-icon ${obj.bank_type}`} />\r\n                                    <h3>{obj.bank_type}</h3>\r\n                                    <h4>银行卡号</h4>\r\n                                    <div className=\"del-bank-number\">\r\n                                        <span className=\"del-sp\">**** **** ****</span>\r\n                                        <span className=\"del-st\">\r\n                                        {obj.bank_no.substr(obj.bank_no.length - 4)}\r\n                                        </span>\r\n                                    </div>\r\n                                    </div>\r\n                                </div>\r\n                                );\r\n                            })}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <PickerWrap \r\n                    options={banks} \r\n                    show={showCard}\r\n                    onHide={() => setShowCard(false)}\r\n                    selected={form.bank_type}\r\n                    onSelect={onSelectBnk}\r\n                />\r\n\r\n                \r\n            </div>\r\n}\r\n\r\nexport default CardWrap"]},"metadata":{},"sourceType":"module"}